/*!
 * 1DS JS SDK POST plugin, 3.2.3
 * Copyright (c) Microsoft and contributors. All rights reserved.
 * (Microsoft Internal Only)
 */
var e=this,n=function(e,n,t,ne){"use strict";function p(e){return e&&"object"==typeof e&&"default"in e?e["default"]:e}var o=p(t),te="REAL_TIME",Q="POST",V="drop",t="requeue",W="application/x-json-stream",J="cache-control",G="content-type",Y="kill-duration",he="time-delta-millis",Z="client-version",ve="client-id",$="time-delta-to-apply-millis",ee="upload-time",ie="apikey",re="AuthMsaDeviceTicket",i="AuthXToken",ae="msfpc";function y(e){e=(e.ext||{}).intweb;return e&&ne.isValueAssigned(e[ae])?e[ae]:null}function g(e){for(var n=null,t=0;null===n&&t<e.length;t++)n=y(e[t]);return n}s.create=function(e,n){return new s(e,n)};var oe=s;function s(i,e){var r=e?[].concat(e):[],e=this,a=g(r);e.iKey=function(){return i},e.Msfpc=function(){return a||""},e.count=function(){return r.length},e.events=function(){return r},e.addEvent=function(e){return!!e&&(r.push(e),a=a||y(e),!0)},e.split=function(e,n){var t;return e<r.length&&(t=r.length-e,ne.isNullOrUndefined(n)||(t=n<t?n:t),t=r.splice(e,t),a=g(r)),new s(i,t)}}var m="metadata",w=/\./,pe=function d(n,e,b,t){var a="baseData",T=!!t,E=e,S={};o(d,this,function(g){function m(e,d,f,h,v,p,y){ne.objForEachKey(e,function(e,n){if(n||ne.isValueAssigned(n)){var t,i=f,r=e,a=v,o=d;if(T&&!h&&w.test(e)){var s=e.split("."),u=s.length;if(1<u){for(var a=a&&a.slice(),c=0;c<u-1;c++){var l=s[c],o=o[l]=o[l]||{};i+="."+l,a&&a.push(l)}r=s[u-1]}}(e=h&&((t=S[e=i])===undefined&&(7<=e.length&&(t=ne.strStartsWith(e,"ext.metadata")||ne.strStartsWith(e,"ext.web")),S[e]=t),t)||!E||!E.handleField(i,r)?ne.sanitizeProperty(r,n,b):E.value(i,r,n,b))&&(t=e.value,o[r]=t,p&&p(a,r,e),y&&"object"==typeof t&&!ne.isArray(t)&&((e=a)&&(e=a.slice()).push(r),m(n,t,i+"."+r,h,e,p,y)))}})}g.createPayload=function(e,n,t,i,r,a){return{apiKeys:[],payloadBlob:"",overflow:null,sizeExceed:[],failedEvts:[],batches:[],numEvents:0,retryCnt:e,isTeardown:n,isSync:t,isBeacon:i,sendType:a,sendReason:r}},g.appendPayload=function(v,p,y){var e=v&&p&&!v.overflow;return e&&ne.doPerf(n,function(){return"Serializer:appendPayload"},function(){for(var e=p.events(),n=v.payloadBlob,t=v.numEvents,i=!1,r=[],a=[],o=v.isBeacon,s=o?65e3:3984588,u=o?65e3:2e6,c=0,l=0;c<e.length;){var d=e[c];if(d){if(y<=t){v.overflow=p.split(c);break}var f=g.getEventBlob(d);if(f&&f.length<=u){var h=f.length;if(s<n.length+h){v.overflow=p.split(c);break}n&&(n+="\n"),n+=f,20<++l&&(n.substr(0,1),l=0),i=!0,t++}else(f?r:a).push(d),e.splice(c,1),c--}c++}r&&0<r.length&&v.sizeExceed.push(oe.create(p.iKey(),r)),a&&0<a.length&&v.failedEvts.push(oe.create(p.iKey(),a)),i&&(v.batches.push(p),v.payloadBlob=n,v.numEvents=t,o=p.iKey(),-1===ne.arrIndexOf(v.apiKeys,o)&&v.apiKeys.push(o))},function(){return{payload:v,theBatch:{iKey:p.iKey(),evts:p.events()},max:y}}),e},g.getEventBlob=function(r){try{return ne.doPerf(n,function(){return"Serializer.getEventBlob"},function(){var e={},i=(e.name=r.name,e.time=r.time,e.ver=r.ver,e.iKey="o:"+ne.getTenantId(r.iKey),{}),n=r.ext,n=(n&&(e.ext=i,ne.objForEachKey(n,function(e,n){m(n,i[e]={},"ext."+e,!0,null,null,!0)})),e.data={}),t=(n.baseType=r.baseType,n[a]={});return m(r.baseData,t,a,!1,[a],function(e,n,t){R(i,e,n,t)},!0),m(r.data,n,"data",!1,[],function(e,n,t){R(i,e,n,t)},!0),JSON.stringify(e)},function(){return{item:r}})}catch(e){return null}}})};function R(e,n,t,i){if(i&&e){var r=ne.getCommonSchemaMetaData(i.value,i.kind,i.propertyType);if(-1<r){var a=e[m],o=(o=(a=a||(e[m]={f:{}})).f)||(a.f={});if(n)for(var s=0;s<n.length;s++)var u=n[s],o=(o[u]||(o[u]={f:{}}),o[u].f||(o[u].f={}));o=o[t]={},ne.isArray(i.value)?o.a={t:r}:o.t=r}}}var b=.8,T=1.2,E=3e3,S=6e5;function ye(e){var n=E*b;return Math.min(Math.pow(2,e)*(Math.floor(Math.random()*(E*T-n))+n),S)}var ge=function f(){var u={};o(f,this,function(e){e.setKillSwitchTenants=function(e,n){if(e&&n)try{a=e.split(","),o=[],a&&ne.arrForEach(a,function(e){o.push(ne.strTrim(e))});var t=o;if("this-request-only"===n)return t;for(var i=1e3*parseInt(n,10),r=0;r<t.length;++r)u[t[r]]=ne.dateNow()+i}catch(s){return[]}var a,o;return[]},e.isTenantKilled=function(e){var n=u,e=ne.strTrim(e);return n[e]!==undefined&&n[e]>ne.dateNow()||(delete n[e],!1)}})},me=function h(){var n=!0,t=!0,i=!0,r="use-collector-delta",a=!1;o(h,this,function(e){e.allowRequestSending=function(){return n},e.firstRequestSent=function(){i&&(i=!1,a||(n=!1))},e.shouldAddClockSkewHeaders=function(){return t},e.getClockSkewHeaderValue=function(){return r},e.setClockSkew=function(e){a||(e?(r=e,a=t=!0):t=!1,n=!0)}})},se="sendAttempt",be="&NoResponseBody=true",Te=((l={})[1]=t,l[100]=t,l[200]="sent",l[8004]=V,l[8003]=V,l),r={},ue={};function a(e,n,t){r[e]=n,!1!==t&&(ue[n]=e)}function Ee(e){try{return e.responseText}catch(n){}return""}function Se(e,n){var t=!1;if(e&&n){var i=ne.objKeys(e);if(i&&0<i.length)for(var r=n.toLowerCase(),a=0;a<i.length;a++){var o=i[a];if(o&&ne.hasOwnProperty(n,o)&&o.toLowerCase()==r){t=!0;break}}}return t}function ce(e,n,t,i){n&&t&&0<t.length&&(i&&r[n]?(e.hdrs[r[n]]=t,e.useHdrs=!0):e.url+="&"+n+"="+t)}a(re,re,!1),a(Z,Z),a(ve,"Client-Id"),a(ie,ie),a($,$),a(ee,ee),a(i,i);var we=function v(p,e,w,R,P){this._responseHandlers=[];var _,x,C,K,O,k,F="?cors=true&content-type="+W,M=new ge,B=!1,L=new me,A=!1,H=0,j=!0,N=[],q={},I=[],U=null,z=!1,D=!1,X=!1;o(v,this,function(y){var s=!0;function o(e,n){for(var t=0,i=null,r=0;null==i&&r<e.length;)1===(t=e[r])?ne.useXDomainRequest()?i=a:ne.isXhrSupported()&&(i=c):2===t&&ne.isFetchSupported(n)?i=u:A&&3===t&&ne.isBeaconsSupported()&&(i=l),r++;return i?{_transport:t,_isSync:n,sendPOST:i}:null}function a(e,n,t){var i=new XDomainRequest;i.open(Q,e.urlString),e.timeout&&(i.timeout=e.timeout),i.onload=function(){var e=Ee(i);g(n,200,{},e),d(e)},i.onerror=function(){g(n,400,{})},i.ontimeout=function(){g(n,500,{})},i.onprogress=function(){},t?i.send(e.data):P.set(function(){i.send(e.data)},0)}function u(e,i,n){var t,r=e.urlString,a=!1,o=!1;(t={body:e.data,method:Q}).Microsoft_ApplicationInsights_BypassAjaxInstrumentation=!0;n&&(t.keepalive=!0,2===e._sendReason&&(a=!0,r+=be)),s&&(t.credentials="include"),e.headers&&0<ne.objKeys(e.headers).length&&(t.headers=e.headers),fetch(r,t).then(function(e){var t={},n="";e.headers&&e.headers.forEach(function(e,n){t[n]=e}),e.body&&e.text().then(function(e){n=e}),o||(o=!0,g(i,e.status,t,n),d(n))})["catch"](function(e){o||(o=!0,g(i,0,{}))}),a&&!o&&(o=!0,g(i,200,{})),!o&&0<e.timeout&&P.set(function(){o||(o=!0,g(i,500,{}))},e.timeout)}function c(e,a,n){var t=e.urlString;function o(e,n,t){return!e[t]&&n&&n.getResponseHeader&&(n=n.getResponseHeader(t))&&(e[t]=ne.strTrim(n)),e}function i(e,n){var t,i,r;g(a,e.status,(r={},(e=e).getAllResponseHeaders?(t=e.getAllResponseHeaders(),i={},ne.isString(t)&&(t=ne.strTrim(t).split(/[\r\n]+/),ne.arrForEach(t,function(e){var n,t;e&&(-1!=(t=e.indexOf(": "))?(n=ne.strTrim(e.substring(0,t)).toLowerCase(),t=ne.strTrim(e.substring(1+t)),i[n]=t):i[ne.strTrim(e)]=1)})),i):(r=o(r,e,he),r=o(r,e,Y),o(r,e,"kill-duration-seconds"))),n)}n&&e.disableXhrSync&&(n=!1);var r=ne.openXhr(Q,t,s,!0,n,e.timeout);ne.objForEachKey(e.headers,function(e,n){r.setRequestHeader(e,n)}),r.onload=function(){var e=Ee(r);i(r,e),d(e)},r.onerror=function(){i(r)},r.ontimeout=function(){i(r)},r.send(e.data)}function g(e,n,t,i){try{e(n,t,i)}catch(r){ne._throwInternal(_.diagLog(),2,518,ne.dumpObj(r))}}function l(e,n,t){var i=200,r=e._thePayload,a=e.urlString+be;try{var o,s=ne.getNavigator();s.sendBeacon(a,e.data)||(r?(o=[],ne.arrForEach(r.batches,function(e){if(o&&e&&0<e.count()){for(var n=e.events(),t=0;t<n.length;t++)if(!s.sendBeacon(a,U.getEventBlob(n[t]))){o.push(e.split(t));break}}else o.push(e.split(0))}),S(o,8003,r.sendType,!0)):i=0)}catch(u){_.diagLog().warnToConsole("Failed to send telemetry using sendBeacon API. Ex:"+ne.dumpObj(u)),i=0}finally{g(n,i,{},"")}}function m(e){return 2===e||3===e}function i(e){return D&&m(e)?2:e}function r(){return!B&&H<e}function t(){var e=I;return I=[],e}function f(e,n,t){return e&&0<e.length&&!B&&x[n]&&U&&(0!==n||r()&&(0<t||L.allowRequestSending()))}function h(e){var t={};return e&&ne.arrForEach(e,function(e,n){t[n]={iKey:e.iKey(),evts:e.events()}}),t}function b(o,s,u,c,l){if(o&&0!==o.length)if(B)S(o,1,c);else{c=i(c);try{var e=o,d=0!==c;ne.doPerf(C,function(){return"HttpManager:_sendBatches"},function(e){e&&(o=o.slice(0));for(var n=[],t=null,i=ne.getTime(),e=x[c]||(d?x[1]:x[0]),r=(D||m(c)||e&&3===e._transport)&&!j&&A&&ne.isBeaconsSupported();f(o,c,s);){var a=o.shift();a&&0<a.count()&&(M.isTenantKilled(a.iKey())?n.push(a):(t=t||U.createPayload(s,u,d,r,l,c),U.appendPayload(t,a,p)?null!==t.overflow&&(o=[t.overflow].concat(o),t.overflow=null,v(t,i,ne.getTime(),l),i=ne.getTime(),t=null):(v(t,i,ne.getTime(),l),i=ne.getTime(),o=[a].concat(o),t=null)))}t&&v(t,i,ne.getTime(),l),0<o.length&&(I=o.concat(I)),S(n,8004,c)},function(){return{batches:h(e),retryCount:s,isTeardown:u,isSynchronous:d,sendReason:l,useSendBeacon:m(c),sendType:c}},!d)}catch(n){ne._throwInternal(_.diagLog(),2,48,"Unexpected Exception sending batch: "+ne.dumpObj(n))}}}function T(e,n,t){e[n]=e[n]||{},e[n][_.identifier]=t}function v(h,s,u,v){var c,l,d,f,p;h&&h.payloadBlob&&0<h.payloadBlob.length&&(c=!!y.sendHook,l=x[h.sendType],!m(h.sendType)&&h.isBeacon&&2===h.sendReason&&(l=x[2]||x[3]||l),f=X,!h.isBeacon&&3!==l._transport||(f=!1),d=function(e,n){var t={url:F,hdrs:{},useHdrs:!1},i=(n?(t.hdrs=ne.extend(t.hdrs,q),t.useHdrs=0<ne.objKeys(t.hdrs).length):ne.objForEachKey(q,function(e,n){ue[e]?ce(t,ue[e],n,!1):(t.hdrs[e]=n,t.useHdrs=!0)}),ce(t,ve,"NO_AUTH",n),ce(t,Z,ne.FullVersionString,n),""),e=(ne.arrForEach(e.apiKeys,function(e){0<i.length&&(i+=","),i+=e}),ce(t,ie,i,n),ce(t,ee,ne.dateNow().toString(),n),function(e){for(var n=0;n<e.batches.length;n++){var t=e.batches[n].Msfpc();if(t)return encodeURIComponent(t)}return""}(e));ne.isValueAssigned(e)&&(t.url+="&ext.intweb.msfpc="+e),L.shouldAddClockSkewHeaders()&&ce(t,$,L.getClockSkewHeaderValue(),n),C.getWParam&&0<=(e=C.getWParam())&&(t.url+="&w="+e);for(var r=0;r<N.length;r++)t.url+="&"+N[r].name+"="+N[r].value;return t}(h,f),f=f||d.useHdrs,p=ne.getTime(),ne.doPerf(C,function(){return"HttpManager:_doPayloadSend"},function(){for(var e=0;e<h.batches.length;e++)for(var n=h.batches[e].events(),t=0;t<n.length;t++){var i,r=n[t];z&&(T(i=r.timings=r.timings||{},"sendEventStart",p),T(i,"serializationStart",s),T(i,"serializationCompleted",u)),0<r[se]?r[se]++:r[se]=1}S(h.batches,1e3+(v||0),h.sendType,!0);var a={data:h.payloadBlob,urlString:d.url,headers:d.hdrs,_thePayload:h,_sendReason:v,timeout:O},o=(ne.isUndefined(k)||(a.disableXhrSync=!!k),f&&(Se(a.headers,J)||(a.headers[J]="no-cache, no-store"),Se(a.headers,G)||(a.headers[G]=W)),null);l&&(o=function(e){L.firstRequestSent();var n=function(e,n){var t,i,r=h,a=v,o=9e3,s=null,u=!1,c=!1;try{var l,d=!0;if(typeof e!==ne.strUndefined){if(n&&(L.setClockSkew(n[he]),f=n[Y]||n["kill-duration-seconds"],ne.arrForEach(M.setKillSwitchTenants(n["kill-tokens"],f),function(n){ne.arrForEach(r.batches,function(e){e.iKey()===n&&(s=s||[],e=e.split(0),r.numEvents-=e.count(),s.push(e))})})),200==e||204==e)return void(o=200);(300<=e&&e<500&&408!=e&&429!=e||501==e||505==e||r.numEvents<=0)&&(d=!1),o=9e3+e%1e3}d&&(o=100,l=r.retryCnt,0===r.sendType&&(l<w?(u=!0,E(function(){0===r.sendType&&H--,b(r.batches,l+1,r.isTeardown,D?2:r.sendType,5)},D,ye(l))):(c=!0,D&&(o=8001))))}finally{if(!u){L.setClockSkew();var n=r,f=o,e=a,d=c;try{d&&_._backOffTransmission(),200===f&&(d||n.isSync||_._clearBackOff(),t=n.batches,z&&(i=ne.getTime(),ne.arrForEach(t,function(e){var n;e&&0<e.count()&&(e=e.events(),n=i,z&&ne.arrForEach(e,function(e){T(e.timings=e.timings||{},"sendEventCompleted",n)}))}))),S(n.batches,f,n.sendType,!0)}finally{0===n.sendType&&(H--,5!==e&&y.sendQueuedRequests(n.sendType,e))}}S(s,8004,r.sendType)}},t=h.isTeardown||h.isSync;try{l.sendPOST(e,n,t),y.sendListener&&y.sendListener(a,e,t,h.isBeacon)}catch(i){_.diagLog().warnToConsole("Unexpected exception sending payload. Ex:"+ne.dumpObj(i)),g(n,0,{})}}),ne.doPerf(C,function(){return"HttpManager:_doPayloadSend.sender"},function(){var n,t;o&&(0===h.sendType&&H++,c&&!h.isBeacon&&3!==l._transport?(n={data:a.data,urlString:a.urlString,headers:ne.extend({},a.headers),timeout:a.timeout,disableXhrSync:a.disableXhrSync},t=!1,ne.doPerf(C,function(){return"HttpManager:_doPayloadSend.sendHook"},function(){try{y.sendHook(n,function(e){t=!0,j||e._thePayload||(e._thePayload=e._thePayload||a._thePayload,e._sendReason=e._sendReason||a._sendReason),o(e)},h.isSync||h.isTeardown)}catch(e){t||o(a)}})):o(a))})},function(){return{thePayload:h,serializationStart:s,serializationCompleted:u,sendReason:v}},h.isSync)),h.sizeExceed&&0<h.sizeExceed.length&&S(h.sizeExceed,8003,h.sendType),h.failedEvts&&0<h.failedEvts.length&&S(h.failedEvts,8002,h.sendType)}function E(e,n,t){n?e():P.set(e,t)}function d(e){var n=y._responseHandlers;try{for(var t,i=0;i<n.length;i++)try{n[i](e)}catch(r){ne._throwInternal(_.diagLog(),1,519,"Response handler failed: "+r)}e&&(t=JSON.parse(e),ne.isValueAssigned(t.webResult)&&ne.isValueAssigned(t.webResult[ae])&&K.set("MSFPC",t.webResult[ae],31536e3))}catch(a){}}function S(n,t,i,e){var r,a,o,s;n&&0<n.length&&R&&(r=R[s=Te[o=t],ne.isValueAssigned(s)||(s="oth",9e3<=o&&o<=9999?s="rspFail":8e3<=o&&o<=8999?s=V:1e3<=o&&o<=1999&&(s="send")),s])&&ne.doPerf(C,function(){return"HttpManager:_sendBatchesNotification"},function(){E(function(){try{r.call(R,n,t,a,i)}catch(e){ne._throwInternal(_.diagLog(),1,74,"send request notification failed: "+e)}},e||a,0)},function(){return{batches:h(n),reason:t,isSync:a,sendSync:e,sendType:i}},!(a=0!==i))}y.initialize=function(e,n,t,i,r){F=e+F,X=!!ne.isUndefined((r=r||{}).avoidOptions)||!r.avoidOptions,K=(C=n).getCookieMgr(),z=!C.config.disableEventTimings;var a,e=!!C.config.enableCompoundKey,n=(_=t,r.valueSanitizer),t=r.stringifyObjects,n=(ne.isUndefined(r.enableCompoundKey)||(e=!!r.enableCompoundKey),O=r.xhrTimeout,k=r.disableXhrSync,A=!ne.isReactNative(),U=new pe(C,n,t,e),i),t=r.alwaysUseXhrOverride?i:null,e=r.alwaysUseXhrOverride?i:null;i||(j=!1,(a=ne.getLocation())&&a.protocol&&"file:"==a.protocol.toLowerCase()&&(s=!1),a=[],a=ne.isReactNative()?[2,1]:[1,2,3],(r=r.transports)&&(ne.isNumber(r)?a=[r].concat(a):ne.isArray(r)&&(a=r.concat(a))),i=o(a,!1),n=o(a,!0),i||_.diagLog().warnToConsole("No available transport to send events")),(r={})[0]=i,r[1]=n||o([1,2,3],!0),r[2]=t||o([3,2],!0)||n||o([1],!0),r[3]=e||o([2,3],!0)||n||o([1],!0),x=r},y._getDbgPlgTargets=function(){return[x[0],M,U,x]},y.addQueryStringParameter=function(e,n){for(var t=0;t<N.length;t++)if(N[t].name===e)return void(N[t].value=n);N.push({name:e,value:n})},y.addHeader=function(e,n){q[e]=n},y.canSendRequest=function(){return r()&&L.allowRequestSending()},y.sendQueuedRequests=function(e,n){ne.isUndefined(e)&&(e=0),D&&(e=i(e),n=2),f(I,e,0)&&b(t(),0,!1,e,n||0)},y.isCompletelyIdle=function(){return!B&&0===H&&0===I.length},y.setUnloading=function(e){D=e},y.addBatch=function(e){if(e&&0<e.count()){if(M.isTenantKilled(e.iKey()))return!1;I.push(e)}return!0},y.teardown=function(){0<I.length&&b(t(),0,!0,2,2)},y.pause=function(){B=!0},y.resume=function(){B=!1,y.sendQueuedRequests(0,4)},y.sendSynchronousBatch=function(e,n,t){e&&0<e.count()&&(ne.isNullOrUndefined(n)&&(n=1),D&&(n=i(n),t=2),b([e],0,!1,n,t||0))}})};function P(e,n){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];return setTimeout(e,n,t)}function _(e){clearTimeout(e)}function le(e,n){return{set:e||P,clear:n||_}}var u,de="eventsDiscarded",fe="overrideInstrumentationKey",Re="maxEventRetryAttempts",Pe="maxUnloadEventRetryAttempts",t=(u=ne.BaseTelemetryPlugin,n.__extendsFn(c,u),c);function c(){var x,C,K,O,k,F,M,B,e=u.call(this)||this,L=(e.identifier="PostChannel",e.priority=1011,!(e.version="3.2.3")),A=[],H=null,j=!1,N=0,q=500,I=0,U=1e4,z={},D=te,X=null,Q=null,V=0,W=0,J={},G=-1,Y=!0,Z=!1,$=6,ee=2;return o(c,e,function(c,l){function d(e){"beforeunload"!==(e||ne.getWindow().event).type&&(Z=!0,K.setUnloading(Z)),u(2,2)}function f(e){Z=!1,K.setUnloading(Z)}function r(e,n){if(e.sendAttempt||(e.sendAttempt=0),e.latency||(e.latency=1),e.ext&&e.ext.trace&&delete e.ext.trace,e.ext&&e.ext.user&&e.ext.user.id&&delete e.ext.user.id,Y&&(e.ext=ne.optimizeObject(e.ext),e.baseData&&(e.baseData=ne.optimizeObject(e.baseData)),e.data&&(e.data=ne.optimizeObject(e.data))),e.sync)if(V||j)e.latency=3,e.sync=!1;else if(K)return Y&&(e=ne.optimizeObject(e)),K.sendSynchronousBatch(oe.create(e.iKey,[e]),!0===e.sync?1:e.sync,3);var t=e.latency,i=I,r=U,a=(4===t&&(i=N,r=q),!1);i<r?a=!p(e,n):(i=1,r=20,4===t&&(i=4,r=1),a=!0,function(e,n,t,i){for(;t<=n;){var r=h(e,n,!0);if(r&&0<r.count()){var r=r.split(0,i),a=r.count();if(0<a)return 4===t?N-=a:I-=a,T(de,[r],ne.EventsDiscardedReason.QueueFull),1}t++}return y(),0}(e.iKey,e.latency,i,r)&&(a=!p(e,n))),a&&b(de,[e],ne.EventsDiscardedReason.QueueFull)}function a(e,n,t){g(e,n,t),K.sendQueuedRequests(n,t)}function o(){0<=G&&g(G,0,F)&&K.sendQueuedRequests(0,F),0<N&&!Q&&!j&&0<=(e=z[D][2])&&(Q=s(function(){Q=null,a(4,0,1),o()},e));var e=z[D][1];!X&&!H&&0<=e&&!j&&(0<I?X=s(function(){X=null,a(0===W?3:1,0,1),W++,W%=2,o()},e):W=0)}function t(){L=!1,j=!(A=[]),q=500,U=1e4,z={},D=te,W=V=I=N=0,C=Q=X=H=x=null,J={},O=undefined,k=0,G=-1,Z=!(Y=!(F=null)),$=6,M=null,B=le(),K=new we(500,ee=2,1,{requeue:e,send:E,sent:S,drop:w,rspFail:R,oth:P},B),n(),J[4]={batches:[],iKeyMap:{}},J[3]={batches:[],iKeyMap:{}},J[2]={batches:[],iKeyMap:{}},J[1]={batches:[],iKeyMap:{}},_()}function s(e,n){0===n&&V&&(n=1);var t=1e3;return V&&(t=ye(V-1)),B.set(e,n*t)}function i(){return null!==X&&(B.clear(X),X=null,!(W=0))}function u(e,n){i(),H&&(B.clear(H),H=null),j||a(1,e,n)}function h(e,n,t){var i=J[n],n=(i=i||J[n=1]).iKeyMap[e];return!n&&t&&(n=oe.create(e),i.batches.push(n),i.iKeyMap[e]=n),n}function v(e,n){K.canSendRequest()&&!V&&(n=0<O&&O<I||n)&&null==H&&c.flush(e,null,20)}function p(e,n){var t=(e=Y?ne.optimizeObject(e):e).latency,i=h(e.iKey,t,!0);return i.addEvent(e)&&(4!==t?(I++,n&&0===e.sendAttempt&&v(!e.sync,0<k&&i.count()>=k)):N++,1)}function y(){for(var t=0,i=0,e=1;e<=4;e++)!function(n){var e=J[n];e&&e.batches&&ne.arrForEach(e.batches,function(e){4===n?t+=e.count():i+=e.count()})}(e);I=i,N=t}function g(i,e,n){var r=!1,t=0===e;return!t||K.canSendRequest()?ne.doPerf(c.core,function(){return"PostChannel._queueBatches"},function(){for(var n=[],t=4;i<=t;){var e=J[t];e&&e.batches&&0<e.batches.length&&(ne.arrForEach(e.batches,function(e){K.addBatch(e)?r=r||e&&0<e.count():n=n.concat(e.events()),4===t?N-=e.count():I-=e.count()}),e.batches=[],e.iKeyMap={}),t--}0<n.length&&b(de,n,ne.EventsDiscardedReason.KillSwitch),r&&i<=G&&(G=-1,F=0)},function(){return{latency:i,sendType:e,sendReason:n}},!t):(G=0<=G?Math.min(G,i):i,F=Math.max(F,n)),r}function n(){z={REAL_TIME:[2,1,0],NEAR_REAL_TIME:[6,3,0],BEST_EFFORT:[18,9,0]}}function e(e,n){var t=[],i=Z?ee:$;ne.arrForEach(e,function(e){e&&0<e.count()&&ne.arrForEach(e.events(),function(e){e&&(e.sync&&(e.latency=4,e.sync=!1),e.sendAttempt<i?(ne.setProcessTelemetryTimings(e,c.identifier),r(e,!1)):t.push(e))})}),0<t.length&&b(de,t,ne.EventsDiscardedReason.NonRetryableStatus),Z&&u(2,2)}function m(e,n){var t=c._notificationManager||{},i=t[e];if(i)try{i.apply(t,n)}catch(r){ne._throwInternal(c.diagLog(),1,74,e+" notification failed: "+r)}}function b(e,n){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];n&&0<n.length&&m(e,[n].concat(t))}function T(n,e){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];e&&0<e.length&&ne.arrForEach(e,function(e){e&&0<e.count()&&m(n,[e.events()].concat(t))})}function E(e,n,t){e&&0<e.length&&m("eventsSendRequest",[1e3<=n&&n<=1999?n-1e3:0,!0!==t])}function S(e,n){T("eventsSent",e,n),o()}function w(e,n){T(de,e,8e3<=n&&n<=8999?n-8e3:ne.EventsDiscardedReason.Unknown)}function R(e){T(de,e,ne.EventsDiscardedReason.NonRetryableStatus),o()}function P(e,n){T(de,e,ne.EventsDiscardedReason.Unknown),o()}function _(){k=x&&x.disableAutoBatchFlushLimit?0:Math.max(1500,U/6)}t(),c._getDbgPlgTargets=function(){return[K]},c.initialize=function(o,s,u){ne.doPerf(s,function(){return"PostChannel:initialize"},function(){var n,e=s;l.initialize(o,s,u);try{s.addUnloadCb,M=ne.mergeEvtNamespace(ne.createUniqueNamespace(c.identifier),s.evtNamespace&&s.evtNamespace());var t=c._getTelCtx(),i=(o.extensionConfig[c.identifier]=o.extensionConfig[c.identifier]||{},x=t.getExtCfg(c.identifier),B=le(x.setTimeoutOverride,x.clearTimeoutOverride),Y=!x.disableOptimizeObj&&ne.isChromium(),n=e.getWParam,e.getWParam=function(){var e=0;return x.ignoreMc1Ms0CookieProcessing&&(e|=2),e|n()},0<x.eventsLimitInMem&&(U=x.eventsLimitInMem),0<x.immediateEventLimit&&(q=x.immediateEventLimit),0<x.autoFlushEventsLimit&&(O=x.autoFlushEventsLimit),ne.isNumber(x[Re])&&($=x[Re]),ne.isNumber(x[Pe])&&(ee=x[Pe]),_(),x.httpXHROverride&&x.httpXHROverride.sendPOST&&(C=x.httpXHROverride),ne.isValueAssigned(o.anonCookieName)&&K.addQueryStringParameter("anoncknm",o.anonCookieName),K.sendHook=x.payloadPreprocessor,K.sendListener=x.payloadListener,x.overrideEndpointUrl||o.endpointUrl),r=(c._notificationManager=o.extensionConfig.NotificationManager,K.initialize(i,c.core,c,C,x),o.disablePageUnloadEvents||[]);ne.addPageUnloadEventListener(d,r,M),ne.addPageHideEventListener(d,r,M),ne.addPageShowEventListener(f,o.disablePageShowEvents,M)}catch(a){throw c.setInitialized(!1),a}},function(){return{coreConfig:o,core:s,extensions:u}})},c.processTelemetry=function(e,n){ne.setProcessTelemetryTimings(e,c.identifier);var t=(n=c._getTelCtx(n)).getExtCfg(c.identifier),i=!!x.disableTelemetry;(i=t?i||!!t.disableTelemetry:i)||L||(x[fe]&&(e.iKey=x[fe]),t&&t[fe]&&(e.iKey=t[fe]),r(e,!0),Z?u(2,2):o()),c.processNext(e,n)},c._doTeardown=function(e,n){u(2,2),L=!0,K.teardown(),ne.removePageUnloadEventListener(null,M),ne.removePageHideEventListener(null,M),ne.removePageShowEventListener(null,M),t()},c.setEventQueueLimits=function(e,n){U=0<e?e:1e4,O=0<n?n:0,_();var t=e<I;if(!t&&0<k)for(var i=1;!t&&i<=3;i++){var r=J[i];r&&r.batches&&ne.arrForEach(r.batches,function(e){e&&e.count()>=k&&(t=!0)})}v(!0,t)},c.pause=function(){i(),j=!0,K.pause()},c.resume=function(){j=!1,K.resume(),o()},c.addResponseHandler=function(e){K._responseHandlers.push(e)},c._loadTransmitProfiles=function(e){i(),n(),D=te,o(),ne.objForEachKey(e,function(e,n){var t,i=n.length;2<=i&&(t=2<i?n[2]:0,n.splice(0,i-2),n[1]<0&&(n[0]=-1),0<n[1]&&0<n[0]&&(i=n[0]/n[1],n[0]=Math.ceil(i)*n[1]),0<=t&&0<=n[1]&&t>n[1]&&(t=n[1]),n.push(t),z[e]=n)})},c.flush=function(e,n,t){void 0===e&&(e=!0),j||(t=t||1,e?null==H?(i(),g(1,0,t),H=s(function(){H=null,function i(e,n){a(1,0,n),y(),function t(e){K.isCompletelyIdle()?e():H=s(function(){H=null,t(e)},.25)}(function(){e&&e(),0<A.length?H=s(function(){H=null,i(A.shift(),n)},0):(H=null,o())})}(n,t)},0)):A.push(n):(e=i(),a(1,1,t),null!==n&&n!==undefined&&n(),e&&o()))},c.setMsaAuthTicket=function(e){K.addHeader(re,e)},c.hasEvents=function(){return 0<I},c._setTransmitProfile=function(e){D!==e&&z[e]!==undefined&&(i(),D=e,o())},c._backOffTransmission=function(){V<4&&(V++,i(),o())},c._clearBackOff=function(){V&&(V=0,i(),o())},ne.objDefineAccessors(c,"_setTimeoutOverride",function(){return B.set},function(e){B=le(e,B.clear)}),ne.objDefineAccessors(c,"_clearTimeoutOverride",function(){return B.clear},function(e){B=le(B.set,e)})}),e}e.BE_PROFILE="BEST_EFFORT",e.NRT_PROFILE="NEAR_REAL_TIME",e.PostChannel=t,e.RT_PROFILE=te;var l=e,i="__esModule",n={value:!0},t=Object.defineProperty;if(t)try{return void t(l,i,n)}catch(x){}typeof n.value!==undefined&&(l[i]=n.value)};"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("@microsoft/applicationinsights-shims"),require("@microsoft/dynamicproto-js"),require("@microsoft/1ds-core-js")):"function"==typeof define&&define.amd?define(["exports","@microsoft/applicationinsights-shims","@microsoft/dynamicproto-js","@microsoft/1ds-core-js"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).oneDS=e.oneDS||{},e.applicationinsightsShims,e.dynamicProto,e._1dsCoreJs);
//# sourceMappingURL=ms.post.min.js.map
