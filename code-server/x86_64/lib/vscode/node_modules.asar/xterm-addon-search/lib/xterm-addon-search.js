!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SearchAddon=t():e.SearchAddon=t()}(self,(function(){return(()=>{"use strict";var e={345:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.forwardEvent=t.EventEmitter=void 0,t.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=e=>(this._listeners.push(e),{dispose:()=>{if(!this._disposed)for(let t=0;t<this._listeners.length;t++)if(this._listeners[t]===e)return void this._listeners.splice(t,1)}})),this._event}fire(e,t){const s=[];for(let e=0;e<this._listeners.length;e++)s.push(this._listeners[e]);for(let i=0;i<s.length;i++)s[i].call(void 0,e,t)}dispose(){this._listeners&&(this._listeners.length=0),this._disposed=!0}},t.forwardEvent=function(e,t){return e((e=>t.fire(e)))}},859:(e,t)=>{function s(e){for(const t of e)t.dispose();e.length=0}Object.defineProperty(t,"__esModule",{value:!0}),t.getDisposeArrayDisposable=t.disposeArray=t.toDisposable=t.Disposable=void 0,t.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const e of this._disposables)e.dispose();this._disposables.length=0}register(e){return this._disposables.push(e),e}unregister(e){const t=this._disposables.indexOf(e);-1!==t&&this._disposables.splice(t,1)}},t.toDisposable=function(e){return{dispose:e}},t.disposeArray=s,t.getDisposeArrayDisposable=function(e){return{dispose:()=>s(e)}}}},t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,s),n.exports}var i={};return(()=>{var e=i;Object.defineProperty(e,"__esModule",{value:!0}),e.SearchAddon=void 0;const t=s(345),r=s(859),n=" ~!@#$%^&*()+`-=[]{}|\\;:\"',./<>?";class o extends r.Disposable{constructor(){super(...arguments),this._linesCacheTimeoutId=0,this._onDidChangeResults=this.register(new t.EventEmitter),this.onDidChangeResults=this._onDidChangeResults.event}activate(e){this._terminal=e,this._onDataDisposable=this.register(this._terminal.onWriteParsed((()=>this._updateMatches()))),this._onResizeDisposable=this.register(this._terminal.onResize((()=>this._updateMatches()))),this.register((0,r.toDisposable)((()=>{var e,t;this.clearDecorations(),null===(e=this._onDataDisposable)||void 0===e||e.dispose(),null===(t=this._onResizeDisposable)||void 0===t||t.dispose()})))}_updateMatches(){var e;this._highlightTimeout&&window.clearTimeout(this._highlightTimeout),this._cachedSearchTerm&&(null===(e=this._lastSearchOptions)||void 0===e?void 0:e.decorations)&&(this._highlightTimeout=setTimeout((()=>{var e,t;this.findPrevious(this._cachedSearchTerm,Object.assign(Object.assign({},this._lastSearchOptions),{incremental:!0,noScroll:!0})),this._resultIndex=this._searchResults?this._searchResults.size-1:-1,this._onDidChangeResults.fire({resultIndex:this._resultIndex,resultCount:null!==(t=null===(e=this._searchResults)||void 0===e?void 0:e.size)&&void 0!==t?t:-1})}),200))}clearDecorations(e){var t,s,i,r;null===(t=this._selectedDecoration)||void 0===t||t.dispose(),null===(s=this._searchResults)||void 0===s||s.clear(),null===(i=this._resultDecorations)||void 0===i||i.forEach((e=>{for(const t of e)t.dispose()})),null===(r=this._resultDecorations)||void 0===r||r.clear(),this._searchResults=void 0,this._resultDecorations=void 0,e||(this._cachedSearchTerm=void 0)}clearActiveDecoration(){var e;null===(e=this._selectedDecoration)||void 0===e||e.dispose(),this._selectedDecoration=void 0}findNext(e,t){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");return this._lastSearchOptions=t,(null==t?void 0:t.decorations)&&(void 0===this._resultIndex&&void 0!==this._cachedSearchTerm&&e===this._cachedSearchTerm||this._highlightAllMatches(e,t)),this._fireResults(e,this._findNextAndSelect(e,t),t)}_highlightAllMatches(e,t){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!e||0===e.length)return void this.clearDecorations();t=t||{},this.clearDecorations(!0),this._searchResults=new Map,this._resultDecorations=new Map;const s=this._resultDecorations;let i=this._find(e,0,0,t);for(;i&&!this._searchResults.get(`${i.row}-${i.col}`);)if(this._searchResults.set(`${i.row}-${i.col}`,i),i=this._find(e,i.col+i.term.length>=this._terminal.cols?i.row+1:i.row,i.col+i.term.length>=this._terminal.cols?0:i.col+1,t),this._searchResults.size>1e3)return this.clearDecorations(),void(this._resultIndex=void 0);this._searchResults.forEach((e=>{const i=this._createResultDecoration(e,t.decorations);if(i){const e=s.get(i.marker.line)||[];e.push(i),s.set(i.marker.line,e)}}))}_find(e,t,s,i){var r;if(!this._terminal||!e||0===e.length)return null===(r=this._terminal)||void 0===r||r.clearSelection(),void this.clearDecorations();if(s>this._terminal.cols)throw new Error(`Invalid col: ${s} to search in terminal of ${this._terminal.cols} cols`);let n;this._initLinesCache();const o={startRow:t,startCol:s};if(n=this._findInLine(e,o,i),!n)for(let s=t+1;s<this._terminal.buffer.active.baseY+this._terminal.rows&&(o.startRow=s,o.startCol=0,n=this._findInLine(e,o,i),!n);s++);return n}_findNextAndSelect(e,t){var s;if(!this._terminal||!e||0===e.length)return null===(s=this._terminal)||void 0===s||s.clearSelection(),this.clearDecorations(),this._cachedSearchTerm=void 0,this._resultIndex=-1,!1;this._cachedSearchTerm!==e&&(this._resultIndex=void 0,this._terminal.clearSelection());let i,r=0,n=0;if(this._terminal.hasSelection()){const e=!!t&&t.incremental;i=this._terminal.getSelectionPosition(),n=e?i.start.y:i.end.y,r=e?i.start.x:i.end.x}this._initLinesCache();const o={startRow:n,startCol:r};let l=this._findInLine(e,o,t);if(!l)for(let s=n+1;s<this._terminal.buffer.active.baseY+this._terminal.rows&&(o.startRow=s,o.startCol=0,l=this._findInLine(e,o,t),!l);s++);if(!l&&0!==n)for(let s=0;s<n&&(o.startRow=s,o.startCol=0,l=this._findInLine(e,o,t),!l);s++);return!l&&i&&(o.startRow=i.start.y,o.startCol=0,l=this._findInLine(e,o,t)),this._searchResults&&(0===this._searchResults.size?this._resultIndex=-1:void 0===this._resultIndex?this._resultIndex=0:(this._resultIndex++,this._resultIndex>=this._searchResults.size&&(this._resultIndex=0))),this._selectResult(l,null==t?void 0:t.decorations,null==t?void 0:t.noScroll)}findPrevious(e,t){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");return this._lastSearchOptions=t,(null==t?void 0:t.decorations)&&(void 0===this._resultIndex&&void 0!==this._cachedSearchTerm&&e===this._cachedSearchTerm||this._highlightAllMatches(e,t)),this._fireResults(e,this._findPreviousAndSelect(e,t),t)}_fireResults(e,t,s){var i;return(null==s?void 0:s.decorations)&&(void 0!==this._resultIndex&&void 0!==(null===(i=this._searchResults)||void 0===i?void 0:i.size)?this._onDidChangeResults.fire({resultIndex:this._resultIndex,resultCount:this._searchResults.size}):this._onDidChangeResults.fire(void 0)),this._cachedSearchTerm=e,t}_findPreviousAndSelect(e,t){var s;if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");let i;if(!this._terminal||!e||0===e.length)return i=void 0,null===(s=this._terminal)||void 0===s||s.clearSelection(),this.clearDecorations(),this._resultIndex=-1,!1;this._cachedSearchTerm!==e&&(this._resultIndex=void 0,this._terminal.clearSelection());let r=this._terminal.buffer.active.baseY+this._terminal.rows,n=this._terminal.cols;const o=!0,l=!!t&&t.incremental;let h;this._terminal.hasSelection()&&(h=this._terminal.getSelectionPosition(),r=h.start.y,n=h.start.x),this._initLinesCache();const a={startRow:r,startCol:n};if(l?(i=this._findInLine(e,a,t,!1),i&&i.row===r&&i.col===n||(h&&(a.startRow=h.end.y,a.startCol=h.end.x),i=this._findInLine(e,a,t,!0))):i=this._findInLine(e,a,t,o),!i){a.startCol=Math.max(a.startCol,this._terminal.cols);for(let s=r-1;s>=0&&(a.startRow=s,i=this._findInLine(e,a,t,o),!i);s--);}if(!i&&r!==this._terminal.buffer.active.baseY+this._terminal.rows)for(let s=this._terminal.buffer.active.baseY+this._terminal.rows;s>=r&&(a.startRow=s,i=this._findInLine(e,a,t,o),!i);s--);return this._searchResults&&(0===this._searchResults.size?this._resultIndex=-1:void 0===this._resultIndex||this._resultIndex<0?this._resultIndex=this._searchResults.size-1:(this._resultIndex--,-1===this._resultIndex&&(this._resultIndex=this._searchResults.size-1))),!(i||!h)||this._selectResult(i,null==t?void 0:t.decorations,null==t?void 0:t.noScroll)}_initLinesCache(){const e=this._terminal;this._linesCache||(this._linesCache=new Array(e.buffer.active.length),this._cursorMoveListener=e.onCursorMove((()=>this._destroyLinesCache())),this._resizeListener=e.onResize((()=>this._destroyLinesCache()))),window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=window.setTimeout((()=>this._destroyLinesCache()),15e3)}_destroyLinesCache(){this._linesCache=void 0,this._cursorMoveListener&&(this._cursorMoveListener.dispose(),this._cursorMoveListener=void 0),this._resizeListener&&(this._resizeListener.dispose(),this._resizeListener=void 0),this._linesCacheTimeoutId&&(window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=0)}_isWholeWord(e,t,s){return(0===e||n.includes(t[e-1]))&&(e+s.length===t.length||n.includes(t[e+s.length]))}_findInLine(e,t,s={},i=!1){var r;const n=this._terminal,o=t.startRow,l=t.startCol,h=n.buffer.active.getLine(o);if(null==h?void 0:h.isWrapped)return i?void(t.startCol+=n.cols):(t.startRow--,t.startCol+=n.cols,this._findInLine(e,t,s));let a=null===(r=this._linesCache)||void 0===r?void 0:r[o];a||(a=this._translateBufferLineToStringWithWrap(o,!0),this._linesCache&&(this._linesCache[o]=a));const[c,d]=a,u=this._bufferColsToStringOffset(o,l),_=s.caseSensitive?e:e.toLowerCase(),f=s.caseSensitive?c:c.toLowerCase();let v=-1;if(s.regex){const t=RegExp(_,"g");let s;if(i)for(;s=t.exec(f.slice(0,u));)v=t.lastIndex-s[0].length,e=s[0],t.lastIndex-=e.length-1;else s=t.exec(f.slice(u)),s&&s[0].length>0&&(v=u+(t.lastIndex-s[0].length),e=s[0])}else i?u-_.length>=0&&(v=f.lastIndexOf(_,u-_.length)):v=f.indexOf(_,u);if(v>=0){if(s.wholeWord&&!this._isWholeWord(v,f,e))return;let t=0;for(;t<d.length-1&&v>=d[t+1];)t++;let i=t;for(;i<d.length-1&&v+e.length>=d[i+1];)i++;const r=v-d[t],l=v+e.length-d[i],h=this._stringLengthToBufferSize(o+t,r);return{term:e,col:h,row:o+t,size:this._stringLengthToBufferSize(o+i,l)-h+n.cols*(i-t)}}}_stringLengthToBufferSize(e,t){const s=this._terminal.buffer.active.getLine(e);if(!s)return 0;for(let e=0;e<t;e++){const i=s.getCell(e);if(!i)break;const r=i.getChars();r.length>1&&(t-=r.length-1);const n=s.getCell(e+1);n&&0===n.getWidth()&&t++}return t}_bufferColsToStringOffset(e,t){const s=this._terminal;let i=e,r=0,n=s.buffer.active.getLine(i);for(;t>0&&n;){for(let e=0;e<t&&e<s.cols;e++){const t=n.getCell(e);if(!t)break;t.getWidth()&&(r+=0===t.getCode()?1:t.getChars().length)}if(i++,n=s.buffer.active.getLine(i),n&&!n.isWrapped)break;t-=s.cols}return r}_translateBufferLineToStringWithWrap(e,t){var s;const i=this._terminal,r=[],n=[0];let o=i.buffer.active.getLine(e);for(;o;){const l=i.buffer.active.getLine(e+1),h=!!l&&l.isWrapped;let a=o.translateToString(!h&&t);if(h&&l){const e=o.getCell(o.length-1);e&&0===e.getCode()&&1===e.getWidth()&&2===(null===(s=l.getCell(0))||void 0===s?void 0:s.getWidth())&&(a=a.slice(0,-1))}if(r.push(a),!h)break;n.push(n[n.length-1]+a.length),e++,o=l}return[r.join(""),n]}_selectResult(e,t,s){var i,r;const n=this._terminal;if(this.clearActiveDecoration(),!e)return n.clearSelection(),!1;if(n.select(e.col,e.row,e.size),t){const s=n.registerMarker(-n.buffer.active.baseY-n.buffer.active.cursorY+e.row);s&&(this._selectedDecoration=n.registerDecoration({marker:s,x:e.col,width:e.size,backgroundColor:t.activeMatchBackground,layer:"top",overviewRulerOptions:{color:t.activeMatchColorOverviewRuler}}),null===(i=this._selectedDecoration)||void 0===i||i.onRender((e=>this._applyStyles(e,t.activeMatchBorder,!0))),null===(r=this._selectedDecoration)||void 0===r||r.onDispose((()=>s.dispose())))}if(!s&&(e.row>=n.buffer.active.viewportY+n.rows||e.row<n.buffer.active.viewportY)){let t=e.row-n.buffer.active.viewportY;t-=Math.floor(n.rows/2),n.scrollLines(t)}return!0}_applyStyles(e,t,s){e.clientWidth<=0||(e.classList.contains("xterm-find-result-decoration")||(e.classList.add("xterm-find-result-decoration"),t&&(e.style.outline=`1px solid ${t}`)),s&&e.classList.add("xterm-find-active-result-decoration"))}_createResultDecoration(e,t){var s;const i=this._terminal,r=i.registerMarker(-i.buffer.active.baseY-i.buffer.active.cursorY+e.row);if(!r)return;const n=i.registerDecoration({marker:r,x:e.col,width:e.size,backgroundColor:t.matchBackground,overviewRulerOptions:(null===(s=this._resultDecorations)||void 0===s?void 0:s.get(r.line))?void 0:{color:t.matchOverviewRuler,position:"center"}});return null==n||n.onRender((e=>this._applyStyles(e,t.matchBorder,!1))),null==n||n.onDispose((()=>r.dispose())),n}}e.SearchAddon=o})(),i})()}));
//# sourceMappingURL=xterm-addon-search.js.map