"use strict";var io=Object.create;var xe=Object.defineProperty,oo=Object.defineProperties,ao=Object.getOwnPropertyDescriptor,co=Object.getOwnPropertyDescriptors,lo=Object.getOwnPropertyNames,Nr=Object.getOwnPropertySymbols,uo=Object.getPrototypeOf,Mr=Object.prototype.hasOwnProperty,fo=Object.prototype.propertyIsEnumerable;var Br=(t,e,r)=>e in t?xe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$e=(t,e)=>{for(var r in e||={})Mr.call(e,r)&&Br(t,r,e[r]);if(Nr)for(var r of Nr(e))fo.call(e,r)&&Br(t,r,e[r]);return t},Fr=(t,e)=>oo(t,co(e));var d=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),ho=(t,e)=>{for(var r in e)xe(t,r,{get:e[r],enumerable:!0})},Dr=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of lo(e))!Mr.call(t,n)&&n!==r&&xe(t,n,{get:()=>e[n],enumerable:!(s=ao(e,n))||s.enumerable});return t};var P=(t,e,r)=>(r=t!=null?io(uo(t)):{},Dr(e||!t||!t.__esModule?xe(r,"default",{value:t,enumerable:!0}):r,t)),po=t=>Dr(xe({},"__esModule",{value:!0}),t);var y=(t,e,r)=>new Promise((s,n)=>{var i=c=>{try{a(r.next(c))}catch(l){n(l)}},o=c=>{try{a(r.throw(c))}catch(l){n(l)}},a=c=>c.done?s(c.value):Promise.resolve(c.value).then(i,o);a((r=r.apply(t,e)).next())});var jr=d((yu,Gr)=>{"use strict";var{Duplex:mo}=require("stream");function $r(t){t.emit("close")}function go(){!this.destroyed&&this._writableState.finished&&this.destroy()}function Ur(t){this.removeListener("error",Ur),this.destroy(),this.listenerCount("error")===0&&this.emit("error",t)}function _o(t,e){let r=!0,s=new mo({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return t.on("message",function(i,o){let a=!o&&s._readableState.objectMode?i.toString():i;s.push(a)||t.pause()}),t.once("error",function(i){s.destroyed||(r=!1,s.destroy(i))}),t.once("close",function(){s.destroyed||s.push(null)}),s._destroy=function(n,i){if(t.readyState===t.CLOSED){i(n),process.nextTick($r,s);return}let o=!1;t.once("error",function(c){o=!0,i(c)}),t.once("close",function(){o||i(n),process.nextTick($r,s)}),r&&t.terminate()},s._final=function(n){if(t.readyState===t.CONNECTING){t.once("open",function(){s._final(n)});return}t._socket!==null&&(t._socket._writableState.finished?(n(),s._readableState.endEmitted&&s.destroy()):(t._socket.once("finish",function(){n()}),t.close()))},s._read=function(){t.isPaused&&t.resume()},s._write=function(n,i,o){if(t.readyState===t.CONNECTING){t.once("open",function(){s._write(n,i,o)});return}t.send(n,o)},s.on("end",go),s.on("error",Ur),s}Gr.exports=_o});var j=d((xu,Wr)=>{"use strict";Wr.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var Se=d((wu,Ge)=>{"use strict";var{EMPTY_BUFFER:yo}=j(),Nt=Buffer[Symbol.species];function xo(t,e){if(t.length===0)return yo;if(t.length===1)return t[0];let r=Buffer.allocUnsafe(e),s=0;for(let n=0;n<t.length;n++){let i=t[n];r.set(i,s),s+=i.length}return s<e?new Nt(r.buffer,r.byteOffset,s):r}function Vr(t,e,r,s,n){for(let i=0;i<n;i++)r[s+i]=t[i]^e[i&3]}function Hr(t,e){for(let r=0;r<t.length;r++)t[r]^=e[r&3]}function wo(t){return t.length===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.length)}function Bt(t){if(Bt.readOnly=!0,Buffer.isBuffer(t))return t;let e;return t instanceof ArrayBuffer?e=new Nt(t):ArrayBuffer.isView(t)?e=new Nt(t.buffer,t.byteOffset,t.byteLength):(e=Buffer.from(t),Bt.readOnly=!1),e}Ge.exports={concat:xo,mask:Vr,toArrayBuffer:wo,toBuffer:Bt,unmask:Hr};if(!process.env.WS_NO_BUFFER_UTIL)try{let t=require("bufferutil");Ge.exports.mask=function(e,r,s,n,i){i<48?Vr(e,r,s,n,i):t.mask(e,r,s,n,i)},Ge.exports.unmask=function(e,r){e.length<32?Hr(e,r):t.unmask(e,r)}}catch{}});var Xr=d((Su,Kr)=>{"use strict";var zr=Symbol("kDone"),Mt=Symbol("kRun"),Ft=class{constructor(e){this[zr]=()=>{this.pending--,this[Mt]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[Mt]()}[Mt](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[zr])}}};Kr.exports=Ft});var be=d((vu,Jr)=>{"use strict";var ve=require("zlib"),Yr=Se(),So=Xr(),{kStatusCode:Qr}=j(),vo=Buffer[Symbol.species],Eo=Buffer.from([0,0,255,255]),Ve=Symbol("permessage-deflate"),D=Symbol("total-length"),Ee=Symbol("callback"),W=Symbol("buffers"),We=Symbol("error"),je,Dt=class{constructor(e,r,s){if(this._maxPayload=s|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!r,this._deflate=null,this._inflate=null,this.params=null,!je){let n=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;je=new So(n)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[Ee];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let r=this._options,s=e.find(n=>!(r.serverNoContextTakeover===!1&&n.server_no_context_takeover||n.server_max_window_bits&&(r.serverMaxWindowBits===!1||typeof r.serverMaxWindowBits=="number"&&r.serverMaxWindowBits>n.server_max_window_bits)||typeof r.clientMaxWindowBits=="number"&&!n.client_max_window_bits));if(!s)throw new Error("None of the extension offers can be accepted");return r.serverNoContextTakeover&&(s.server_no_context_takeover=!0),r.clientNoContextTakeover&&(s.client_no_context_takeover=!0),typeof r.serverMaxWindowBits=="number"&&(s.server_max_window_bits=r.serverMaxWindowBits),typeof r.clientMaxWindowBits=="number"?s.client_max_window_bits=r.clientMaxWindowBits:(s.client_max_window_bits===!0||r.clientMaxWindowBits===!1)&&delete s.client_max_window_bits,s}acceptAsClient(e){let r=e[0];if(this._options.clientNoContextTakeover===!1&&r.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!r.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(r.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&r.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return r}normalizeParams(e){return e.forEach(r=>{Object.keys(r).forEach(s=>{let n=r[s];if(n.length>1)throw new Error(`Parameter "${s}" must have only a single value`);if(n=n[0],s==="client_max_window_bits"){if(n!==!0){let i=+n;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${s}": ${n}`);n=i}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${s}": ${n}`)}else if(s==="server_max_window_bits"){let i=+n;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${s}": ${n}`);n=i}else if(s==="client_no_context_takeover"||s==="server_no_context_takeover"){if(n!==!0)throw new TypeError(`Invalid value for parameter "${s}": ${n}`)}else throw new Error(`Unknown parameter "${s}"`);r[s]=n})}),e}decompress(e,r,s){je.add(n=>{this._decompress(e,r,(i,o)=>{n(),s(i,o)})})}compress(e,r,s){je.add(n=>{this._compress(e,r,(i,o)=>{n(),s(i,o)})})}_decompress(e,r,s){let n=this._isServer?"client":"server";if(!this._inflate){let i=`${n}_max_window_bits`,o=typeof this.params[i]!="number"?ve.Z_DEFAULT_WINDOWBITS:this.params[i];this._inflate=ve.createInflateRaw({...this._options.zlibInflateOptions,windowBits:o}),this._inflate[Ve]=this,this._inflate[D]=0,this._inflate[W]=[],this._inflate.on("error",Co),this._inflate.on("data",Zr)}this._inflate[Ee]=s,this._inflate.write(e),r&&this._inflate.write(Eo),this._inflate.flush(()=>{let i=this._inflate[We];if(i){this._inflate.close(),this._inflate=null,s(i);return}let o=Yr.concat(this._inflate[W],this._inflate[D]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[D]=0,this._inflate[W]=[],r&&this.params[`${n}_no_context_takeover`]&&this._inflate.reset()),s(null,o)})}_compress(e,r,s){let n=this._isServer?"server":"client";if(!this._deflate){let i=`${n}_max_window_bits`,o=typeof this.params[i]!="number"?ve.Z_DEFAULT_WINDOWBITS:this.params[i];this._deflate=ve.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:o}),this._deflate[D]=0,this._deflate[W]=[],this._deflate.on("data",bo)}this._deflate[Ee]=s,this._deflate.write(e),this._deflate.flush(ve.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let i=Yr.concat(this._deflate[W],this._deflate[D]);r&&(i=new vo(i.buffer,i.byteOffset,i.length-4)),this._deflate[Ee]=null,this._deflate[D]=0,this._deflate[W]=[],r&&this.params[`${n}_no_context_takeover`]&&this._deflate.reset(),s(null,i)})}};Jr.exports=Dt;function bo(t){this[W].push(t),this[D]+=t.length}function Zr(t){if(this[D]+=t.length,this[Ve]._maxPayload<1||this[D]<=this[Ve]._maxPayload){this[W].push(t);return}this[We]=new RangeError("Max payload size exceeded"),this[We].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[We][Qr]=1009,this.removeListener("data",Zr),this.reset()}function Co(t){this[Ve]._inflate=null,t[Qr]=1007,this[Ee](t)}});var Ce=d((Eu,He)=>{"use strict";var{isUtf8:es}=require("buffer"),Po=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Oo(t){return t>=1e3&&t<=1014&&t!==1004&&t!==1005&&t!==1006||t>=3e3&&t<=4999}function $t(t){let e=t.length,r=0;for(;r<e;)if(!(t[r]&128))r++;else if((t[r]&224)===192){if(r+1===e||(t[r+1]&192)!==128||(t[r]&254)===192)return!1;r+=2}else if((t[r]&240)===224){if(r+2>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||t[r]===224&&(t[r+1]&224)===128||t[r]===237&&(t[r+1]&224)===160)return!1;r+=3}else if((t[r]&248)===240){if(r+3>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||(t[r+3]&192)!==128||t[r]===240&&(t[r+1]&240)===128||t[r]===244&&t[r+1]>143||t[r]>244)return!1;r+=4}else return!1;return!0}He.exports={isValidStatusCode:Oo,isValidUTF8:$t,tokenChars:Po};if(es)He.exports.isValidUTF8=function(t){return t.length<24?$t(t):es(t)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let t=require("utf-8-validate");He.exports.isValidUTF8=function(e){return e.length<32?$t(e):t(e)}}catch{}});var Wt=d((bu,as)=>{"use strict";var{Writable:To}=require("stream"),ts=be(),{BINARY_TYPES:ko,EMPTY_BUFFER:rs,kStatusCode:Io,kWebSocket:Ao}=j(),{concat:Ut,toArrayBuffer:Ro,unmask:Lo}=Se(),{isValidStatusCode:qo,isValidUTF8:ss}=Ce(),ze=Buffer[Symbol.species],Pe=0,ns=1,is=2,os=3,Gt=4,No=5,jt=class extends To{constructor(e={}){super(),this._binaryType=e.binaryType||ko[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[Ao]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=Pe,this._loop=!1}_write(e,r,s){if(this._opcode===8&&this._state==Pe)return s();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(s)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let s=this._buffers[0];return this._buffers[0]=new ze(s.buffer,s.byteOffset+e,s.length-e),new ze(s.buffer,s.byteOffset,e)}let r=Buffer.allocUnsafe(e);do{let s=this._buffers[0],n=r.length-e;e>=s.length?r.set(this._buffers.shift(),n):(r.set(new Uint8Array(s.buffer,s.byteOffset,e),n),this._buffers[0]=new ze(s.buffer,s.byteOffset+e,s.length-e)),e-=s.length}while(e>0);return r}startLoop(e){let r;this._loop=!0;do switch(this._state){case Pe:r=this.getInfo();break;case ns:r=this.getPayloadLength16();break;case is:r=this.getPayloadLength64();break;case os:this.getMask();break;case Gt:r=this.getData(e);break;default:this._loop=!1;return}while(this._loop);e(r)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}let e=this.consume(2);if(e[0]&48)return this._loop=!1,S(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");let r=(e[0]&64)===64;if(r&&!this._extensions[ts.extensionName])return this._loop=!1,S(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=(e[0]&128)===128,this._opcode=e[0]&15,this._payloadLength=e[1]&127,this._opcode===0){if(r)return this._loop=!1,S(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,S(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,S(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=r}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,S(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(r)return this._loop=!1,S(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1)return this._loop=!1,S(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}else return this._loop=!1,S(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(e[1]&128)===128,this._isServer){if(!this._masked)return this._loop=!1,S(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,S(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(this._payloadLength===126)this._state=ns;else if(this._payloadLength===127)this._state=is;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}let e=this.consume(8),r=e.readUInt32BE(0);return r>Math.pow(2,53-32)-1?(this._loop=!1,S(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=r*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,S(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=os:this._state=Gt}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=Gt}getData(e){let r=rs;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}r=this.consume(this._payloadLength),this._masked&&this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3]&&Lo(r,this._mask)}if(this._opcode>7)return this.controlMessage(r);if(this._compressed){this._state=No,this.decompress(r,e);return}return r.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(r)),this.dataMessage()}decompress(e,r){this._extensions[ts.extensionName].decompress(e,this._fin,(n,i)=>{if(n)return r(n);if(i.length){if(this._messageLength+=i.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return r(S(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(i)}let o=this.dataMessage();if(o)return r(o);this.startLoop(r)})}dataMessage(){if(this._fin){let e=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let s;this._binaryType==="nodebuffer"?s=Ut(r,e):this._binaryType==="arraybuffer"?s=Ro(Ut(r,e)):s=r,this.emit("message",s,!0)}else{let s=Ut(r,e);if(!this._skipUTF8Validation&&!ss(s))return this._loop=!1,S(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",s,!1)}}this._state=Pe}controlMessage(e){if(this._opcode===8)if(this._loop=!1,e.length===0)this.emit("conclude",1005,rs),this.end();else{let r=e.readUInt16BE(0);if(!qo(r))return S(RangeError,`invalid status code ${r}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");let s=new ze(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!ss(s))return S(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",r,s),this.end()}else this._opcode===9?this.emit("ping",e):this.emit("pong",e);this._state=Pe}};as.exports=jt;function S(t,e,r,s,n){let i=new t(r?`Invalid WebSocket frame: ${e}`:e);return Error.captureStackTrace(i,S),i.code=n,i[Io]=s,i}});var Vt=d((Ou,us)=>{"use strict";var Cu=require("net"),Pu=require("tls"),{randomFillSync:Bo}=require("crypto"),cs=be(),{EMPTY_BUFFER:Mo}=j(),{isValidStatusCode:Fo}=Ce(),{mask:ls,toBuffer:te}=Se(),R=Symbol("kByteLength"),Do=Buffer.alloc(4),N=class{constructor(e,r,s){this._extensions=r||{},s&&(this._generateMask=s,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,r){let s,n=!1,i=2,o=!1;r.mask&&(s=r.maskBuffer||Do,r.generateMask?r.generateMask(s):Bo(s,0,4),o=(s[0]|s[1]|s[2]|s[3])===0,i=6);let a;typeof e=="string"?(!r.mask||o)&&r[R]!==void 0?a=r[R]:(e=Buffer.from(e),a=e.length):(a=e.length,n=r.mask&&r.readOnly&&!o);let c=a;a>=65536?(i+=8,c=127):a>125&&(i+=2,c=126);let l=Buffer.allocUnsafe(n?a+i:i);return l[0]=r.fin?r.opcode|128:r.opcode,r.rsv1&&(l[0]|=64),l[1]=c,c===126?l.writeUInt16BE(a,2):c===127&&(l[2]=l[3]=0,l.writeUIntBE(a,4,6)),r.mask?(l[1]|=128,l[i-4]=s[0],l[i-3]=s[1],l[i-2]=s[2],l[i-1]=s[3],o?[l,e]:n?(ls(e,s,l,i,a),[l]):(ls(e,s,e,0,a),[l,e])):[l,e]}close(e,r,s,n){let i;if(e===void 0)i=Mo;else{if(typeof e!="number"||!Fo(e))throw new TypeError("First argument must be a valid error code number");if(r===void 0||!r.length)i=Buffer.allocUnsafe(2),i.writeUInt16BE(e,0);else{let a=Buffer.byteLength(r);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");i=Buffer.allocUnsafe(2+a),i.writeUInt16BE(e,0),typeof r=="string"?i.write(r,2):i.set(r,2)}}let o={[R]:i.length,fin:!0,generateMask:this._generateMask,mask:s,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._deflating?this.enqueue([this.dispatch,i,!1,o,n]):this.sendFrame(N.frame(i,o),n)}ping(e,r,s){let n,i;if(typeof e=="string"?(n=Buffer.byteLength(e),i=!1):(e=te(e),n=e.length,i=te.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[R]:n,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,o,s]):this.sendFrame(N.frame(e,o),s)}pong(e,r,s){let n,i;if(typeof e=="string"?(n=Buffer.byteLength(e),i=!1):(e=te(e),n=e.length,i=te.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[R]:n,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,o,s]):this.sendFrame(N.frame(e,o),s)}send(e,r,s){let n=this._extensions[cs.extensionName],i=r.binary?2:1,o=r.compress,a,c;if(typeof e=="string"?(a=Buffer.byteLength(e),c=!1):(e=te(e),a=e.length,c=te.readOnly),this._firstFragment?(this._firstFragment=!1,o&&n&&n.params[n._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(o=a>=n._threshold),this._compress=o):(o=!1,i=0),r.fin&&(this._firstFragment=!0),n){let l={[R]:a,fin:r.fin,generateMask:this._generateMask,mask:r.mask,maskBuffer:this._maskBuffer,opcode:i,readOnly:c,rsv1:o};this._deflating?this.enqueue([this.dispatch,e,this._compress,l,s]):this.dispatch(e,this._compress,l,s)}else this.sendFrame(N.frame(e,{[R]:a,fin:r.fin,generateMask:this._generateMask,mask:r.mask,maskBuffer:this._maskBuffer,opcode:i,readOnly:c,rsv1:!1}),s)}dispatch(e,r,s,n){if(!r){this.sendFrame(N.frame(e,s),n);return}let i=this._extensions[cs.extensionName];this._bufferedBytes+=s[R],this._deflating=!0,i.compress(e,s.fin,(o,a)=>{if(this._socket.destroyed){let c=new Error("The socket was closed while data was being compressed");typeof n=="function"&&n(c);for(let l=0;l<this._queue.length;l++){let u=this._queue[l],f=u[u.length-1];typeof f=="function"&&f(c)}return}this._bufferedBytes-=s[R],this._deflating=!1,s.readOnly=!1,this.sendFrame(N.frame(a,s),n),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][R],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][R],this._queue.push(e)}sendFrame(e,r){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],r),this._socket.uncork()):this._socket.write(e[0],r)}};us.exports=N});var xs=d((Tu,ys)=>{"use strict";var{kForOnEventAttribute:Oe,kListener:Ht}=j(),fs=Symbol("kCode"),ds=Symbol("kData"),hs=Symbol("kError"),ps=Symbol("kMessage"),ms=Symbol("kReason"),re=Symbol("kTarget"),gs=Symbol("kType"),_s=Symbol("kWasClean"),$=class{constructor(e){this[re]=null,this[gs]=e}get target(){return this[re]}get type(){return this[gs]}};Object.defineProperty($.prototype,"target",{enumerable:!0});Object.defineProperty($.prototype,"type",{enumerable:!0});var K=class extends ${constructor(e,r={}){super(e),this[fs]=r.code===void 0?0:r.code,this[ms]=r.reason===void 0?"":r.reason,this[_s]=r.wasClean===void 0?!1:r.wasClean}get code(){return this[fs]}get reason(){return this[ms]}get wasClean(){return this[_s]}};Object.defineProperty(K.prototype,"code",{enumerable:!0});Object.defineProperty(K.prototype,"reason",{enumerable:!0});Object.defineProperty(K.prototype,"wasClean",{enumerable:!0});var se=class extends ${constructor(e,r={}){super(e),this[hs]=r.error===void 0?null:r.error,this[ps]=r.message===void 0?"":r.message}get error(){return this[hs]}get message(){return this[ps]}};Object.defineProperty(se.prototype,"error",{enumerable:!0});Object.defineProperty(se.prototype,"message",{enumerable:!0});var Te=class extends ${constructor(e,r={}){super(e),this[ds]=r.data===void 0?null:r.data}get data(){return this[ds]}};Object.defineProperty(Te.prototype,"data",{enumerable:!0});var $o={addEventListener(t,e,r={}){for(let n of this.listeners(t))if(!r[Oe]&&n[Ht]===e&&!n[Oe])return;let s;if(t==="message")s=function(i,o){let a=new Te("message",{data:o?i:i.toString()});a[re]=this,Ke(e,this,a)};else if(t==="close")s=function(i,o){let a=new K("close",{code:i,reason:o.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[re]=this,Ke(e,this,a)};else if(t==="error")s=function(i){let o=new se("error",{error:i,message:i.message});o[re]=this,Ke(e,this,o)};else if(t==="open")s=function(){let i=new $("open");i[re]=this,Ke(e,this,i)};else return;s[Oe]=!!r[Oe],s[Ht]=e,r.once?this.once(t,s):this.on(t,s)},removeEventListener(t,e){for(let r of this.listeners(t))if(r[Ht]===e&&!r[Oe]){this.removeListener(t,r);break}}};ys.exports={CloseEvent:K,ErrorEvent:se,Event:$,EventTarget:$o,MessageEvent:Te};function Ke(t,e,r){typeof t=="object"&&t.handleEvent?t.handleEvent.call(t,r):t.call(e,r)}});var zt=d((ku,ws)=>{"use strict";var{tokenChars:ke}=Ce();function B(t,e,r){t[e]===void 0?t[e]=[r]:t[e].push(r)}function Uo(t){let e=Object.create(null),r=Object.create(null),s=!1,n=!1,i=!1,o,a,c=-1,l=-1,u=-1,f=0;for(;f<t.length;f++)if(l=t.charCodeAt(f),o===void 0)if(u===-1&&ke[l]===1)c===-1&&(c=f);else if(f!==0&&(l===32||l===9))u===-1&&c!==-1&&(u=f);else if(l===59||l===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${f}`);u===-1&&(u=f);let _=t.slice(c,u);l===44?(B(e,_,r),r=Object.create(null)):o=_,c=u=-1}else throw new SyntaxError(`Unexpected character at index ${f}`);else if(a===void 0)if(u===-1&&ke[l]===1)c===-1&&(c=f);else if(l===32||l===9)u===-1&&c!==-1&&(u=f);else if(l===59||l===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${f}`);u===-1&&(u=f),B(r,t.slice(c,u),!0),l===44&&(B(e,o,r),r=Object.create(null),o=void 0),c=u=-1}else if(l===61&&c!==-1&&u===-1)a=t.slice(c,f),c=u=-1;else throw new SyntaxError(`Unexpected character at index ${f}`);else if(n){if(ke[l]!==1)throw new SyntaxError(`Unexpected character at index ${f}`);c===-1?c=f:s||(s=!0),n=!1}else if(i)if(ke[l]===1)c===-1&&(c=f);else if(l===34&&c!==-1)i=!1,u=f;else if(l===92)n=!0;else throw new SyntaxError(`Unexpected character at index ${f}`);else if(l===34&&t.charCodeAt(f-1)===61)i=!0;else if(u===-1&&ke[l]===1)c===-1&&(c=f);else if(c!==-1&&(l===32||l===9))u===-1&&(u=f);else if(l===59||l===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${f}`);u===-1&&(u=f);let _=t.slice(c,u);s&&(_=_.replace(/\\/g,""),s=!1),B(r,a,_),l===44&&(B(e,o,r),r=Object.create(null),o=void 0),a=void 0,c=u=-1}else throw new SyntaxError(`Unexpected character at index ${f}`);if(c===-1||i||l===32||l===9)throw new SyntaxError("Unexpected end of input");u===-1&&(u=f);let m=t.slice(c,u);return o===void 0?B(e,m,r):(a===void 0?B(r,m,!0):s?B(r,a,m.replace(/\\/g,"")):B(r,a,m),B(e,o,r)),e}function Go(t){return Object.keys(t).map(e=>{let r=t[e];return Array.isArray(r)||(r=[r]),r.map(s=>[e].concat(Object.keys(s).map(n=>{let i=s[n];return Array.isArray(i)||(i=[i]),i.map(o=>o===!0?n:`${n}=${o}`).join("; ")})).join("; ")).join(", ")}).join(", ")}ws.exports={format:Go,parse:Uo}});var Zt=d((Au,As)=>{"use strict";var jo=require("events"),Wo=require("https"),Vo=require("http"),Es=require("net"),Ho=require("tls"),{randomBytes:zo,createHash:Ko}=require("crypto"),{Readable:Iu}=require("stream"),{URL:Kt}=require("url"),V=be(),Xo=Wt(),Yo=Vt(),{BINARY_TYPES:Ss,EMPTY_BUFFER:Xe,GUID:Qo,kForOnEventAttribute:Xt,kListener:Zo,kStatusCode:Jo,kWebSocket:E,NOOP:bs}=j(),{EventTarget:{addEventListener:ea,removeEventListener:ta}}=xs(),{format:ra,parse:sa}=zt(),{toBuffer:na}=Se(),ia=30*1e3,Cs=Symbol("kAborted"),Yt=[8,13],U=["CONNECTING","OPEN","CLOSING","CLOSED"],oa=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,p=class extends jo{constructor(e,r,s){super(),this._binaryType=Ss[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=Xe,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=p.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,r===void 0?r=[]:Array.isArray(r)||(typeof r=="object"&&r!==null?(s=r,r=[]):r=[r]),Ps(this,e,r,s)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(e){Ss.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,r,s){let n=new Xo({binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:s.maxPayload,skipUTF8Validation:s.skipUTF8Validation});this._sender=new Yo(e,this._extensions,s.generateMask),this._receiver=n,this._socket=e,n[E]=this,e[E]=this,n.on("conclude",la),n.on("drain",ua),n.on("error",fa),n.on("message",da),n.on("ping",ha),n.on("pong",pa),e.setTimeout(0),e.setNoDelay(),r.length>0&&e.unshift(r),e.on("close",Ts),e.on("data",Qe),e.on("end",ks),e.on("error",Is),this._readyState=p.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=p.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[V.extensionName]&&this._extensions[V.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=p.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,r){if(this.readyState!==p.CLOSED){if(this.readyState===p.CONNECTING){let s="WebSocket was closed before the connection was established";O(this,this._req,s);return}if(this.readyState===p.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=p.CLOSING,this._sender.close(e,r,!this._isServer,s=>{s||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),ia)}}pause(){this.readyState===p.CONNECTING||this.readyState===p.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,r,s){if(this.readyState===p.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(s=e,e=r=void 0):typeof r=="function"&&(s=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==p.OPEN){Qt(this,e,s);return}r===void 0&&(r=!this._isServer),this._sender.ping(e||Xe,r,s)}pong(e,r,s){if(this.readyState===p.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(s=e,e=r=void 0):typeof r=="function"&&(s=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==p.OPEN){Qt(this,e,s);return}r===void 0&&(r=!this._isServer),this._sender.pong(e||Xe,r,s)}resume(){this.readyState===p.CONNECTING||this.readyState===p.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,r,s){if(this.readyState===p.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"&&(s=r,r={}),typeof e=="number"&&(e=e.toString()),this.readyState!==p.OPEN){Qt(this,e,s);return}let n={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...r};this._extensions[V.extensionName]||(n.compress=!1),this._sender.send(e||Xe,n,s)}terminate(){if(this.readyState!==p.CLOSED){if(this.readyState===p.CONNECTING){let e="WebSocket was closed before the connection was established";O(this,this._req,e);return}this._socket&&(this._readyState=p.CLOSING,this._socket.destroy())}}};Object.defineProperty(p,"CONNECTING",{enumerable:!0,value:U.indexOf("CONNECTING")});Object.defineProperty(p.prototype,"CONNECTING",{enumerable:!0,value:U.indexOf("CONNECTING")});Object.defineProperty(p,"OPEN",{enumerable:!0,value:U.indexOf("OPEN")});Object.defineProperty(p.prototype,"OPEN",{enumerable:!0,value:U.indexOf("OPEN")});Object.defineProperty(p,"CLOSING",{enumerable:!0,value:U.indexOf("CLOSING")});Object.defineProperty(p.prototype,"CLOSING",{enumerable:!0,value:U.indexOf("CLOSING")});Object.defineProperty(p,"CLOSED",{enumerable:!0,value:U.indexOf("CLOSED")});Object.defineProperty(p.prototype,"CLOSED",{enumerable:!0,value:U.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(t=>{Object.defineProperty(p.prototype,t,{enumerable:!0})});["open","error","close","message"].forEach(t=>{Object.defineProperty(p.prototype,`on${t}`,{enumerable:!0,get(){for(let e of this.listeners(t))if(e[Xt])return e[Zo];return null},set(e){for(let r of this.listeners(t))if(r[Xt]){this.removeListener(t,r);break}typeof e=="function"&&this.addEventListener(t,e,{[Xt]:!0})}})});p.prototype.addEventListener=ea;p.prototype.removeEventListener=ta;As.exports=p;function Ps(t,e,r,s){let n={protocolVersion:Yt[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...s,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(!Yt.includes(n.protocolVersion))throw new RangeError(`Unsupported protocol version: ${n.protocolVersion} (supported versions: ${Yt.join(", ")})`);let i;if(e instanceof Kt)i=e,t._url=e.href;else{try{i=new Kt(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}t._url=e}let o=i.protocol==="wss:",a=i.protocol==="ws+unix:",c;if(i.protocol!=="ws:"&&!o&&!a?c=`The URL's protocol must be one of "ws:", "wss:", or "ws+unix:"`:a&&!i.pathname?c="The URL's pathname is empty":i.hash&&(c="The URL contains a fragment identifier"),c){let h=new SyntaxError(c);if(t._redirects===0)throw h;Ye(t,h);return}let l=o?443:80,u=zo(16).toString("base64"),f=o?Wo.request:Vo.request,m=new Set,_;if(n.createConnection=o?ca:aa,n.defaultPort=n.defaultPort||l,n.port=i.port||l,n.host=i.hostname.startsWith("[")?i.hostname.slice(1,-1):i.hostname,n.headers={...n.headers,"Sec-WebSocket-Version":n.protocolVersion,"Sec-WebSocket-Key":u,Connection:"Upgrade",Upgrade:"websocket"},n.path=i.pathname+i.search,n.timeout=n.handshakeTimeout,n.perMessageDeflate&&(_=new V(n.perMessageDeflate!==!0?n.perMessageDeflate:{},!1,n.maxPayload),n.headers["Sec-WebSocket-Extensions"]=ra({[V.extensionName]:_.offer()})),r.length){for(let h of r){if(typeof h!="string"||!oa.test(h)||m.has(h))throw new SyntaxError("An invalid or duplicated subprotocol was specified");m.add(h)}n.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(n.origin&&(n.protocolVersion<13?n.headers["Sec-WebSocket-Origin"]=n.origin:n.headers.Origin=n.origin),(i.username||i.password)&&(n.auth=`${i.username}:${i.password}`),a){let h=n.path.split(":");n.socketPath=h[0],n.path=h[1]}let g;if(n.followRedirects){if(t._redirects===0){t._originalIpc=a,t._originalSecure=o,t._originalHostOrSocketPath=a?n.socketPath:i.host;let h=s&&s.headers;if(s={...s,headers:{}},h)for(let[w,A]of Object.entries(h))s.headers[w.toLowerCase()]=A}else if(t.listenerCount("redirect")===0){let h=a?t._originalIpc?n.socketPath===t._originalHostOrSocketPath:!1:t._originalIpc?!1:i.host===t._originalHostOrSocketPath;(!h||t._originalSecure&&!o)&&(delete n.headers.authorization,delete n.headers.cookie,h||delete n.headers.host,n.auth=void 0)}n.auth&&!s.headers.authorization&&(s.headers.authorization="Basic "+Buffer.from(n.auth).toString("base64")),g=t._req=f(n),t._redirects&&t.emit("redirect",t.url,g)}else g=t._req=f(n);n.timeout&&g.on("timeout",()=>{O(t,g,"Opening handshake has timed out")}),g.on("error",h=>{g===null||g[Cs]||(g=t._req=null,Ye(t,h))}),g.on("response",h=>{let w=h.headers.location,A=h.statusCode;if(w&&n.followRedirects&&A>=300&&A<400){if(++t._redirects>n.maxRedirects){O(t,g,"Maximum redirects exceeded");return}g.abort();let F;try{F=new Kt(w,e)}catch{let q=new SyntaxError(`Invalid URL: ${w}`);Ye(t,q);return}Ps(t,F,r,s)}else t.emit("unexpected-response",g,h)||O(t,g,`Unexpected server response: ${h.statusCode}`)}),g.on("upgrade",(h,w,A)=>{if(t.emit("upgrade",h),t.readyState!==p.CONNECTING)return;if(g=t._req=null,h.headers.upgrade.toLowerCase()!=="websocket"){O(t,w,"Invalid Upgrade header");return}let F=Ko("sha1").update(u+Qo).digest("base64");if(h.headers["sec-websocket-accept"]!==F){O(t,w,"Invalid Sec-WebSocket-Accept header");return}let z=h.headers["sec-websocket-protocol"],q;if(z!==void 0?m.size?m.has(z)||(q="Server sent an invalid subprotocol"):q="Server sent a subprotocol but none was requested":m.size&&(q="Server sent no subprotocol"),q){O(t,w,q);return}z&&(t._protocol=z);let _e=h.headers["sec-websocket-extensions"];if(_e!==void 0){if(!_){O(t,w,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let ee;try{ee=sa(_e)}catch{O(t,w,"Invalid Sec-WebSocket-Extensions header");return}let ye=Object.keys(ee);if(ye.length!==1||ye[0]!==V.extensionName){O(t,w,"Server indicated an extension that was not requested");return}try{_.accept(ee[V.extensionName])}catch{O(t,w,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[V.extensionName]=_}t.setSocket(w,A,{generateMask:n.generateMask,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation})}),n.finishRequest?n.finishRequest(g,t):g.end()}function Ye(t,e){t._readyState=p.CLOSING,t.emit("error",e),t.emitClose()}function aa(t){return t.path=t.socketPath,Es.connect(t)}function ca(t){return t.path=void 0,!t.servername&&t.servername!==""&&(t.servername=Es.isIP(t.host)?"":t.host),Ho.connect(t)}function O(t,e,r){t._readyState=p.CLOSING;let s=new Error(r);Error.captureStackTrace(s,O),e.setHeader?(e[Cs]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(Ye,t,s)):(e.destroy(s),e.once("error",t.emit.bind(t,"error")),e.once("close",t.emitClose.bind(t)))}function Qt(t,e,r){if(e){let s=na(e).length;t._socket?t._sender._bufferedBytes+=s:t._bufferedAmount+=s}if(r){let s=new Error(`WebSocket is not open: readyState ${t.readyState} (${U[t.readyState]})`);process.nextTick(r,s)}}function la(t,e){let r=this[E];r._closeFrameReceived=!0,r._closeMessage=e,r._closeCode=t,r._socket[E]!==void 0&&(r._socket.removeListener("data",Qe),process.nextTick(Os,r._socket),t===1005?r.close():r.close(t,e))}function ua(){let t=this[E];t.isPaused||t._socket.resume()}function fa(t){let e=this[E];e._socket[E]!==void 0&&(e._socket.removeListener("data",Qe),process.nextTick(Os,e._socket),e.close(t[Jo])),e.emit("error",t)}function vs(){this[E].emitClose()}function da(t,e){this[E].emit("message",t,e)}function ha(t){let e=this[E];e.pong(t,!e._isServer,bs),e.emit("ping",t)}function pa(t){this[E].emit("pong",t)}function Os(t){t.resume()}function Ts(){let t=this[E];this.removeListener("close",Ts),this.removeListener("data",Qe),this.removeListener("end",ks),t._readyState=p.CLOSING;let e;!this._readableState.endEmitted&&!t._closeFrameReceived&&!t._receiver._writableState.errorEmitted&&(e=t._socket.read())!==null&&t._receiver.write(e),t._receiver.end(),this[E]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",vs),t._receiver.on("finish",vs))}function Qe(t){this[E]._receiver.write(t)||this.pause()}function ks(){let t=this[E];t._readyState=p.CLOSING,t._receiver.end(),this.end()}function Is(){let t=this[E];this.removeListener("error",Is),this.on("error",bs),t&&(t._readyState=p.CLOSING,this.destroy())}});var Ls=d((Ru,Rs)=>{"use strict";var{tokenChars:ma}=Ce();function ga(t){let e=new Set,r=-1,s=-1,n=0;for(n;n<t.length;n++){let o=t.charCodeAt(n);if(s===-1&&ma[o]===1)r===-1&&(r=n);else if(n!==0&&(o===32||o===9))s===-1&&r!==-1&&(s=n);else if(o===44){if(r===-1)throw new SyntaxError(`Unexpected character at index ${n}`);s===-1&&(s=n);let a=t.slice(r,s);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),r=s=-1}else throw new SyntaxError(`Unexpected character at index ${n}`)}if(r===-1||s!==-1)throw new SyntaxError("Unexpected end of input");let i=t.slice(r,n);if(e.has(i))throw new SyntaxError(`The "${i}" subprotocol is duplicated`);return e.add(i),e}Rs.exports={parse:ga}});var $s=d((Bu,Ds)=>{"use strict";var _a=require("events"),Ze=require("http"),Lu=require("https"),qu=require("net"),Nu=require("tls"),{createHash:ya}=require("crypto"),qs=zt(),X=be(),xa=Ls(),wa=Zt(),{GUID:Sa,kWebSocket:va}=j(),Ea=/^[+/0-9A-Za-z]{22}==$/,Ns=0,Bs=1,Fs=2,Jt=class extends _a{constructor(e,r){if(super(),e={maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:wa,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=Ze.createServer((s,n)=>{let i=Ze.STATUS_CODES[426];n.writeHead(426,{"Content-Length":i.length,"Content-Type":"text/plain"}),n.end(i)}),this._server.listen(e.port,e.host,e.backlog,r)):e.server&&(this._server=e.server),this._server){let s=this.emit.bind(this,"connection");this._removeListeners=ba(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(n,i,o)=>{this.handleUpgrade(n,i,o,s)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=Ns}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===Fs){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(Ie,this);return}if(e&&this.once("close",e),this._state!==Bs)if(this._state=Bs,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(Ie,this):process.nextTick(Ie,this);else{let r=this._server;this._removeListeners(),this._removeListeners=this._server=null,r.close(()=>{Ie(this)})}}shouldHandle(e){if(this.options.path){let r=e.url.indexOf("?");if((r!==-1?e.url.slice(0,r):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,r,s,n){r.on("error",Ms);let i=e.headers["sec-websocket-key"],o=+e.headers["sec-websocket-version"];if(e.method!=="GET"){Y(this,e,r,405,"Invalid HTTP method");return}if(e.headers.upgrade.toLowerCase()!=="websocket"){Y(this,e,r,400,"Invalid Upgrade header");return}if(!i||!Ea.test(i)){Y(this,e,r,400,"Missing or invalid Sec-WebSocket-Key header");return}if(o!==8&&o!==13){Y(this,e,r,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(e)){Ae(r,400);return}let a=e.headers["sec-websocket-protocol"],c=new Set;if(a!==void 0)try{c=xa.parse(a)}catch{Y(this,e,r,400,"Invalid Sec-WebSocket-Protocol header");return}let l=e.headers["sec-websocket-extensions"],u={};if(this.options.perMessageDeflate&&l!==void 0){let f=new X(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let m=qs.parse(l);m[X.extensionName]&&(f.accept(m[X.extensionName]),u[X.extensionName]=f)}catch{Y(this,e,r,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let f={origin:e.headers[`${o===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(f,(m,_,g,h)=>{if(!m)return Ae(r,_||401,g,h);this.completeUpgrade(u,i,c,e,r,s,n)});return}if(!this.options.verifyClient(f))return Ae(r,401)}this.completeUpgrade(u,i,c,e,r,s,n)}completeUpgrade(e,r,s,n,i,o,a){if(!i.readable||!i.writable)return i.destroy();if(i[va])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>Ns)return Ae(i,503);let l=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${ya("sha1").update(r+Sa).digest("base64")}`],u=new this.options.WebSocket(null);if(s.size){let f=this.options.handleProtocols?this.options.handleProtocols(s,n):s.values().next().value;f&&(l.push(`Sec-WebSocket-Protocol: ${f}`),u._protocol=f)}if(e[X.extensionName]){let f=e[X.extensionName].params,m=qs.format({[X.extensionName]:[f]});l.push(`Sec-WebSocket-Extensions: ${m}`),u._extensions=e}this.emit("headers",l,n),i.write(l.concat(`\r
`).join(`\r
`)),i.removeListener("error",Ms),u.setSocket(i,o,{maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(u),u.on("close",()=>{this.clients.delete(u),this._shouldEmitClose&&!this.clients.size&&process.nextTick(Ie,this)})),a(u,n)}};Ds.exports=Jt;function ba(t,e){for(let r of Object.keys(e))t.on(r,e[r]);return function(){for(let s of Object.keys(e))t.removeListener(s,e[s])}}function Ie(t){t._state=Fs,t.emit("close")}function Ms(){this.destroy()}function Ae(t,e,r,s){r=r||Ze.STATUS_CODES[e],s={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...s},t.once("finish",t.destroy),t.end(`HTTP/1.1 ${e} ${Ze.STATUS_CODES[e]}\r
`+Object.keys(s).map(n=>`${n}: ${s[n]}`).join(`\r
`)+`\r
\r
`+r)}function Y(t,e,r,s,n){if(t.listenerCount("wsClientError")){let i=new Error(n);Error.captureStackTrace(i,Y),t.emit("wsClientError",i,r,e)}else Ae(r,s,n)}});var Ks=d((Gu,zs)=>{"use strict";var{Transform:Ia}=require("stream"),{StringDecoder:Aa}=require("string_decoder"),H=Symbol("last"),tt=Symbol("decoder");function Ra(t,e,r){let s;if(this.overflow){if(s=this[tt].write(t).split(this.matcher),s.length===1)return r();s.shift(),this.overflow=!1}else this[H]+=this[tt].write(t),s=this[H].split(this.matcher);this[H]=s.pop();for(let n=0;n<s.length;n++)try{Hs(this,this.mapper(s[n]))}catch(i){return r(i)}if(this.overflow=this[H].length>this.maxLength,this.overflow&&!this.skipOverflow){r(new Error("maximum buffer reached"));return}r()}function La(t){if(this[H]+=this[tt].end(),this[H])try{Hs(this,this.mapper(this[H]))}catch(e){return t(e)}t()}function Hs(t,e){e!==void 0&&t.push(e)}function Vs(t){return t}function qa(t,e,r){switch(t=t||/\r?\n/,e=e||Vs,r=r||{},arguments.length){case 1:typeof t=="function"?(e=t,t=/\r?\n/):typeof t=="object"&&!(t instanceof RegExp)&&!t[Symbol.split]&&(r=t,t=/\r?\n/);break;case 2:typeof t=="function"?(r=e,e=t,t=/\r?\n/):typeof e=="object"&&(r=e,e=Vs)}r=Object.assign({},r),r.autoDestroy=!0,r.transform=Ra,r.flush=La,r.readableObjectMode=!0;let s=new Ia(r);return s[H]="",s[tt]=new Aa("utf8"),s.matcher=t,s.mapper=e,s.maxLength=r.maxLength,s.skipOverflow=r.skipOverflow||!1,s.overflow=!1,s._destroy=function(n,i){this._writableState.errorEmitted=!1,i(n)},s}zs.exports=qa});var G=d(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.findWindowsCandidates=b.sort=b.preferredEdgePath=b.preferredFirefoxPath=b.preferredChromePath=b.escapeRegexSpecialChars=b.canAccess=void 0;var Ma=require("path");async function Le({access:t},e){if(!e)return!1;try{return await t(e),!0}catch{return!1}}b.canAccess=Le;var Fa="/\\.?*()^${}|[]+";function Da(t,e){let r=Fa.split("").filter(n=>!e||e.indexOf(n)<0).join("").replace(/[\\\]]/g,"\\$&"),s=new RegExp(`[${r}]`,"g");return t.replace(s,"\\$&")}b.escapeRegexSpecialChars=Da;async function $a(t,e){if(await Le(t,e.CHROME_PATH))return e.CHROME_PATH}b.preferredChromePath=$a;async function Ua(t,e){if(await Le(t,e.FIREFOX_PATH))return e.FIREFOX_PATH}b.preferredFirefoxPath=Ua;async function Ga(t,e){if(await Le(t,e.EDGE_PATH))return e.EDGE_PATH}b.preferredEdgePath=Ga;function ja(t,e){return[...t].filter(s=>!!s).map(s=>{let n=e.find(i=>i.regex.test(s));return n?{path:s,weight:n.weight,quality:n.quality}:{path:s,weight:10,quality:"dev"}}).sort((s,n)=>n.weight-s.weight).map(s=>({path:s.path,quality:s.quality}))}b.sort=ja;async function Wa(t,e,r){let s=[t.LOCALAPPDATA,t.PROGRAMFILES,t["PROGRAMFILES(X86)"]].filter(i=>!!i),n=[];for(let i of s)for(let o of r){let a=Ma.win32.join(i,o.name);n.push(Le(e,a).then(c=>c?{path:a,quality:o.type}:void 0))}return(await Promise.all(n)).filter(i=>!!i)}b.findWindowsCandidates=Wa});var it=d(nt=>{"use strict";Object.defineProperty(nt,"__esModule",{value:!0});nt.DarwinFinderBase=void 0;var Va=require("path"),Ha=require("fs"),rr=G(),tn=/( \(0x[a-f0-9]+\))/,sr=class{constructor(e=process.env,r=Ha.promises,s=s){this.env=e,this.fs=r,this.execa=s,this.lsRegisterCommand="/System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/LaunchServices.framework/Versions/A/Support/lsregister -dump",this.wellKnownPaths=[]}async findWhere(e){for(let r of this.wellKnownPaths)if(e(r)&&await(0,rr.canAccess)(this.fs,r.path))return r;return(await this.findAll()).find(e)}findAll(){var e;return(e=this.foundAll)!==null&&e!==void 0||(this.foundAll=this.findAllInner()),this.foundAll}async findLaunchRegisteredApps(e,r,s){let{stdout:n}=await this.execa.command(`${this.lsRegisterCommand} | awk 'tolower($0) ~ /${e.toLowerCase()}${tn.source}?$/ { $1=""; print $0 }'`,{shell:!0,stdio:"pipe"}),i=[...r,...n.split(`
`).map(c=>c.trim().replace(tn,""))].filter(c=>!!c),o=this.getPreferredPath();o&&i.push(o);let a=new Set;for(let c of i)for(let l of s){let u=Va.posix.join(c.trim(),l);try{await this.fs.access(u),a.add(u)}catch{}}return a}createPriorities(e){let r=this.env.HOME&&(0,rr.escapeRegexSpecialChars)(this.env.HOME),s=this.getPreferredPath(),n=e.reduce((i,o)=>[...i,{regex:new RegExp(`^/Applications/.*${o.name}`),weight:o.weight+100,quality:o.quality},{regex:new RegExp(`^${r}/Applications/.*${o.name}`),weight:o.weight,quality:o.quality},{regex:new RegExp(`^/Volumes/.*${o.name}`),weight:o.weight-100,quality:o.quality}],[]);return s&&n.unshift({regex:new RegExp((0,rr.escapeRegexSpecialChars)(s)),weight:151,quality:"custom"}),n}};nt.DarwinFinderBase=sr});var rn=d(ot=>{"use strict";Object.defineProperty(ot,"__esModule",{value:!0});ot.DarwinChromeBrowserFinder=void 0;var za=G(),Ka=it(),nr=class extends Ka.DarwinFinderBase{constructor(){super(...arguments),this.wellKnownPaths=[{path:"/Applications/Google Chrome.app/Contents/MacOS/Google Chrome",quality:"stable"},{path:"/Applications/Google Chrome Canary.app/Contents/MacOS/Google Chrome Canary",quality:"canary"},{path:"/Applications/Google Chrome Beta.app/Contents/MacOS/Google Chrome Beta",quality:"beta"},{path:"/Applications/Google Chrome Dev.app/Contents/MacOS/Google Chrome Dev",quality:"dev"}]}async findAllInner(){let e=["/Contents/MacOS/Google Chrome Canary","/Contents/MacOS/Google Chrome Beta","/Contents/MacOS/Google Chrome Dev","/Contents/MacOS/Google Chrome"],r=["/Applications/Google Chrome.app","/Applications/Google Chrome Canary.app"],s=await this.findLaunchRegisteredApps("google chrome[A-Za-z() ]*.app",r,e);return(0,za.sort)(s,this.createPriorities([{name:"Chrome.app",weight:0,quality:"stable"},{name:"Chrome Canary.app",weight:1,quality:"canary"},{name:"Chrome Beta.app",weight:2,quality:"beta"},{name:"Chrome Dev.app",weight:3,quality:"dev"}]))}getPreferredPath(){return this.env.CHROME_PATH}};ot.DarwinChromeBrowserFinder=nr});var sn=d(at=>{"use strict";Object.defineProperty(at,"__esModule",{value:!0});at.DarwinEdgeBrowserFinder=void 0;var Xa=G(),Ya=it(),ir=class extends Ya.DarwinFinderBase{constructor(){super(...arguments),this.wellKnownPaths=[{path:"/Applications/Microsoft Edge.app/Contents/MacOS/Microsoft Edge",quality:"stable"},{path:"/Applications/Microsoft Edge Canary.app/Contents/MacOS/Microsoft Edge Canary",quality:"canary"},{path:"/Applications/Microsoft Edge Beta.app/Contents/MacOS/Microsoft Edge Beta",quality:"beta"},{path:"/Applications/Microsoft Edge Dev.app/Contents/MacOS/Microsoft Edge Dev",quality:"dev"}]}async findAllInner(){let e=["/Contents/MacOS/Microsoft Edge Canary","/Contents/MacOS/Microsoft Edge Beta","/Contents/MacOS/Microsoft Edge Dev","/Contents/MacOS/Microsoft Edge"],r=["/Applications/Microsoft Edge.app"],s=await this.findLaunchRegisteredApps("Microsoft Edge[A-Za-z ]*.app",r,e);return(0,Xa.sort)(s,this.createPriorities([{name:"Microsoft Edge.app",weight:0,quality:"stable"},{name:"Microsoft Edge Canary.app",weight:1,quality:"canary"},{name:"Microsoft Edge Beta.app",weight:2,quality:"beta"},{name:"Microsoft Edge Dev.app",weight:3,quality:"dev"}]))}getPreferredPath(){return this.env.EDGE_PATH}};at.DarwinEdgeBrowserFinder=ir});var nn=d(ct=>{"use strict";Object.defineProperty(ct,"__esModule",{value:!0});ct.DarwinFirefoxBrowserFinder=void 0;var Qa=G(),Za=it(),or=class extends Za.DarwinFinderBase{constructor(){super(...arguments),this.wellKnownPaths=[{path:"/Applications/Firefox.app/Contents/MacOS/firefox",quality:"stable"},{path:"/Applications/Firefox Developer Edition.app/Contents/MacOS/firefox",quality:"dev"},{path:"/Applications/Firefox Nightly.app/Contents/MacOS/firefox",quality:"canary"}]}async findAllInner(){let e=["/Contents/MacOS/firefox"],r=["/Applications/Firefox.app"],s=await this.findLaunchRegisteredApps("Firefox[A-Za-z ]*.app",r,e);return(0,Qa.sort)(s,this.createPriorities([{name:"Firefox.app",weight:0,quality:"stable"},{name:"Firefox Nightly.app",weight:1,quality:"canary"},{name:"Firefox Developer Edition.app",weight:2,quality:"dev"}]))}getPreferredPath(){return this.env.FIREFOX_PATH}};ct.DarwinFirefoxBrowserFinder=or});var ut=d(lt=>{"use strict";Object.defineProperty(lt,"__esModule",{value:!0});lt.LinuxChromeBrowserFinder=void 0;var Ja=require("path"),oe=G(),ar=require("child_process"),ec=require("os"),tc=require("fs"),on=/\r?\n/,cr=class{constructor(e=process.env,r=tc.promises){this.env=e,this.fs=r,this.pathEnvironmentVar="CHROME_PATH",this.priorities=[{regex:/chrome-wrapper$/,weight:54,quality:"custom"},{regex:/google-chrome-dev$/,weight:53,quality:"dev"},{regex:/google-chrome-canary$/,weight:52,quality:"canary"},{regex:/google-chrome-unstable$/,weight:51,quality:"canary"},{regex:/google-chrome-canary$/,weight:51,quality:"canary"},{regex:/google-chrome-stable$/,weight:50,quality:"stable"},{regex:/google-chrome$/,weight:49,quality:"stable"},{regex:/chromium-browser$/,weight:48,quality:"custom"},{regex:/chromium$/,weight:47,quality:"custom"}],this.executablesOnPath=["google-chrome-unstable","google-chrome-dev","google-chrome-beta","google-chrome-canary","google-chrome-stable","google-chrome","chromium-browser","chromium"]}async findWhere(e){return(await this.findAll()).find(e)}async findAll(){let e=new Set,r=this.env[this.pathEnvironmentVar];r&&await(0,oe.canAccess)(this.fs,r)&&e.add(r),[Ja.posix.join((0,ec.homedir)(),".local/share/applications/"),"/usr/share/applications/","/usr/bin"].forEach(o=>{for(let a in this.findChromeExecutables(o))e.add(a)}),await Promise.all(this.executablesOnPath.map(async o=>{try{let a=(0,ar.execFileSync)("which",[o],{stdio:"pipe"}).toString().split(on)[0];await(0,oe.canAccess)(this.fs,a)&&e.add(a)}catch{}}));let i=r?[{regex:new RegExp((0,oe.escapeRegexSpecialChars)(r)),weight:101,quality:"custom"}].concat(this.priorities):this.priorities;return(0,oe.sort)(e,i)}async findChromeExecutables(e){let r=/(^[^ ]+).*/,s=`^Exec=/.*/(${this.executablesOnPath.join("|")})-.*`,n=[];if(await(0,oe.canAccess)(this.fs,e)){let i;try{i=(0,ar.execSync)(`grep -ER "${s}" ${e} | awk -F '=' '{print $2}'`)}catch{i=(0,ar.execSync)(`grep -Er "${s}" ${e} | awk -F '=' '{print $2}'`)}let o=i.toString().split(on).map(a=>a.replace(r,"$1"));await Promise.all(o.map(async a=>{await(0,oe.canAccess)(this.fs,a)&&n.push(a)}))}return n}};lt.LinuxChromeBrowserFinder=cr});var an=d(ft=>{"use strict";Object.defineProperty(ft,"__esModule",{value:!0});ft.LinuxEdgeBrowserFinder=void 0;var rc=ut(),lr=class extends rc.LinuxChromeBrowserFinder{constructor(){super(...arguments),this.pathEnvironmentVar="EDGE_PATH",this.executablesOnPath=["microsoft-edge-dev","microsoft-edge-beta","microsoft-edge-stable","microsoft-edge"],this.priorities=[{regex:/microsoft-edge\-wrapper$/,weight:52,quality:"custom"},{regex:/microsoft-edge\-dev$/,weight:51,quality:"dev"},{regex:/microsoft-edge\-beta$/,weight:51,quality:"beta"},{regex:/microsoft-edge\-stable$/,weight:50,quality:"stable"},{regex:/microsoft-edge$/,weight:49,quality:"stable"}]}};ft.LinuxEdgeBrowserFinder=lr});var cn=d(dt=>{"use strict";Object.defineProperty(dt,"__esModule",{value:!0});dt.LinuxFirefoxBrowserFinder=void 0;var sc=ut(),ur=class extends sc.LinuxChromeBrowserFinder{constructor(){super(...arguments),this.pathEnvironmentVar="FIREFOX_PATH",this.executablesOnPath=["firefox-aurora","firefox-dev","firefox-developer","firefox-trunk","firefox-nightly","firefox"],this.priorities=[{regex:/firefox\-aurora$/,weight:51,quality:"dev"},{regex:/firefox\-dev$/,weight:51,quality:"dev"},{regex:/firefox\-developer$/,weight:51,quality:"dev"},{regex:/firefox\-trunk'$/,weight:50,quality:"canary"},{regex:/firefox\-nightly'$/,weight:50,quality:"canary"},{regex:/firefox$/,weight:49,quality:"stable"}]}};dt.LinuxFirefoxBrowserFinder=ur});var un=d(ht=>{"use strict";Object.defineProperty(ht,"__esModule",{value:!0});ht.WindowsChromeBrowserFinder=void 0;var nc=require("path"),ln=G(),ic=require("fs"),fr=class{constructor(e=process.env,r=ic.promises){this.env=e,this.fs=r}async findWhere(e){return(await this.findAll()).find(e)}async findAll(){let e=nc.win32.sep,r=[{name:`${e}Google${e}Chrome Dev${e}Application${e}chrome.exe`,type:"dev"},{name:`${e}Google${e}Chrome SxS${e}Application${e}chrome.exe`,type:"canary"},{name:`${e}Google${e}Chrome Beta${e}Application${e}chrome.exe`,type:"beta"},{name:`${e}Google${e}Chrome${e}Application${e}chrome.exe`,type:"stable"}],s=await(0,ln.findWindowsCandidates)(this.env,this.fs,r),n=await(0,ln.preferredChromePath)(this.fs,this.env);return n&&s.unshift({path:n,quality:"custom"}),s}};ht.WindowsChromeBrowserFinder=fr});var dn=d(pt=>{"use strict";Object.defineProperty(pt,"__esModule",{value:!0});pt.WindowsEdgeBrowserFinder=void 0;var C=require("path"),oc=require("fs"),fn=G(),dr=class{constructor(e=process.env,r=oc.promises){this.env=e,this.fs=r}async findWhere(e){return(await this.findAll()).find(e)}async findAll(){let e=[{name:`${C.sep}Microsoft${C.sep}Edge SxS${C.sep}Application${C.sep}msedge.exe`,type:"canary"},{name:`${C.sep}Microsoft${C.sep}Edge Dev${C.sep}Application${C.sep}msedge.exe`,type:"dev"},{name:`${C.sep}Microsoft${C.sep}Edge Beta${C.sep}Application${C.sep}msedge.exe`,type:"beta"},{name:`${C.sep}Microsoft${C.sep}Edge${C.sep}Application${C.sep}msedge.exe`,type:"stable"}],r=await(0,fn.findWindowsCandidates)(this.env,this.fs,e),s=await(0,fn.preferredEdgePath)(this.fs,this.env);return s&&r.unshift({path:s,quality:"custom"}),r}};pt.WindowsEdgeBrowserFinder=dr});var pn=d(mt=>{"use strict";Object.defineProperty(mt,"__esModule",{value:!0});mt.WindowsFirefoxBrowserFinder=void 0;var ac=require("path"),hn=G(),cc=require("fs"),hr=class{constructor(e=process.env,r=cc.promises){this.env=e,this.fs=r}async findWhere(e){return(await this.findAll()).find(e)}async findAll(){let e=ac.win32.sep,r=[{name:`${e}Firefox Developer Edition${e}firefox.exe`,type:"dev"},{name:`${e}Firefox Nightly${e}firefox.exe`,type:"canary"},{name:`${e}Mozilla Firefox${e}firefox.exe`,type:"stable"}],s=await(0,hn.findWindowsCandidates)(this.env,this.fs,r),n=await(0,hn.preferredFirefoxPath)(this.fs,this.env);return n&&s.unshift({path:n,quality:"custom"}),s}};mt.WindowsFirefoxBrowserFinder=hr});var mn=d(k=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0});k.FirefoxBrowserFinder=k.EdgeBrowserFinder=k.ChromeBrowserFinder=k.isQuality=k.allQualities=void 0;var lc=rn(),uc=sn(),fc=nn(),dc=ut(),hc=an(),pc=cn(),mc=un(),gc=dn(),_c=pn(),yc={canary:null,stable:null,beta:null,dev:null,custom:null};k.allQualities=new Set(Object.keys(yc));var xc=t=>k.allQualities.has(t);k.isQuality=xc;k.ChromeBrowserFinder=process.platform==="win32"?mc.WindowsChromeBrowserFinder:process.platform==="darwin"?lc.DarwinChromeBrowserFinder:dc.LinuxChromeBrowserFinder;k.EdgeBrowserFinder=process.platform==="win32"?gc.WindowsEdgeBrowserFinder:process.platform==="darwin"?uc.DarwinEdgeBrowserFinder:hc.LinuxEdgeBrowserFinder;k.FirefoxBrowserFinder=process.platform==="win32"?_c.WindowsFirefoxBrowserFinder:process.platform==="darwin"?fc.DarwinFirefoxBrowserFinder:pc.LinuxFirefoxBrowserFinder});var wn=d((hf,xn)=>{xn.exports=yn;yn.sync=Sc;var gn=require("fs");function wc(t,e){var r=e.pathExt!==void 0?e.pathExt:process.env.PATHEXT;if(!r||(r=r.split(";"),r.indexOf("")!==-1))return!0;for(var s=0;s<r.length;s++){var n=r[s].toLowerCase();if(n&&t.substr(-n.length).toLowerCase()===n)return!0}return!1}function _n(t,e,r){return!t.isSymbolicLink()&&!t.isFile()?!1:wc(e,r)}function yn(t,e,r){gn.stat(t,function(s,n){r(s,s?!1:_n(n,t,e))})}function Sc(t,e){return _n(gn.statSync(t),t,e)}});var Cn=d((pf,bn)=>{bn.exports=vn;vn.sync=vc;var Sn=require("fs");function vn(t,e,r){Sn.stat(t,function(s,n){r(s,s?!1:En(n,e))})}function vc(t,e){return En(Sn.statSync(t),e)}function En(t,e){return t.isFile()&&Ec(t,e)}function Ec(t,e){var r=t.mode,s=t.uid,n=t.gid,i=e.uid!==void 0?e.uid:process.getuid&&process.getuid(),o=e.gid!==void 0?e.gid:process.getgid&&process.getgid(),a=parseInt("100",8),c=parseInt("010",8),l=parseInt("001",8),u=a|c,f=r&l||r&c&&n===o||r&a&&s===i||r&u&&i===0;return f}});var On=d((gf,Pn)=>{var mf=require("fs"),gt;process.platform==="win32"||global.TESTING_WINDOWS?gt=wn():gt=Cn();Pn.exports=pr;pr.sync=bc;function pr(t,e,r){if(typeof e=="function"&&(r=e,e={}),!r){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(s,n){pr(t,e||{},function(i,o){i?n(i):s(o)})})}gt(t,e||{},function(s,n){s&&(s.code==="EACCES"||e&&e.ignoreErrors)&&(s=null,n=!1),r(s,n)})}function bc(t,e){try{return gt.sync(t,e||{})}catch(r){if(e&&e.ignoreErrors||r.code==="EACCES")return!1;throw r}}});var qn=d((_f,Ln)=>{var ae=process.platform==="win32"||process.env.OSTYPE==="cygwin"||process.env.OSTYPE==="msys",Tn=require("path"),Cc=ae?";":":",kn=On(),In=t=>Object.assign(new Error(`not found: ${t}`),{code:"ENOENT"}),An=(t,e)=>{let r=e.colon||Cc,s=t.match(/\//)||ae&&t.match(/\\/)?[""]:[...ae?[process.cwd()]:[],...(e.path||process.env.PATH||"").split(r)],n=ae?e.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM":"",i=ae?n.split(r):[""];return ae&&t.indexOf(".")!==-1&&i[0]!==""&&i.unshift(""),{pathEnv:s,pathExt:i,pathExtExe:n}},Rn=(t,e,r)=>{typeof e=="function"&&(r=e,e={}),e||(e={});let{pathEnv:s,pathExt:n,pathExtExe:i}=An(t,e),o=[],a=l=>new Promise((u,f)=>{if(l===s.length)return e.all&&o.length?u(o):f(In(t));let m=s[l],_=/^".*"$/.test(m)?m.slice(1,-1):m,g=Tn.join(_,t),h=!_&&/^\.[\\\/]/.test(t)?t.slice(0,2)+g:g;u(c(h,l,0))}),c=(l,u,f)=>new Promise((m,_)=>{if(f===n.length)return m(a(u+1));let g=n[f];kn(l+g,{pathExt:i},(h,w)=>{if(!h&&w)if(e.all)o.push(l+g);else return m(l+g);return m(c(l,u,f+1))})});return r?a(0).then(l=>r(null,l),r):a(0)},Pc=(t,e)=>{e=e||{};let{pathEnv:r,pathExt:s,pathExtExe:n}=An(t,e),i=[];for(let o=0;o<r.length;o++){let a=r[o],c=/^".*"$/.test(a)?a.slice(1,-1):a,l=Tn.join(c,t),u=!c&&/^\.[\\\/]/.test(t)?t.slice(0,2)+l:l;for(let f=0;f<s.length;f++){let m=u+s[f];try{if(kn.sync(m,{pathExt:n}))if(e.all)i.push(m);else return m}catch{}}}if(e.all&&i.length)return i;if(e.nothrow)return null;throw In(t)};Ln.exports=Rn;Rn.sync=Pc});var gr=d((yf,mr)=>{"use strict";var Nn=(t={})=>{let e=t.env||process.env;return(t.platform||process.platform)!=="win32"?"PATH":Object.keys(e).reverse().find(s=>s.toUpperCase()==="PATH")||"Path"};mr.exports=Nn;mr.exports.default=Nn});var Dn=d((xf,Fn)=>{"use strict";var Bn=require("path"),Oc=qn(),Tc=gr();function Mn(t,e){let r=t.options.env||process.env,s=process.cwd(),n=t.options.cwd!=null,i=n&&process.chdir!==void 0&&!process.chdir.disabled;if(i)try{process.chdir(t.options.cwd)}catch{}let o;try{o=Oc.sync(t.command,{path:r[Tc({env:r})],pathExt:e?Bn.delimiter:void 0})}catch{}finally{i&&process.chdir(s)}return o&&(o=Bn.resolve(n?t.options.cwd:"",o)),o}function kc(t){return Mn(t)||Mn(t,!0)}Fn.exports=kc});var $n=d((wf,yr)=>{"use strict";var _r=/([()\][%!^"`<>&|;, *?])/g;function Ic(t){return t=t.replace(_r,"^$1"),t}function Ac(t,e){return t=`${t}`,t=t.replace(/(\\*)"/g,'$1$1\\"'),t=t.replace(/(\\*)$/,"$1$1"),t=`"${t}"`,t=t.replace(_r,"^$1"),e&&(t=t.replace(_r,"^$1")),t}yr.exports.command=Ic;yr.exports.argument=Ac});var Gn=d((Sf,Un)=>{"use strict";Un.exports=/^#!(.*)/});var Wn=d((vf,jn)=>{"use strict";var Rc=Gn();jn.exports=(t="")=>{let e=t.match(Rc);if(!e)return null;let[r,s]=e[0].replace(/#! ?/,"").split(" "),n=r.split("/").pop();return n==="env"?s:s?`${n} ${s}`:n}});var Hn=d((Ef,Vn)=>{"use strict";var xr=require("fs"),Lc=Wn();function qc(t){let r=Buffer.alloc(150),s;try{s=xr.openSync(t,"r"),xr.readSync(s,r,0,150,0),xr.closeSync(s)}catch{}return Lc(r.toString())}Vn.exports=qc});var Yn=d((bf,Xn)=>{"use strict";var Nc=require("path"),zn=Dn(),Kn=$n(),Bc=Hn(),Mc=process.platform==="win32",Fc=/\.(?:com|exe)$/i,Dc=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function $c(t){t.file=zn(t);let e=t.file&&Bc(t.file);return e?(t.args.unshift(t.file),t.command=e,zn(t)):t.file}function Uc(t){if(!Mc)return t;let e=$c(t),r=!Fc.test(e);if(t.options.forceShell||r){let s=Dc.test(e);t.command=Nc.normalize(t.command),t.command=Kn.command(t.command),t.args=t.args.map(i=>Kn.argument(i,s));let n=[t.command].concat(t.args).join(" ");t.args=["/d","/s","/c",`"${n}"`],t.command=process.env.comspec||"cmd.exe",t.options.windowsVerbatimArguments=!0}return t}function Gc(t,e,r){e&&!Array.isArray(e)&&(r=e,e=null),e=e?e.slice(0):[],r=Object.assign({},r);let s={command:t,args:e,options:r,file:void 0,original:{command:t,args:e}};return r.shell?s:Uc(s)}Xn.exports=Gc});var Jn=d((Cf,Zn)=>{"use strict";var wr=process.platform==="win32";function Sr(t,e){return Object.assign(new Error(`${e} ${t.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${e} ${t.command}`,path:t.command,spawnargs:t.args})}function jc(t,e){if(!wr)return;let r=t.emit;t.emit=function(s,n){if(s==="exit"){let i=Qn(n,e,"spawn");if(i)return r.call(t,"error",i)}return r.apply(t,arguments)}}function Qn(t,e){return wr&&t===1&&!e.file?Sr(e.original,"spawn"):null}function Wc(t,e){return wr&&t===1&&!e.file?Sr(e.original,"spawnSync"):null}Zn.exports={hookChildProcess:jc,verifyENOENT:Qn,verifyENOENTSync:Wc,notFoundError:Sr}});var ri=d((Pf,ce)=>{"use strict";var ei=require("child_process"),vr=Yn(),Er=Jn();function ti(t,e,r){let s=vr(t,e,r),n=ei.spawn(s.command,s.args,s.options);return Er.hookChildProcess(n,s),n}function Vc(t,e,r){let s=vr(t,e,r),n=ei.spawnSync(s.command,s.args,s.options);return n.error=n.error||Er.verifyENOENTSync(n.status,s),n}ce.exports=ti;ce.exports.spawn=ti;ce.exports.sync=Vc;ce.exports._parse=vr;ce.exports._enoent=Er});var ni=d((Of,si)=>{"use strict";si.exports=t=>{let e=typeof t=="string"?`
`:`
`.charCodeAt(),r=typeof t=="string"?"\r":"\r".charCodeAt();return t[t.length-1]===e&&(t=t.slice(0,t.length-1)),t[t.length-1]===r&&(t=t.slice(0,t.length-1)),t}});var ai=d((Tf,Ne)=>{"use strict";var qe=require("path"),ii=gr(),oi=t=>{t={cwd:process.cwd(),path:process.env[ii()],execPath:process.execPath,...t};let e,r=qe.resolve(t.cwd),s=[];for(;e!==r;)s.push(qe.join(r,"node_modules/.bin")),e=r,r=qe.resolve(r,"..");let n=qe.resolve(t.cwd,t.execPath,"..");return s.push(n),s.concat(t.path).join(qe.delimiter)};Ne.exports=oi;Ne.exports.default=oi;Ne.exports.env=t=>{t={env:process.env,...t};let e={...t.env},r=ii({env:e});return t.path=e[r],e[r]=Ne.exports(t),e}});var li=d((kf,br)=>{"use strict";var ci=(t,e)=>{for(let r of Reflect.ownKeys(e))Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r));return t};br.exports=ci;br.exports.default=ci});var fi=d((If,yt)=>{"use strict";var Hc=li(),_t=new WeakMap,ui=(t,e={})=>{if(typeof t!="function")throw new TypeError("Expected a function");let r,s=0,n=t.displayName||t.name||"<anonymous>",i=function(...o){if(_t.set(i,++s),s===1)r=t.apply(this,o),t=null;else if(e.throw===!0)throw new Error(`Function \`${n}\` can only be called once`);return r};return Hc(i,t),_t.set(i,s),i};yt.exports=ui;yt.exports.default=ui;yt.exports.callCount=t=>{if(!_t.has(t))throw new Error(`The given function \`${t.name}\` is not wrapped by the \`onetime\` package`);return _t.get(t)}});var di=d(xt=>{"use strict";Object.defineProperty(xt,"__esModule",{value:!0});xt.SIGNALS=void 0;var zc=[{name:"SIGHUP",number:1,action:"terminate",description:"Terminal closed",standard:"posix"},{name:"SIGINT",number:2,action:"terminate",description:"User interruption with CTRL-C",standard:"ansi"},{name:"SIGQUIT",number:3,action:"core",description:"User interruption with CTRL-\\",standard:"posix"},{name:"SIGILL",number:4,action:"core",description:"Invalid machine instruction",standard:"ansi"},{name:"SIGTRAP",number:5,action:"core",description:"Debugger breakpoint",standard:"posix"},{name:"SIGABRT",number:6,action:"core",description:"Aborted",standard:"ansi"},{name:"SIGIOT",number:6,action:"core",description:"Aborted",standard:"bsd"},{name:"SIGBUS",number:7,action:"core",description:"Bus error due to misaligned, non-existing address or paging error",standard:"bsd"},{name:"SIGEMT",number:7,action:"terminate",description:"Command should be emulated but is not implemented",standard:"other"},{name:"SIGFPE",number:8,action:"core",description:"Floating point arithmetic error",standard:"ansi"},{name:"SIGKILL",number:9,action:"terminate",description:"Forced termination",standard:"posix",forced:!0},{name:"SIGUSR1",number:10,action:"terminate",description:"Application-specific signal",standard:"posix"},{name:"SIGSEGV",number:11,action:"core",description:"Segmentation fault",standard:"ansi"},{name:"SIGUSR2",number:12,action:"terminate",description:"Application-specific signal",standard:"posix"},{name:"SIGPIPE",number:13,action:"terminate",description:"Broken pipe or socket",standard:"posix"},{name:"SIGALRM",number:14,action:"terminate",description:"Timeout or timer",standard:"posix"},{name:"SIGTERM",number:15,action:"terminate",description:"Termination",standard:"ansi"},{name:"SIGSTKFLT",number:16,action:"terminate",description:"Stack is empty or overflowed",standard:"other"},{name:"SIGCHLD",number:17,action:"ignore",description:"Child process terminated, paused or unpaused",standard:"posix"},{name:"SIGCLD",number:17,action:"ignore",description:"Child process terminated, paused or unpaused",standard:"other"},{name:"SIGCONT",number:18,action:"unpause",description:"Unpaused",standard:"posix",forced:!0},{name:"SIGSTOP",number:19,action:"pause",description:"Paused",standard:"posix",forced:!0},{name:"SIGTSTP",number:20,action:"pause",description:'Paused using CTRL-Z or "suspend"',standard:"posix"},{name:"SIGTTIN",number:21,action:"pause",description:"Background process cannot read terminal input",standard:"posix"},{name:"SIGBREAK",number:21,action:"terminate",description:"User interruption with CTRL-BREAK",standard:"other"},{name:"SIGTTOU",number:22,action:"pause",description:"Background process cannot write to terminal output",standard:"posix"},{name:"SIGURG",number:23,action:"ignore",description:"Socket received out-of-band data",standard:"bsd"},{name:"SIGXCPU",number:24,action:"core",description:"Process timed out",standard:"bsd"},{name:"SIGXFSZ",number:25,action:"core",description:"File too big",standard:"bsd"},{name:"SIGVTALRM",number:26,action:"terminate",description:"Timeout or timer",standard:"bsd"},{name:"SIGPROF",number:27,action:"terminate",description:"Timeout or timer",standard:"bsd"},{name:"SIGWINCH",number:28,action:"ignore",description:"Terminal window size changed",standard:"bsd"},{name:"SIGIO",number:29,action:"terminate",description:"I/O is available",standard:"other"},{name:"SIGPOLL",number:29,action:"terminate",description:"Watched event",standard:"other"},{name:"SIGINFO",number:29,action:"ignore",description:"Request for process information",standard:"other"},{name:"SIGPWR",number:30,action:"terminate",description:"Device running out of power",standard:"systemv"},{name:"SIGSYS",number:31,action:"core",description:"Invalid system call",standard:"other"},{name:"SIGUNUSED",number:31,action:"terminate",description:"Invalid system call",standard:"other"}];xt.SIGNALS=zc});var Cr=d(le=>{"use strict";Object.defineProperty(le,"__esModule",{value:!0});le.SIGRTMAX=le.getRealtimeSignals=void 0;var Kc=function(){let t=pi-hi+1;return Array.from({length:t},Xc)};le.getRealtimeSignals=Kc;var Xc=function(t,e){return{name:`SIGRT${e+1}`,number:hi+e,action:"terminate",description:"Application-specific signal (realtime)",standard:"posix"}},hi=34,pi=64;le.SIGRTMAX=pi});var mi=d(wt=>{"use strict";Object.defineProperty(wt,"__esModule",{value:!0});wt.getSignals=void 0;var Yc=require("os"),Qc=di(),Zc=Cr(),Jc=function(){let t=(0,Zc.getRealtimeSignals)();return[...Qc.SIGNALS,...t].map(el)};wt.getSignals=Jc;var el=function({name:t,number:e,description:r,action:s,forced:n=!1,standard:i}){let{signals:{[t]:o}}=Yc.constants,a=o!==void 0;return{name:t,number:a?o:e,description:r,supported:a,action:s,forced:n,standard:i}}});var _i=d(ue=>{"use strict";Object.defineProperty(ue,"__esModule",{value:!0});ue.signalsByNumber=ue.signalsByName=void 0;var tl=require("os"),gi=mi(),rl=Cr(),sl=function(){return(0,gi.getSignals)().reduce(nl,{})},nl=function(t,{name:e,number:r,description:s,supported:n,action:i,forced:o,standard:a}){return{...t,[e]:{name:e,number:r,description:s,supported:n,action:i,forced:o,standard:a}}},il=sl();ue.signalsByName=il;var ol=function(){let t=(0,gi.getSignals)(),e=rl.SIGRTMAX+1,r=Array.from({length:e},(s,n)=>al(n,t));return Object.assign({},...r)},al=function(t,e){let r=cl(t,e);if(r===void 0)return{};let{name:s,description:n,supported:i,action:o,forced:a,standard:c}=r;return{[t]:{name:s,number:t,description:n,supported:i,action:o,forced:a,standard:c}}},cl=function(t,e){let r=e.find(({name:s})=>tl.constants.signals[s]===t);return r!==void 0?r:e.find(s=>s.number===t)},ll=ol();ue.signalsByNumber=ll});var xi=d((Nf,yi)=>{"use strict";var{signalsByName:ul}=_i(),fl=({timedOut:t,timeout:e,errorCode:r,signal:s,signalDescription:n,exitCode:i,isCanceled:o})=>t?`timed out after ${e} milliseconds`:o?"was canceled":r!==void 0?`failed with ${r}`:s!==void 0?`was killed with ${s} (${n})`:i!==void 0?`failed with exit code ${i}`:"failed",dl=({stdout:t,stderr:e,all:r,error:s,signal:n,exitCode:i,command:o,escapedCommand:a,timedOut:c,isCanceled:l,killed:u,parsed:{options:{timeout:f}}})=>{i=i===null?void 0:i,n=n===null?void 0:n;let m=n===void 0?void 0:ul[n].description,_=s&&s.code,h=`Command ${fl({timedOut:c,timeout:f,errorCode:_,signal:n,signalDescription:m,exitCode:i,isCanceled:l})}: ${o}`,w=Object.prototype.toString.call(s)==="[object Error]",A=w?`${h}
${s.message}`:h,F=[A,e,t].filter(Boolean).join(`
`);return w?(s.originalMessage=s.message,s.message=F):s=new Error(F),s.shortMessage=A,s.command=o,s.escapedCommand=a,s.exitCode=i,s.signal=n,s.signalDescription=m,s.stdout=t,s.stderr=e,r!==void 0&&(s.all=r),"bufferedData"in s&&delete s.bufferedData,s.failed=!0,s.timedOut=!!c,s.isCanceled=l,s.killed=u&&!c,s};yi.exports=dl});var Si=d((Bf,Pr)=>{"use strict";var St=["stdin","stdout","stderr"],hl=t=>St.some(e=>t[e]!==void 0),wi=t=>{if(!t)return;let{stdio:e}=t;if(e===void 0)return St.map(s=>t[s]);if(hl(t))throw new Error(`It's not possible to provide \`stdio\` in combination with one of ${St.map(s=>`\`${s}\``).join(", ")}`);if(typeof e=="string")return e;if(!Array.isArray(e))throw new TypeError(`Expected \`stdio\` to be of type \`string\` or \`Array\`, got \`${typeof e}\``);let r=Math.max(e.length,St.length);return Array.from({length:r},(s,n)=>e[n])};Pr.exports=wi;Pr.exports.node=t=>{let e=wi(t);return e==="ipc"?"ipc":e===void 0||typeof e=="string"?[e,e,e,"ipc"]:e.includes("ipc")?e:[...e,"ipc"]}});var vi=d((Mf,vt)=>{vt.exports=["SIGABRT","SIGALRM","SIGHUP","SIGINT","SIGTERM"];process.platform!=="win32"&&vt.exports.push("SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT");process.platform==="linux"&&vt.exports.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT","SIGUNUSED")});var Oi=d((Ff,he)=>{var x=global.process,Z=function(t){return t&&typeof t=="object"&&typeof t.removeListener=="function"&&typeof t.emit=="function"&&typeof t.reallyExit=="function"&&typeof t.listeners=="function"&&typeof t.kill=="function"&&typeof t.pid=="number"&&typeof t.on=="function"};Z(x)?(Ei=require("assert"),fe=vi(),bi=/^win/i.test(x.platform),Be=require("events"),typeof Be!="function"&&(Be=Be.EventEmitter),x.__signal_exit_emitter__?v=x.__signal_exit_emitter__:(v=x.__signal_exit_emitter__=new Be,v.count=0,v.emitted={}),v.infinite||(v.setMaxListeners(1/0),v.infinite=!0),he.exports=function(t,e){if(!Z(global.process))return function(){};Ei.equal(typeof t,"function","a callback must be provided for exit handler"),de===!1&&Or();var r="exit";e&&e.alwaysLast&&(r="afterexit");var s=function(){v.removeListener(r,t),v.listeners("exit").length===0&&v.listeners("afterexit").length===0&&Et()};return v.on(r,t),s},Et=function(){!de||!Z(global.process)||(de=!1,fe.forEach(function(e){try{x.removeListener(e,bt[e])}catch{}}),x.emit=Ct,x.reallyExit=Tr,v.count-=1)},he.exports.unload=Et,J=function(e,r,s){v.emitted[e]||(v.emitted[e]=!0,v.emit(e,r,s))},bt={},fe.forEach(function(t){bt[t]=function(){if(Z(global.process)){var r=x.listeners(t);r.length===v.count&&(Et(),J("exit",null,t),J("afterexit",null,t),bi&&t==="SIGHUP"&&(t="SIGINT"),x.kill(x.pid,t))}}}),he.exports.signals=function(){return fe},de=!1,Or=function(){de||!Z(global.process)||(de=!0,v.count+=1,fe=fe.filter(function(e){try{return x.on(e,bt[e]),!0}catch{return!1}}),x.emit=Pi,x.reallyExit=Ci)},he.exports.load=Or,Tr=x.reallyExit,Ci=function(e){Z(global.process)&&(x.exitCode=e||0,J("exit",x.exitCode,null),J("afterexit",x.exitCode,null),Tr.call(x,x.exitCode))},Ct=x.emit,Pi=function(e,r){if(e==="exit"&&Z(global.process)){r!==void 0&&(x.exitCode=r);var s=Ct.apply(this,arguments);return J("exit",x.exitCode,null),J("afterexit",x.exitCode,null),s}else return Ct.apply(this,arguments)}):he.exports=function(){return function(){}};var Ei,fe,bi,Be,v,Et,J,bt,de,Or,Tr,Ci,Ct,Pi});var ki=d((Df,Ti)=>{"use strict";var pl=require("os"),ml=Oi(),gl=1e3*5,_l=(t,e="SIGTERM",r={})=>{let s=t(e);return yl(t,e,r,s),s},yl=(t,e,r,s)=>{if(!xl(e,r,s))return;let n=Sl(r),i=setTimeout(()=>{t("SIGKILL")},n);i.unref&&i.unref()},xl=(t,{forceKillAfterTimeout:e},r)=>wl(t)&&e!==!1&&r,wl=t=>t===pl.constants.signals.SIGTERM||typeof t=="string"&&t.toUpperCase()==="SIGTERM",Sl=({forceKillAfterTimeout:t=!0})=>{if(t===!0)return gl;if(!Number.isFinite(t)||t<0)throw new TypeError(`Expected the \`forceKillAfterTimeout\` option to be a non-negative integer, got \`${t}\` (${typeof t})`);return t},vl=(t,e)=>{t.kill()&&(e.isCanceled=!0)},El=(t,e,r)=>{t.kill(e),r(Object.assign(new Error("Timed out"),{timedOut:!0,signal:e}))},bl=(t,{timeout:e,killSignal:r="SIGTERM"},s)=>{if(e===0||e===void 0)return s;let n,i=new Promise((a,c)=>{n=setTimeout(()=>{El(t,r,c)},e)}),o=s.finally(()=>{clearTimeout(n)});return Promise.race([i,o])},Cl=({timeout:t})=>{if(t!==void 0&&(!Number.isFinite(t)||t<0))throw new TypeError(`Expected the \`timeout\` option to be a non-negative integer, got \`${t}\` (${typeof t})`)},Pl=async(t,{cleanup:e,detached:r},s)=>{if(!e||r)return s;let n=ml(()=>{t.kill()});return s.finally(()=>{n()})};Ti.exports={spawnedKill:_l,spawnedCancel:vl,setupTimeout:bl,validateTimeout:Cl,setExitHandler:Pl}});var Ai=d(($f,Ii)=>{"use strict";var M=t=>t!==null&&typeof t=="object"&&typeof t.pipe=="function";M.writable=t=>M(t)&&t.writable!==!1&&typeof t._write=="function"&&typeof t._writableState=="object";M.readable=t=>M(t)&&t.readable!==!1&&typeof t._read=="function"&&typeof t._readableState=="object";M.duplex=t=>M.writable(t)&&M.readable(t);M.transform=t=>M.duplex(t)&&typeof t._transform=="function"&&typeof t._transformState=="object";Ii.exports=M});var Li=d((Uf,Ri)=>{"use strict";var{PassThrough:Ol}=require("stream");Ri.exports=t=>{t={...t};let{array:e}=t,{encoding:r}=t,s=r==="buffer",n=!1;e?n=!(r||s):r=r||"utf8",s&&(r=null);let i=new Ol({objectMode:n});r&&i.setEncoding(r);let o=0,a=[];return i.on("data",c=>{a.push(c),n?o=a.length:o+=c.length}),i.getBufferedValue=()=>e?a:s?Buffer.concat(a,o):a.join(""),i.getBufferedLength=()=>o,i}});var qi=d((Gf,Me)=>{"use strict";var{constants:Tl}=require("buffer"),kl=require("stream"),{promisify:Il}=require("util"),Al=Li(),Rl=Il(kl.pipeline),Pt=class extends Error{constructor(){super("maxBuffer exceeded"),this.name="MaxBufferError"}};async function kr(t,e){if(!t)throw new Error("Expected a stream");e={maxBuffer:1/0,...e};let{maxBuffer:r}=e,s=Al(e);return await new Promise((n,i)=>{let o=a=>{a&&s.getBufferedLength()<=Tl.MAX_LENGTH&&(a.bufferedData=s.getBufferedValue()),i(a)};(async()=>{try{await Rl(t,s),n()}catch(a){o(a)}})(),s.on("data",()=>{s.getBufferedLength()>r&&o(new Pt)})}),s.getBufferedValue()}Me.exports=kr;Me.exports.buffer=(t,e)=>kr(t,{...e,encoding:"buffer"});Me.exports.array=(t,e)=>kr(t,{...e,array:!0});Me.exports.MaxBufferError=Pt});var Bi=d((jf,Ni)=>{"use strict";var{PassThrough:Ll}=require("stream");Ni.exports=function(){var t=[],e=new Ll({objectMode:!0});return e.setMaxListeners(0),e.add=r,e.isEmpty=s,e.on("unpipe",n),Array.prototype.slice.call(arguments).forEach(r),e;function r(i){return Array.isArray(i)?(i.forEach(r),this):(t.push(i),i.once("end",n.bind(null,i)),i.once("error",e.emit.bind(e,"error")),i.pipe(e,{end:!1}),this)}function s(){return t.length==0}function n(i){t=t.filter(function(o){return o!==i}),!t.length&&e.readable&&e.end()}}});var $i=d((Wf,Di)=>{"use strict";var Fi=Ai(),Mi=qi(),ql=Bi(),Nl=(t,e)=>{e===void 0||t.stdin===void 0||(Fi(e)?e.pipe(t.stdin):t.stdin.end(e))},Bl=(t,{all:e})=>{if(!e||!t.stdout&&!t.stderr)return;let r=ql();return t.stdout&&r.add(t.stdout),t.stderr&&r.add(t.stderr),r},Ir=async(t,e)=>{if(t){t.destroy();try{return await e}catch(r){return r.bufferedData}}},Ar=(t,{encoding:e,buffer:r,maxBuffer:s})=>{if(!(!t||!r))return e?Mi(t,{encoding:e,maxBuffer:s}):Mi.buffer(t,{maxBuffer:s})},Ml=async({stdout:t,stderr:e,all:r},{encoding:s,buffer:n,maxBuffer:i},o)=>{let a=Ar(t,{encoding:s,buffer:n,maxBuffer:i}),c=Ar(e,{encoding:s,buffer:n,maxBuffer:i}),l=Ar(r,{encoding:s,buffer:n,maxBuffer:i*2});try{return await Promise.all([o,a,c,l])}catch(u){return Promise.all([{error:u,signal:u.signal,timedOut:u.timedOut},Ir(t,a),Ir(e,c),Ir(r,l)])}},Fl=({input:t})=>{if(Fi(t))throw new TypeError("The `input` option cannot be a stream in sync mode")};Di.exports={handleInput:Nl,makeAllStream:Bl,getSpawnedResult:Ml,validateInputSync:Fl}});var Gi=d((Vf,Ui)=>{"use strict";var Dl=(async()=>{})().constructor.prototype,$l=["then","catch","finally"].map(t=>[t,Reflect.getOwnPropertyDescriptor(Dl,t)]),Ul=(t,e)=>{for(let[r,s]of $l){let n=typeof e=="function"?(...i)=>Reflect.apply(s.value,e(),i):s.value.bind(e);Reflect.defineProperty(t,r,{...s,value:n})}return t},Gl=t=>new Promise((e,r)=>{t.on("exit",(s,n)=>{e({exitCode:s,signal:n})}),t.on("error",s=>{r(s)}),t.stdin&&t.stdin.on("error",s=>{r(s)})});Ui.exports={mergePromise:Ul,getSpawnedPromise:Gl}});var Vi=d((Hf,Wi)=>{"use strict";var ji=(t,e=[])=>Array.isArray(e)?[t,...e]:[t],jl=/^[\w.-]+$/,Wl=/"/g,Vl=t=>typeof t!="string"||jl.test(t)?t:`"${t.replace(Wl,'\\"')}"`,Hl=(t,e)=>ji(t,e).join(" "),zl=(t,e)=>ji(t,e).map(r=>Vl(r)).join(" "),Kl=/ +/g,Xl=t=>{let e=[];for(let r of t.trim().split(Kl)){let s=e[e.length-1];s&&s.endsWith("\\")?e[e.length-1]=`${s.slice(0,-1)} ${r}`:e.push(r)}return e};Wi.exports={joinCommand:Hl,getEscapedCommand:zl,parseCommand:Xl}});var Zi=d((zf,pe)=>{"use strict";var Yl=require("path"),Rr=require("child_process"),Ql=ri(),Zl=ni(),Jl=ai(),eu=fi(),Ot=xi(),zi=Si(),{spawnedKill:tu,spawnedCancel:ru,setupTimeout:su,validateTimeout:nu,setExitHandler:iu}=ki(),{handleInput:ou,getSpawnedResult:au,makeAllStream:cu,validateInputSync:lu}=$i(),{mergePromise:Hi,getSpawnedPromise:uu}=Gi(),{joinCommand:Ki,parseCommand:Xi,getEscapedCommand:Yi}=Vi(),fu=1e3*1e3*100,du=({env:t,extendEnv:e,preferLocal:r,localDir:s,execPath:n})=>{let i=e?{...process.env,...t}:t;return r?Jl.env({env:i,cwd:s,execPath:n}):i},Qi=(t,e,r={})=>{let s=Ql._parse(t,e,r);return t=s.command,e=s.args,r=s.options,r={maxBuffer:fu,buffer:!0,stripFinalNewline:!0,extendEnv:!0,preferLocal:!1,localDir:r.cwd||process.cwd(),execPath:process.execPath,encoding:"utf8",reject:!0,cleanup:!0,all:!1,windowsHide:!0,...r},r.env=du(r),r.stdio=zi(r),process.platform==="win32"&&Yl.basename(t,".exe")==="cmd"&&e.unshift("/q"),{file:t,args:e,options:r,parsed:s}},Fe=(t,e,r)=>typeof e!="string"&&!Buffer.isBuffer(e)?r===void 0?void 0:"":t.stripFinalNewline?Zl(e):e,Tt=(t,e,r)=>{let s=Qi(t,e,r),n=Ki(t,e),i=Yi(t,e);nu(s.options);let o;try{o=Rr.spawn(s.file,s.args,s.options)}catch(_){let g=new Rr.ChildProcess,h=Promise.reject(Ot({error:_,stdout:"",stderr:"",all:"",command:n,escapedCommand:i,parsed:s,timedOut:!1,isCanceled:!1,killed:!1}));return Hi(g,h)}let a=uu(o),c=su(o,s.options,a),l=iu(o,s.options,c),u={isCanceled:!1};o.kill=tu.bind(null,o.kill.bind(o)),o.cancel=ru.bind(null,o,u);let m=eu(async()=>{let[{error:_,exitCode:g,signal:h,timedOut:w},A,F,z]=await au(o,s.options,l),q=Fe(s.options,A),_e=Fe(s.options,F),ee=Fe(s.options,z);if(_||g!==0||h!==null){let ye=Ot({error:_,exitCode:g,signal:h,stdout:q,stderr:_e,all:ee,command:n,escapedCommand:i,parsed:s,timedOut:w,isCanceled:u.isCanceled,killed:o.killed});if(!s.options.reject)return ye;throw ye}return{command:n,escapedCommand:i,exitCode:0,stdout:q,stderr:_e,all:ee,failed:!1,timedOut:!1,isCanceled:!1,killed:!1}});return ou(o,s.options.input),o.all=cu(o,s.options),Hi(o,m)};pe.exports=Tt;pe.exports.sync=(t,e,r)=>{let s=Qi(t,e,r),n=Ki(t,e),i=Yi(t,e);lu(s.options);let o;try{o=Rr.spawnSync(s.file,s.args,s.options)}catch(l){throw Ot({error:l,stdout:"",stderr:"",all:"",command:n,escapedCommand:i,parsed:s,timedOut:!1,isCanceled:!1,killed:!1})}let a=Fe(s.options,o.stdout,o.error),c=Fe(s.options,o.stderr,o.error);if(o.error||o.status!==0||o.signal!==null){let l=Ot({stdout:a,stderr:c,error:o.error,signal:o.signal,exitCode:o.status,command:n,escapedCommand:i,parsed:s,timedOut:o.error&&o.error.code==="ETIMEDOUT",isCanceled:!1,killed:o.signal!==null});if(!s.options.reject)return l;throw l}return{command:n,escapedCommand:i,exitCode:0,stdout:a,stderr:c,failed:!1,timedOut:!1,isCanceled:!1,killed:!1}};pe.exports.command=(t,e)=>{let[r,...s]=Xi(t);return Tt(r,s,e)};pe.exports.commandSync=(t,e)=>{let[r,...s]=Xi(t);return Tt.sync(r,s,e)};pe.exports.node=(t,e,r={})=>{e&&!Array.isArray(e)&&typeof e=="object"&&(r=e,e=[]);let s=zi.node(r),n=process.execArgv.filter(a=>!a.startsWith("--inspect")),{nodePath:i=process.execPath,nodeOptions:o=n}=r;return Tt(i,[...o,t,...Array.isArray(e)?e:[]],{...r,stdin:void 0,stdout:void 0,stderr:void 0,stdio:s,shell:!1})}});var mu={};ho(mu,{activate:()=>hu,deactivate:()=>pu});module.exports=po(mu);var so=require("os"),ge=P(require("vscode"));var en=P(require("vscode"));var Gs=require("child_process");var Ue=P(require("node:stream"),1);function we(t,e,r){typeof r>"u"&&(r=e,e=t,t=void 0),Ue.default.Duplex.call(this,t),typeof r.read!="function"&&(r=new Ue.default.Readable(t).wrap(r)),this._writable=e,this._readable=r,this._waiting=!1,e.once("finish",()=>{this.end()}),this.once("finish",()=>{e.end()}),r.on("readable",()=>{this._waiting&&(this._waiting=!1,this._read())}),r.once("end",()=>{this.push(null)}),(!t||typeof t.bubbleErrors>"u"||t.bubbleErrors)&&(e.on("error",s=>{this.emit("error",s)}),r.on("error",s=>{this.emit("error",s)}))}we.prototype=Object.create(Ue.default.Duplex.prototype,{constructor:{value:we}});we.prototype._write=function(t,e,r){this._writable.write(t,e,r)};we.prototype._read=function(){let t,e=0;for(;(t=this._readable.read())!==null;)this.push(t),e++;e===0&&(this._waiting=!0)};function qt(t,e,r){return new we(t,e,r)}var js=require("http"),Ws=require("url"),er=require("vscode");var Ca=P(jr(),1),Pa=P(Wt(),1),Oa=P(Vt(),1),Us=P(Zt(),1),Ta=P($s(),1);var Re=Us.default;var Je=class{constructor(){this.qOrFn=[]}push(e){typeof this.qOrFn=="function"?this.qOrFn(e):this.qOrFn.push(e)}connect(e){if(typeof this.qOrFn=="function")throw new Error("Already connected");let r=this.qOrFn;this.qOrFn=e;for(let s of r)e(s)}},et=class{constructor(){this.errorEmitter=new er.EventEmitter;this.onError=this.errorEmitter.event;this.closeEmitter=new er.EventEmitter;this.onClose=this.closeEmitter.event;this.disposed=!1;this.fromSocketQueue=new Je;this.fromBrowserQueue=new Je;this.onClose(()=>this.dispose()),this.onError(()=>this.dispose())}attachSocket(e,r,s,n){let i=new Ws.URL(`ws://${e}:${r}${s}`),o=Date.now()+5e3;n?this.attachSocketWsl(i,n,o):this.attachSocketLoop(i,o)}attachChild(e){if(this.disposed){e.dispose();return}this.browserProcess=e,e.onClose(()=>this.closeEmitter.fire()),e.onError(r=>this.errorEmitter.fire(r)),e.onMessage(r=>this.fromBrowserQueue.push(r)),this.fromSocketQueue.connect(r=>e.send(r))}dispose(){var e,r;this.disposed||((e=this.browserProcess)==null||e.dispose(),(r=this.socket)==null||r.close(),this.disposed=!0)}attachSocketWsl(e,r,s){let n=new js.Agent;n.createConnection=(o,a)=>{let c=(0,Gs.spawn)("wsl.exe",["-d",r.distro,"-u",r.user,"--",r.execPath,"-e",`'s=net.connect(${e.port});s.pipe(process.stdout);process.stdin.pipe(s)'`]);c.on("error",a),c.on("spawn",()=>{a(null,ka(qt(c.stdin,c.stdout)))})};let i=new Re(e,{agent:n});this.setupSocket(i,e,s)}attachSocketLoop(e,r){if(this.disposed)return;let s=new Re(e,{perMessageDeflate:!0});this.setupSocket(s,e,r)}setupSocket(e,r,s){e.on("open",()=>{if(this.disposed){e.close();return}this.socket=e,this.socket.on("close",()=>this.closeEmitter.fire()),this.socket.on("message",n=>this.fromSocketQueue.push(n)),this.fromBrowserQueue.connect(n=>e.send(n))}),e.on("error",n=>{this.socket===e||Date.now()>s?this.errorEmitter.fire(n):setTimeout(()=>this.attachSocketLoop(r,s),100)})}},ka=t=>{let e=t;return Object.assign(t,{bufferSize:0,bytesRead:0,bytesWritten:0,connecting:!1,localAddress:"127.0.0.1",localPort:1,remoteAddress:"127.0.0.1",remoteFamily:"tcp",remotePort:1,address:()=>({address:"127.0.0.1",family:"tcp",port:1}),unref:()=>e,ref:()=>e,connect:(s,n,i)=>(i&&setImmediate(i),e),setKeepAlive:()=>e,setNoDelay:()=>e,setTimeout:(s,n)=>(n==null||n(),e)})};var Zs=P(Ks()),T=require("vscode");var Qs=P(require("http")),ne=require("url");function tr(t,e){return y(this,null,function*(){try{return yield Na(t,e)}catch(r){if(e.isCancellationRequested)throw new Error(`Could not connect to debug target at ${t}: ${r}`);return yield new Promise(s=>setTimeout(s,200)),tr(t,e)}})}function Na(t,e){return y(this,null,function*(){let r=yield Xs((0,ne.resolve)(t,"/json/version"),e);if(r!=null&&r.webSocketDebuggerUrl)return Ys(t,r.webSocketDebuggerUrl);let s=yield Xs((0,ne.resolve)(t,"/json/list"),e);if(s!=null&&s.length)return Ys(t,s[0].webSocketDebuggerUrl);throw new Error("Could not find any debuggable target")})}function Xs(t,e){return y(this,null,function*(){return JSON.parse(yield Ba(t,e))})}function Ba(t,e){let r=[];return new Promise((s,n)=>{let i=Qs.request(t,{headers:{host:"localhost"}},o=>{r.push(e.onCancellationRequested(()=>o.destroy()));let a="";o.setEncoding("utf8"),o.on("data",c=>a+=c),o.on("end",()=>s(a)),o.on("error",n)});r.push(e.onCancellationRequested(()=>{i.destroy(),n(new Error(`Cancelled GET ${t}`))})),i.on("error",n),i.end()}).finally(()=>r.forEach(s=>s.dispose()))}function Ys(t,e){let r=new ne.URL(t),s=new ne.URL(e);return s.host=r.host,s.toString()}var Js=t=>y(void 0,null,function*(){t.exitCode||(yield Promise.race([new Promise(e=>t.on("exit",e)),new Promise(e=>setTimeout(e,1e3))]))}),rt=class{constructor(e){this.process=e;this.errorEmitter=new T.EventEmitter;this.closeEmitter=new T.EventEmitter;this.messageEmitter=new T.EventEmitter;this.onError=this.errorEmitter.event;this.onClose=this.closeEmitter.event;this.onMessage=this.messageEmitter.event;if(this.process.stdio.length<5)throw new Error("Insufficient fd number on child process");e.on("error",r=>this.errorEmitter.fire(r)),e.on("exit",()=>this.closeEmitter.fire()),e.stdio[4].pipe((0,Zs.default)("\0")).on("data",r=>this.messageEmitter.fire(r)).resume()}send(e){let r=this.process.stdio[3];if(e instanceof Uint8Array)r.write(e);else if(e instanceof ArrayBuffer)r.write(new Uint8Array(e));else for(let s of e)r.write(s);r.write("\0")}dispose(){return y(this,null,function*(){yield Js(this.process),this.process.kill()})}},Q=class{constructor(e){this.ws=e;this.errorEmitter=new T.EventEmitter;this.closeEmitter=new T.EventEmitter;this.messageEmitter=new T.EventEmitter;this.onError=this.errorEmitter.event;this.onClose=this.closeEmitter.event;this.onMessage=this.messageEmitter.event;e.on("error",r=>this.errorEmitter.fire(r)),e.on("close",()=>this.closeEmitter.fire()),e.on("message",r=>this.messageEmitter.fire(r))}static create(e,r){return y(this,null,function*(){let s=new T.CancellationTokenSource;setTimeout(()=>s.cancel(),10*1e3);let n=yield tr(`http://${e}:${r}`,s.token),i=new Re(n,[],{headers:{host:"localhost"},perMessageDeflate:!1,maxPayload:256*1024*1024,followRedirects:!0});return yield new Promise((o,a)=>{i.addEventListener("open",()=>o(new Q(i))),i.addEventListener("error",c=>a(c.error))})})}send(e){this.ws.send(e.toString())}dispose(){return y(this,null,function*(){yield new Promise(e=>{this.ws.on("close",e),this.ws.close()})})}},ie=class{constructor(e,r){this.process=e;this.attach=r;this.errorEmitter=new T.EventEmitter;this.closeEmitter=new T.EventEmitter;this.messageEmitter=new T.EventEmitter;this.onError=this.errorEmitter.event;this.onClose=this.closeEmitter.event;this.onMessage=this.messageEmitter.event;e.on("error",s=>this.errorEmitter.fire(s)),e.on("close",()=>this.closeEmitter.fire()),r.onError(s=>this.errorEmitter.fire(s)),r.onClose(()=>this.closeEmitter.fire()),r.onMessage(s=>this.messageEmitter.fire(s))}static create(e,r){return y(this,null,function*(){let s=new T.CancellationTokenSource;setTimeout(()=>s.cancel(),10*1e3);try{let n=yield Q.create("localhost",r);return new ie(e,n)}catch(n){throw e.kill(),n}})}send(e){this.attach.send(e)}dispose(){return y(this,null,function*(){this.attach.dispose(),yield Js(this.process),this.process.kill()})}};var st=class{constructor(e){this.spawn=e;this.sessions=new Map}create(e){return y(this,null,function*(){let r=new et;this.sessions.set(e.launchId,r),r.onClose(()=>this.sessions.delete(e.launchId)),r.onError(s=>{en.window.showErrorMessage(`Error running browser: ${s.message||s.stack}`),this.sessions.delete(e.launchId)}),yield Promise.all([this.addChildSocket(r,e),e.attach?this.addChildAttach(r,e.attach):this.addChildBrowser(r,e)])})}destroy(e){let r=this.sessions.get(e);r==null||r.dispose(),this.sessions.delete(e)}dispose(){for(let e of this.sessions.values())e.dispose();this.sessions.clear()}addChildSocket(e,r){return y(this,null,function*(){let[s,n]=r.proxyUri.split(":");e.attachSocket(s,Number(n),r.path,r.wslInfo)})}addChildBrowser(e,r){return y(this,null,function*(){let s=yield this.spawn.launch(r);e.attachChild(s)})}addChildAttach(e,r){return y(this,null,function*(){let s=yield Q.create(r.host,r.port);e.attachChild(s)})}};var I=P(mn()),kt=require("child_process"),It=P(Zi()),At=require("fs"),ro=require("path"),De=P(require("vscode"));var me=class extends Error{};var Ji=require("fs");function Lr(t){return y(this,null,function*(){try{return yield Ji.promises.access(t),!0}catch(e){return!1}})}var eo="--remote-debugging-port=",to="--remote-debugging-port=",qr="availableBrowsers_",Rt=class{constructor(e,r){this.storagePath=e;this.context=r;this.finders={edge:new I.EdgeBrowserFinder(process.env,At.promises,It.default),chrome:new I.ChromeBrowserFinder(process.env,At.promises,It.default),firefox:new I.FirefoxBrowserFinder(process.env,At.promises,It.default)}}findBrowserPath(e,r){return y(this,null,function*(){var i;if(r!=="*"&&!(0,I.isQuality)(r))return r;if(!this.finders.hasOwnProperty(e))throw new me(`Browser type "${e}" is not supported.`);let s=this.context.globalState.get(qr+e)||(yield this.finders[e].findAll()),n=r==="*"?(i=s.find(o=>o.quality==="stable"))!=null?i:s[0]:s.find(o=>o.quality===r);if(!n)throw yield this.context.globalState.update(qr+e,void 0),r===I.Quality.Stable&&!s.length?new me(De.l10n.t('Unable to find a {0} installation on your system. Try installing it, or providing an absolute path to the browser in the "runtimeExecutable" in your launch.json.',e)):new me(De.l10n.t('Unable to find {0} version {1}. Available auto-discovered versions are: {2}. You can set the "runtimeExecutable" in your launch.json to one of these, or provide an absolute path to the browser executable.',e,r,JSON.stringify([...new Set(s)])));return yield this.context.globalState.update(qr+e,s),n.path})}findBrowserByExe(e,r){return y(this,null,function*(){var s;if(r==="*"){let n=(yield e.findWhere(i=>i.quality===I.Quality.Stable))||(yield e.findAll())[0];return n==null?void 0:n.path}else return(0,I.isQuality)(r)?(s=yield e.findWhere(n=>n.quality===r))==null?void 0:s.path:r})}getUserDataDir(e){return y(this,null,function*(){var n;let r=e.params.userDataDir;if(r===!1)return;let s=(0,ro.join)(this.storagePath,(n=e.browserArgs)!=null&&n.includes("--headless")?".headless-profile":".profile");return r===!0||!(yield Lr(r))?s:r})}launchBrowserOnly(e,r){return y(this,null,function*(){let s=yield this.findBrowserPath(e,"*");(0,kt.spawn)(s,[r],{detached:!0,stdio:"ignore"}).on("error",n=>{De.window.showErrorMessage(`Error running browser: ${n.message||n.stack}`)})})}launch(e){return y(this,null,function*(){var c;let r=yield this.findBrowserPath(e.type,e.params.runtimeExecutable),s=e.browserArgs.slice(),n=yield this.getUserDataDir(e);n!==void 0&&s.unshift(`--user-data-dir=${n}`);let i=e.params.cwd||e.params.webRoot;(!i||!(yield Lr(i)))&&(i=process.cwd());let o=(c=s.find(l=>l.startsWith(eo)))==null?void 0:c.slice(eo.length);if(!o)return new rt((0,kt.spawn)(r,s,{detached:process.platform!=="win32",env:$e(Fr($e({},process.env),{GDK_PIXBUF_MODULEDIR:void 0,GDK_PIXBUF_MODULE_FILE:void 0,ELECTRON_RUN_AS_NODE:void 0}),e.params.env),stdio:["ignore","ignore","ignore","pipe","pipe"],cwd:i}));s.includes(to)||s.unshift(to);let a=(0,kt.spawn)(r,s,{detached:process.platform!=="win32",env:$e({ELECTRON_RUN_AS_NODE:void 0},e.params.env),stdio:"ignore",cwd:i});return yield ie.create(a,Number(o))})}};var L;function hu(t){var r,s;let e=new Rt((s=(r=t.storageUri)==null?void 0:r.fsPath)!=null?s:(0,so.tmpdir)(),t);L=new st(e),t.subscriptions.push(ge.commands.registerCommand("js-debug-companion.launchAndAttach",n=>{L==null||L.create(n).catch(i=>ge.window.showErrorMessage(i.message))}),ge.commands.registerCommand("js-debug-companion.kill",({launchId:n})=>{L==null||L.destroy(n)}),ge.commands.registerCommand("js-debug-companion.launch",({browserType:n,URL:i})=>{e.launchBrowserOnly(n,i)}))}function pu(){L==null||L.dispose(),L=void 0}0&&(module.exports={activate,deactivate});
