import{r as tt,s as oe,h as J,k as le,i as pe,j as ce,t as We,v as De,w as $e,n as te,x as A,y as ke,u as he,aA as W,az as Y,b as be,q as M,m as de,aB as lt,p as ae,F as xe,ab as at,C as S,aC as ot,aD as Z,aE as Q,B as P,W as fe,aF as ee,at as Te,V as ue,_ as Ne,f as nt,a as rt,T as it,aG as st,aH as ut,aI as dt,aJ as ct,aK as mt,X as Ie,as as Me,aL as vt,aM as Fe,a8 as Ge,a0 as Ke,aN as ze,S as Ue,am as ft,I as pt,an as _t,ao as ie,ap as se}from"./index-952c55ec.js";import{e as V,w as gt,J as ht,d as G,r as Pe,L as Ce,A as _e,$ as s,a0 as C,a1 as t,j as e,V as h,Z as l,u as o,Y as Oe,a4 as x,ai as je,B as yt,a7 as v,ab as wt,m as Ve,a2 as D,a3 as R,F as z,c as U,k as ge,q as He,x as qe,am as Le,an as Dt,I as Ye,a5 as Ae,a6 as $t,_ as kt}from"./vue-cd4a4a73.js";import"./faker-e2f6ff92.js";import{_ as bt}from"./MoveTorrentDialog.vue_vue_type_script_setup_true_lang-1a189e08.js";import{d as Re}from"./dayjs.min-b02eded3.js";import{am as Tt}from"./vuetify-102fadec.js";var we=(y=>(y[y.MISSING=0]="MISSING",y[y.DOWNLOADING=1]="DOWNLOADING",y[y.DOWNLOADED=2]="DOWNLOADED",y))(we||{}),q=(y=>(y[y.DISABLED=0]="DISABLED",y[y.NOT_YET_CONTACTED=1]="NOT_YET_CONTACTED",y[y.WORKING=2]="WORKING",y[y.UPDATING=3]="UPDATING",y[y.NOT_WORKING=4]="NOT_WORKING",y))(q||{});const Vt={pdf:"mdi-file-pdf-box",png:"mdi-file-image",jpg:"mdi-file-image",jpeg:"mdi-file-image",tiff:"mdi-file-image",doc:"mdi-file-document",docx:"mdi-file-document",txt:"mdi-file-document",nfo:"mdi-information-variant-box",mp3:"mdi-music",wav:"mdi-music",flac:"mdi-music",avi:"mdi-movie",mp4:"mdi-movie",mkv:"mdi-movie",mov:"mdi-movie",wmv:"mdi-movie",srt:"mdi-subtitles",idx:"mdi-subtitles",sub:"mdi-subtitles",rar:"mdi-folder-zip",zip:"mdi-folder-zip",gz:"mdi-folder-zip","7z":"mdi-folder-zip",exe:"mdi-application",msi:"mdi-application",dmg:"mdi-application",deb:"mdi-application",iso:"mdi-application",jar:"mdi-application"};function Nt(y){const a=y.name.split(".").pop()?.toLowerCase()||"";return Vt[a]||"mdi-file"}function Ee(){return{type:"root",name:"",fullName:"",id:"",children:[]}}function Ct(y){const a=V(Ee());return gt(()=>{const n=Ee(),u=ht(y)??[];for(const f of u){let p=n;f.name.replace("\\","/").split("/").reduce((d,r)=>{const _=d===""?r:d+"/"+r;if(f.name.replace("\\","/").split("/").pop()===r){const k={type:"file",name:r,fullName:_,id:f.index,availability:f.availability,index:f.index,is_seed:f.is_seed,priority:f.priority,progress:f.progress,size:f.size};p.children.push(k)}else{const k=p.children.find(b=>b.name===r);if(k)p=k;else{const b={type:"folder",name:r,fullName:_,id:_,children:[]};p.children.push(b),p=b}}return _},"")}a.value=n}),{tree:a}}const Je=G({__name:"MoveTorrentFileDialog",props:{guid:{},hash:{},isFolder:{type:Boolean},oldName:{}},setup(y){const a=y,{isOpened:n}=tt(a.guid),{t:u}=oe(),f=J(),p=V(),d=V(),r=V(!1),_=Pe({newName:""}),k=[g=>!!g||u("dialogs.moveTorrent.required")];async function b(){await p.value?.validate(),r.value&&(a.isFolder?await f.renameTorrentFolder(a.hash,a.oldName,_.newName):await f.renameTorrentFile(a.hash,a.oldName,_.newName),F())}const F=()=>{n.value=!1};return Ce(()=>{if(_.newName=a.oldName,a.isFolder)_e(()=>d.value?.select());else{const g=_.newName.lastIndexOf("/"),N=_.newName.lastIndexOf(".");_e(()=>{d.value?.setSelectionRange(g+1,N==-1?_.newName.length:N)})}}),(g,N)=>(s(),C(ke,{modelValue:o(n),"onUpdate:modelValue":N[3]||(N[3]=O=>yt(n)?n.value=O:null)},{default:t(()=>[e(le,null,{default:t(()=>[e(pe,null,{default:t(()=>[h(l(o(u)("dialogs.moveTorrentFile.title",1+Number(g.isFolder))),1)]),_:1}),e(ce,null,{default:t(()=>[e(o(We),{modelValue:r.value,"onUpdate:modelValue":N[1]||(N[1]=O=>r.value=O),ref_key:"form",ref:p,onSubmit:N[2]||(N[2]=Oe(()=>{},["prevent"]))},{default:t(()=>[g.oldName?(s(),C(De,{key:0,"model-value":g.oldName,disabled:"",label:g.$t("dialogs.moveTorrentFile.oldName")},null,8,["model-value","label"])):x("",!0),e(De,{modelValue:_.newName,"onUpdate:modelValue":N[0]||(N[0]=O=>_.newName=O),ref_key:"input",ref:d,rules:k,autofocus:"",label:g.$t("dialogs.moveTorrent.newPath"),onKeydown:je(b,["enter"])},null,8,["modelValue","label","onKeydown"])]),_:1},8,["modelValue"])]),_:1}),e($e,null,{default:t(()=>[e(te),e(A,{color:"error",onClick:F},{default:t(()=>[h(l(g.$t("common.cancel")),1)]),_:1}),e(A,{color:"accent",disabled:!r.value,onClick:b},{default:t(()=>[h(l(g.$t("common.save")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Ot={class:"mr-2"},St={class:"mr-2"},Ft={class:"mr-4"},It=G({__name:"FileNode",props:{node:{}},emits:["renameFile"],setup(y){const{t:a}=oe(),n=he(),u=[{name:a("constants.file_priority.max"),icon:"mdi-priority-high",value:W.MAXIMAL},{name:a("constants.file_priority.high"),icon:"mdi-arrow-up",value:W.HIGH},{name:a("constants.file_priority.normal"),icon:"mdi-arrow-down",value:W.NORMAL},{name:a("constants.file_priority.unwanted"),icon:"mdi-priority-low",value:W.DO_NOT_DOWNLOAD}];function f(p){return u.find(d=>d.value===p.priority)?.name||""}return(p,d)=>(s(),C(M,{title:p.node.name,value:p.node.index,"prepend-icon":o(Nt)(p.node)},{append:t(()=>[v("span",Ot,"[ "+l(o(Y)(p.node.size,o(n).useBinarySize))+" ]",1),v("span",St,l(o(be)(p.node.progress)),1),v("span",Ft,"[ "+l(f(p.node))+" ]",1),e(A,{class:"mr-2",color:"accent",size:"x-small",icon:"mdi-trending-up"}),e(A,{color:"accent",size:"x-small",icon:"mdi-pencil",onClick:d[0]||(d[0]=Oe(r=>p.$emit("renameFile",p.node),["stop"]))})]),_:1},8,["title","value","prepend-icon"]))}}),At={class:"mr-2"},xt=G({__name:"FolderNode",props:{node:{}},emits:["renameFolder","renameFile"],setup(y){const{t:a}=oe();function n(u){let f=0,p=0;for(const r of u.children)r.type==="file"?f++:r.type==="folder"&&p++;const d=[];return f>0&&d.push(a("torrentDetail.content.fileInfo",f)),p>0&&d.push(a("torrentDetail.content.folderInfo",p)),d.join(", ")}return(u,f)=>{const p=wt("FolderNode",!0);return s(),C(lt,{value:u.node.type==="root"?"(root)":u.node.fullName},{activator:t(({props:d})=>[e(M,Ve(d,{"prepend-icon":u.node.type==="root"?"mdi-file-tree":"mdi-folder",title:u.node.type==="root"?u.$t("torrentDetail.content.rootNode"):u.node.name,value:u.node.type==="root"?"(root)":u.node.fullName}),{append:t(({isActive:r})=>[v("span",At,l(n(u.node)),1),u.node.type==="folder"?(s(),C(A,{key:0,color:"accent",size:"x-small",icon:"mdi-pencil",onClick:f[0]||(f[0]=Oe(_=>u.$emit("renameFolder",u.node),["stop"]))})):x("",!0),e(de,{icon:r?"mdi-chevron-up":"mdi-chevron-down"},null,8,["icon"])]),_:2},1040,["prepend-icon","title","value"])]),default:t(()=>[(s(!0),D(z,null,R(u.node.children,d=>(s(),D(z,null,[d.type==="folder"?(s(),C(p,{key:0,node:d,onRenameFolder:f[1]||(f[1]=r=>u.$emit("renameFolder",r)),onRenameFile:f[2]||(f[2]=r=>u.$emit("renameFile",r))},null,8,["node"])):x("",!0),d.type==="file"?(s(),C(It,{key:1,node:d,onRenameFile:f[3]||(f[3]=r=>u.$emit("renameFile",r))},null,8,["node"])):x("",!0)],64))),256))]),_:1},8,["value"])}}}),Pt=G({__name:"RootNode",props:{root:{}},emits:["renameFolder","renameFile"],setup(y){return(a,n)=>(s(),C(ae,{density:"compact","select-strategy":"classic"},{default:t(()=>[e(xt,{node:a.root,onRenameFolder:n[0]||(n[0]=u=>a.$emit("renameFolder",u)),onRenameFile:n[1]||(n[1]=u=>a.$emit("renameFile",u))},null,8,["node"])]),_:1}))}}),Bt=G({__name:"Content",props:{torrent:{},isActive:{type:Boolean}},setup(y){const a=y,n=xe(),u=J(),f=he(),p=V(null),d=V(!1),r=V(!1),_=V([]),{tree:k}=Ct(_),b=V([]),F=V(""),g=Pe({hash:"",isFolder:!1,oldName:""}),N=U({get:()=>_.value.filter(w=>w.priority!==W.DO_NOT_DOWNLOAD).map(w=>w.index),async set(w){const i=_.value.filter(T=>T.priority!==W.DO_NOT_DOWNLOAD).map(T=>T.index),E=i.filter(T=>!w.includes(T)).map(T=>_.value.find($=>$.index===T)).filter(T=>T&&T.priority!==W.DO_NOT_DOWNLOAD).map(T=>T.index),X=w.filter(T=>!i.includes(T)).map(T=>_.value.find($=>$.index===T)).filter(T=>T&&T.priority===W.DO_NOT_DOWNLOAD).map(T=>T.index);E.length&&await u.setTorrentFilePriority(a.torrent.hash,E,W.DO_NOT_DOWNLOAD),X.length&&await u.setTorrentFilePriority(a.torrent.hash,X,W.NORMAL),await m()}});async function O(w){g.hash=a.torrent.hash,g.isFolder=w.type==="folder",g.oldName=w.fullName,F.value=n.createDialog(Je,g)}async function m(){d.value||(d.value=!0,r.value=!0,await _e(),_.value=await u.fetchFiles(a.torrent.hash),r.value=!1,d.value=!1,await _e())}return ge(()=>a.isActive,w=>{w?(p.value=setInterval(m,f.fileContentInterval),m().then(()=>b.value.push("(root)"))):clearInterval(p.value)}),ge(()=>n.isDialogOpened(F.value),w=>{w||m()}),He(()=>{clearInterval(p.value)}),qe(()=>{p.value=setInterval(m,f.fileContentInterval),m().then(()=>b.value.push("(root)"))}),(w,i)=>(s(),C(le,{loading:r.value,flat:""},{default:t(()=>[e(Pt,{opened:b.value,"onUpdate:opened":i[0]||(i[0]=E=>b.value=E),selected:N.value,"onUpdate:selected":i[1]||(i[1]=E=>N.value=E),root:o(k),onRenameFolder:O,onRenameFile:O},null,8,["opened","selected","root"])]),_:1},8,["loading"]))}}),zt={class:"pl-4"},Ut={class:"pr-4"},j=G({__name:"InfoBase",props:{compact:{type:Boolean}},setup(y){return(a,n)=>(s(),C(S,{cols:"12",sm:"6",lg:"3"},{default:t(()=>[e(at,{rounded:"xl",class:"d-flex align-center py-2 border"},{default:t(()=>[v("div",zt,[Le(a.$slots,"title")]),e(te),v("div",Ut,[Le(a.$slots,"text")])]),_:3})]),_:3}))}}),Lt={key:0,class:"d-flex gap"},Rt=G({__name:"Info",props:{torrent:{},isActive:{type:Boolean}},setup(y){const a=y,n=J(),u=he(),f=U({get:()=>a.torrent.auto_tmm,set:m=>n.toggleAutoTmm([a.torrent.hash],m)}),p=U({get:()=>a.torrent.f_l_piece_prio,set:()=>n.toggleFLPiecePrio([a.torrent.hash])}),d=U({get:()=>a.torrent.forced,set:m=>{m?n.forceResumeTorrents([a.torrent.hash]):n.resumeTorrents([a.torrent.hash])}}),r=U({get:()=>a.torrent.seq_dl,set:()=>n.toggleSeqDl([a.torrent.hash])}),_=U({get:()=>a.torrent.super_seeding,set:m=>n.setSuperSeeding([a.torrent.hash],m)}),k=[{title:"added_on",text:"added_on"},{title:"completed_on",text:"completed_on"},{title:"last_activity",text:"last_activity"},{title:"seen_complete",text:"seen_complete"}],b=[{title:"ratio_time_limit",text:"ratio_time_limit"},{title:"seeding_time",text:"seeding_time"},{title:"time_active",text:"time_active"}],F=[{title:"downloaded",text:"downloaded"},{title:"downloaded_session",text:"downloaded_session"},{title:"uploaded",text:"uploaded"},{title:"uploaded_session",text:"uploaded_session"},{title:"size",text:"size"},{title:"total_size",text:"total_size"},{title:"amount_left",text:"amount_left"},{title:"global_volume",text:"globalVolume"}],g=[{title:"download_limit",text:"dl_limit"},{title:"download_speed",text:"dlspeed"},{title:"upload_limit",text:"up_limit"},{title:"upload_speed",text:"upspeed"},{title:"avg_download_speed",text:"avgDownloadSpeed"},{title:"avg_upload_speed",text:"avgUploadSpeed"},{title:"global_speed",text:"globalSpeed"}],N=[{title:"available_peers",text:"available_peers"},{title:"available_seeds",text:"available_seeds"},{title:"num_leechs",text:"num_leechs"},{title:"num_seeds",text:"num_seeds"},{title:"ratio",text:"ratio"},{title:"ratio_limit",text:"ratio_limit"},{title:"availability",text:"availability"},{title:"eta",text:"eta"},{title:"category",text:"category"},{title:"state",text:"stateString"},{title:"trackers_count",text:"trackers_count"},{title:"priority",text:"priority"}],O=[{title:"content_path",text:"content_path"},{title:"download_path",text:"download_path"},{title:"hash",text:"hash"},{title:"infohash_v1",text:"infohash_v1"},{title:"infohash_v2",text:"infohash_v2"},{title:"magnet",text:"magnet"},{title:"name",text:"name"},{title:"save_path",text:"savePath"},{title:"tracker",text:"tracker"}];return(m,w)=>(s(),C(ae,null,{default:t(()=>[e(M,null,{default:t(()=>[e(ot,null,{default:t(()=>[e(Z,{title:m.$t("torrentDetail.info.datetime_values")},{default:t(()=>[e(Q,null,{default:t(()=>[e(P,null,{default:t(()=>[(s(),D(z,null,R(k,i=>e(j,null,Dt({title:t(()=>[h(l(m.$t(`torrent.properties.${i.title}`)),1)]),_:2},[m.torrent[i.text]>0?{name:"text",fn:t(()=>[h(l(o(Re)(m.torrent[i.text]*1e3).format(o(u).dateFormat??"DD/MM/YYYY, HH:mm:ss")),1)]),key:"0"}:{name:"text",fn:t(()=>[h(l(m.$t("common.NA")),1)]),key:"1"}]),1024)),64))]),_:1})]),_:1})]),_:1},8,["title"]),e(Z,{title:m.$t("torrentDetail.info.duration_values")},{default:t(()=>[e(Q,null,{default:t(()=>[e(P,null,{default:t(()=>[(s(),D(z,null,R(b,i=>e(j,null,{title:t(()=>[h(l(m.$t(`torrent.properties.${i.title}`)),1)]),text:t(()=>[h(l(o(Re).duration(m.torrent[i.text],"s").humanize()),1)]),_:2},1024)),64))]),_:1})]),_:1})]),_:1},8,["title"]),e(Z,{title:m.$t("torrentDetail.info.boolean_values")},{default:t(()=>[e(Q,null,{default:t(()=>[e(P,null,{default:t(()=>[e(j,null,{title:t(()=>[e(fe,{modelValue:f.value,"onUpdate:modelValue":w[0]||(w[0]=i=>f.value=i),"hide-details":"",density:"compact",label:m.$t("torrent.properties.auto_tmm")},null,8,["modelValue","label"])]),_:1}),e(j,null,{title:t(()=>[e(fe,{modelValue:p.value,"onUpdate:modelValue":w[1]||(w[1]=i=>p.value=i),"hide-details":"",density:"compact",label:m.$t("torrent.properties.f_l_piece_prio")},null,8,["modelValue","label"])]),_:1}),e(j,null,{title:t(()=>[e(fe,{modelValue:d.value,"onUpdate:modelValue":w[2]||(w[2]=i=>d.value=i),"hide-details":"",density:"compact",label:m.$t("torrent.properties.forced")},null,8,["modelValue","label"])]),_:1}),e(j,null,{title:t(()=>[e(fe,{modelValue:r.value,"onUpdate:modelValue":w[3]||(w[3]=i=>r.value=i),"hide-details":"",density:"compact",label:m.$t("torrent.properties.seq_dl")},null,8,["modelValue","label"])]),_:1}),e(j,null,{title:t(()=>[e(fe,{modelValue:_.value,"onUpdate:modelValue":w[4]||(w[4]=i=>_.value=i),"hide-details":"",density:"compact",label:m.$t("torrent.properties.super_seeding")},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1})]),_:1},8,["title"]),e(Z,{title:m.$t("torrentDetail.info.data_values")},{default:t(()=>[e(Q,null,{default:t(()=>[e(P,null,{default:t(()=>[(s(),D(z,null,R(F,i=>e(j,null,{title:t(()=>[h(l(m.$t(`torrent.properties.${i.title}`)),1)]),text:t(()=>[h(l(o(Y)(m.torrent[i.text],o(u).useBinarySize)),1)]),_:2},1024)),64))]),_:1})]),_:1})]),_:1},8,["title"]),e(Z,{title:m.$t("torrentDetail.info.speed_values")},{default:t(()=>[e(Q,null,{default:t(()=>[e(P,null,{default:t(()=>[(s(),D(z,null,R(g,i=>e(j,null,{title:t(()=>[h(l(m.$t(`torrent.properties.${i.title}`)),1)]),text:t(()=>[h(l(o(ee)(m.torrent[i.text],o(u).useBitSpeed)),1)]),_:2},1024)),64))]),_:1})]),_:1})]),_:1},8,["title"]),e(Z,{title:m.$t("torrentDetail.info.text_values")},{default:t(()=>[e(Q,null,{default:t(()=>[e(P,null,{default:t(()=>[(s(),D(z,null,R(N,i=>e(j,null,{title:t(()=>[h(l(m.$t(`torrent.properties.${i.title}`)),1)]),text:t(()=>[h(l(m.torrent[i.text]),1)]),_:2},1024)),64))]),_:1})]),_:1})]),_:1},8,["title"]),e(Z,{title:m.$t("torrentDetail.info.long_text_values")},{default:t(()=>[e(Q,null,{default:t(()=>[e(ae,null,{default:t(()=>[(s(),D(z,null,R(O,i=>e(M,{title:m.$t(`torrent.properties.${i.title}`)},{default:t(()=>[e(Te,null,{default:t(()=>[h(l(m.torrent[i.text]),1)]),_:2},1024)]),_:2},1032,["title"])),64)),e(M,{title:m.$t("torrent.properties.tags")},{default:t(()=>[m.torrent.tags?.length?(s(),D("div",Lt,[(s(!0),D(z,null,R(m.torrent.tags,i=>(s(),C(ue,{variant:"flat",color:"tag"},{default:t(()=>[h(l(i),1)]),_:2},1024))),256))])):(s(),C(Te,{key:1},{default:t(()=>[h(l(m.$t("torrent.properties.empty_tags")),1)]),_:1}))]),_:1},8,["title"])]),_:1})]),_:1})]),_:1},8,["title"])]),_:1})]),_:1})]),_:1}))}});const Et=Ne(Rt,[["__scopeId","data-v-7a57c172"]]),Wt=["href"],Mt={key:1},Gt={class:"my-1"},Kt={class:"mr-2"},jt={key:0},Ht={key:2},qt={key:0},Yt={key:1},Jt={key:2},Xt={key:3},Zt={key:4},Qt={key:0},el=G({__name:"Overview",props:{torrent:{},isActive:{type:Boolean}},setup(y){const a=y,{t:n}=oe(),u=Tt(),f=xe(),p=J(),d=he(),r=V(),_=V(""),k=V(0),b=V([]),F=V(0),g=V(0),N=V(""),O=V(0),m=V(0),w=V(0),i=V(0),E=U(()=>`torrent-${a.torrent.state}`),X=U(()=>`${parseInt(nt(O.value,!0))} ${rt(O.value,!0)}`),T=U(()=>a.torrent.state===it.META_DL),$=U(()=>!T.value&&w.value>0&&w.value<d.canvasRenderThreshold),B=U(()=>$.value&&w.value<d.canvasRefreshThreshold);async function I(){const c=await p.getTorrentProperties(a.torrent.hash);_.value=c.comment,k.value=c.dl_speed_avg,w.value=c.pieces_num,m.value=c.pieces_have,O.value=c.piece_size,i.value=c.up_speed_avg}async function ye(){b.value=await p.fetchFiles(a.torrent.hash),g.value=b.value.length;const c=b.value.filter(H=>H.priority!==W.DO_NOT_DOWNLOAD);F.value=c.length,F.value===1&&(N.value=c[0].name)}async function K(){if(!r.value)return;const c=await p.fetchPieceState(a.torrent.hash);r.value.width=c.length||-1;const H=r.value.getContext("2d");H.clearRect(0,0,r.value.width,r.value.height);let L="",ne=1;for(let re=0;re<c.length;++re){const Se=c[re];let me="";if(Se===we.DOWNLOADING)me=u.current.value.colors["torrent-downloading"];else if(Se===we.DOWNLOADED)me=u.current.value.colors["torrent-pausedUP"];else if(Se===we.MISSING){const Qe=b.value.filter(ve=>ve.priority!==W.DO_NOT_DOWNLOAD).map(ve=>ve.piece_range);for(const[ve,et]of Qe)if(re>ve&&re<et){me=u.current.value.colors["torrent-pausedDL"];break}}if(me===L){++ne;continue}L!==""&&(H.fillStyle=L,H.fillRect(re-ne,0,ne,r.value.height)),ne=1,L=me}L!==""&&(H.fillStyle=L,H.fillRect(c.length-ne,0,ne,r.value.height))}async function Be(){await navigator.clipboard.writeText(a.torrent.hash)}function Xe(){f.createDialog(bt,{hashes:[a.torrent.hash]})}function Ze(){f.createDialog(Je,{hash:a.torrent.hash,isFolder:!1,oldName:N.value})}return ge(()=>a.torrent,async()=>{await I(),await ye(),B.value&&await K()}),(c,H)=>c.torrent?(s(),C(le,{key:0},{default:t(()=>[e(pe,{class:"text-wrap"},{default:t(()=>[h(l(c.torrent.name),1)]),_:1}),e(dt,null,{default:t(()=>[v("div",null,[(s(!0),D(z,null,R(o(ut)(_.value),L=>(s(),D("span",null,[o(st)(L)?(s(),D("a",{key:0,target:"_blank",href:L},l(L),9,Wt)):(s(),D("span",Mt,l(L),1))]))),256))]),v("div",Gt,[v("span",Kt,l(c.torrent.hash),1),e(A,{variant:"outlined",rounded:"",onClick:Be},{default:t(()=>[h(l(c.$t("torrentDetail.overview.copy_hash")),1)]),_:1})])]),_:1}),e(ce,null,{default:t(()=>[e(P,null,{default:t(()=>[e(S,{cols:"12",md:"6"},{default:t(()=>[e(P,null,{default:t(()=>[e(S,{cols:"4",md:"4"},{default:t(()=>[e(ct,{color:E.value,indeterminate:T.value,size:100,"model-value":c.torrent?.progress*100,width:15},{default:t(()=>[T.value?(s(),D("span",jt,l(c.$t("torrentDetail.overview.fetchingMetadata")),1)):c.torrent.progress===1?(s(),C(de,{key:1,icon:"mdi-check",size:"x-large"})):(s(),D("span",Ht,l(o(be)(c.torrent.progress)),1))]),_:1},8,["color","indeterminate","model-value"])]),_:1}),e(S,{cols:"8",md:"8",class:"d-flex flex-column align-center justify-center"},{default:t(()=>[T.value?(s(),D("div",qt,[v("span",null,l(c.$t("torrentDetail.overview.waitingForMetadata")),1)])):$.value?(s(),D("div",Yt,[v("canvas",{ref_key:"canvas",ref:r,width:"0",height:"10"},null,512)])):x("",!0),!T.value&&!$.value?(s(),D("div",Jt,[v("span",null,l(c.$t("torrentDetail.overview.canvasRenderDisabled")),1)])):!T.value&&!B.value?(s(),D("div",Xt,[v("span",null,l(c.$t("torrentDetail.overview.canvasRefreshDisabled")),1)])):x("",!0),w.value>0?(s(),D("div",Zt,[v("span",null,l(o(n)("torrentDetail.overview.pieceCount",{owned:m.value,total:w.value,pieceSize:X.value})),1)])):x("",!0),v("div",null,[e(de,{icon:"mdi-arrow-down"}),h(" "+l(o(ee)(c.torrent.dlspeed,o(d).useBitSpeed))+" ",1),e(de,{icon:"mdi-arrow-up"}),h(" "+l(o(ee)(c.torrent.upspeed,o(d).useBitSpeed)),1)])]),_:1})]),_:1}),e(P,null,{default:t(()=>[e(S,{cols:"6"},{default:t(()=>[v("div",null,l(c.$t("torrent.properties.save_path"))+":",1),v("div",null,l(c.torrent.savePath),1),e(A,{icon:"mdi-pencil",color:"accent",size:"x-small",onClick:Xe})]),_:1}),e(S,{cols:"6"},{default:t(()=>[v("div",null,l(c.$t("torrentDetail.overview.fileCount"))+":",1),v("div",null,l(F.value)+" / "+l(g.value),1),F.value===1?(s(),D("div",Qt,l(N.value),1)):x("",!0),F.value===1?(s(),C(A,{key:1,icon:"mdi-pencil",color:"accent",size:"x-small",onClick:Ze})):x("",!0)]),_:1})]),_:1})]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(P,null,{default:t(()=>[e(S,{cols:"6"},{default:t(()=>[v("div",null,l(c.$t("torrent.properties.state"))+":",1),e(ue,{variant:"flat",color:E.value},{default:t(()=>[h(l(c.$t(`torrent.state.${c.torrent.state}`)),1)]),_:1},8,["color"])]),_:1}),e(S,{cols:"6"},{default:t(()=>[v("div",null,l(c.$t("torrent.properties.category"))+":",1),e(ue,{variant:"flat",color:"category"},{default:t(()=>[h(l(c.torrent.category.length?c.torrent.category:c.$t("navbar.side.filters.uncategorized")),1)]),_:1})]),_:1})]),_:1}),e(P,null,{default:t(()=>[e(S,{cols:"6"},{default:t(()=>[v("div",null,l(c.$t("torrent.properties.tracker"))+":",1),e(ue,{variant:"flat",color:"tracker"},{default:t(()=>[h(l(c.torrent.tracker?o(mt)(c.torrent.tracker):c.$t("navbar.side.filters.untracked")),1)]),_:1})]),_:1}),e(S,{cols:"6",class:"d-flex flex-wrap chipgap"},{default:t(()=>[v("div",null,l(c.$t("torrent.properties.tags"))+":",1),c.torrent.tags?(s(!0),D(z,{key:0},R(c.torrent.tags,L=>(s(),C(ue,{key:L,variant:"flat",color:"tag"},{default:t(()=>[h(l(L),1)]),_:2},1024))),128)):x("",!0),!c.torrent.tags||c.torrent.tags.length===0?(s(),C(ue,{key:1,variant:"flat",color:"tag"},{default:t(()=>[h(l(c.$t("navbar.side.filters.untagged")),1)]),_:1})):x("",!0)]),_:1})]),_:1}),e(P,null,{default:t(()=>[e(S,{cols:"6"},{default:t(()=>[v("div",null,l(c.$t("torrentDetail.overview.selectedFileSize"))+":",1),v("div",null,l(o(Y)(c.torrent.size,o(d).useBinarySize))+" / "+l(o(Y)(c.torrent.total_size,o(d).useBinarySize)),1)]),_:1}),e(S,{cols:"6"},{default:t(()=>[v("div",null,l(c.$t("torrentDetail.overview.ratio"))+":",1),v("div",null,l(c.torrent.ratio),1)]),_:1})]),_:1}),e(P,null,{default:t(()=>[e(S,{cols:"6"},{default:t(()=>[v("div",null,l(c.$t("torrentDetail.overview.downloaded"))+":",1),v("div",null,l(o(Y)(c.torrent.downloaded,o(d).useBinarySize)),1)]),_:1}),e(S,{cols:"6"},{default:t(()=>[v("div",null,l(c.$t("torrentDetail.overview.uploaded"))+":",1),v("div",null,l(o(Y)(c.torrent.uploaded,o(d).useBinarySize)),1)]),_:1})]),_:1}),e(P,null,{default:t(()=>[e(S,{cols:"6"},{default:t(()=>[v("div",null,l(c.$t("torrentDetail.overview.dlSpeedAverage"))+":",1),v("div",null,l(o(ee)(k.value,o(d).useBitSpeed)),1)]),_:1}),e(S,{cols:"6"},{default:t(()=>[v("div",null,l(c.$t("torrentDetail.overview.upSpeedAverage"))+":",1),v("div",null,l(o(ee)(i.value,o(d).useBitSpeed)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):x("",!0)}});const tl=Ne(el,[["__scopeId","data-v-c112e5ac"]]),ll={class:"d-flex"},al={key:0},ol=["alt","src","title"],nl=["title"],rl={class:"text-subtitle-2 text-grey"},il=["title"],sl={class:"d-flex flex-column"},ul={class:"text-h5"},dl=G({__name:"Peers",props:{torrent:{},isActive:{type:Boolean}},setup(y){const a=y,{t:n}=oe(),u=J(),f=he(),p=V(!1),d=V([]),r=V(""),_=V(null),k=V(!1);async function b(){p.value=!0,d.value=Object.entries((await u.getTorrentPeers(a.torrent.hash)).peers).map(([m,w])=>({...w,host:m})),p.value=!1}async function F(){r.value.length&&(await u.addTorrentPeers(a.torrent.hash,r.value.split(`
`)),await b(),g())}function g(){k.value=!1,r.value=""}async function N(m){await u.banPeers([m.host]),await b()}async function O(m){m??a.isActive?(await b(),_.value=setInterval(b,5e3)):(clearInterval(_.value),_.value=null)}return Ce(O),Ye(()=>O(!1)),ge(()=>a.isActive,O),(m,w)=>(s(),C(ae,null,{default:t(()=>[(s(!0),D(z,null,R(d.value,(i,E)=>(s(),D(z,null,[E>0?(s(),C(Ie,{key:0,color:"white"})):x("",!0),e(M,null,{default:t(()=>[v("div",ll,[v("div",null,[e(Me,{class:"overflow-visible text-select"},{default:t(()=>[i.country_code?(s(),D("span",al,[o(vt)?(s(),D("img",{key:0,alt:o(Fe)(i.country_code).char,src:o(Fe)(i.country_code).url,title:i.country,style:{"max-width":"32px"}},null,8,ol)):(s(),D("span",{key:1,title:i.country},l(o(Fe)(i.country_code).char),9,nl))])):x("",!0),v("span",null,l(i.ip),1),v("span",rl," :"+l(i.port),1)]),_:2},1024),e(Te,{class:"d-block"},{default:t(()=>[v("div",null,[h(" Flags: "),v("span",{class:"cursor-help",title:i.flags_desc},l(i.flags),9,il)]),v("div",null,"Progress: "+l(o(be)(i.progress)),1),v("div",null,[e(de,{icon:"mdi-arrow-down",color:"download"}),h(" "+l(o(ee)(i.dl_speed,o(f).useBitSpeed))+" ",1),e(de,{icon:"mdi-arrow-up",color:"upload"}),h(" "+l(o(ee)(i.up_speed,o(f).useBitSpeed)),1)]),v("div",null,l(o(Y)(i.downloaded,o(f).useBinarySize))+" | "+l(o(Y)(i.uploaded,o(f).useBinarySize)),1),v("div",null,"Relevance: "+l(o(be)(i.relevance)),1)]),_:2},1024)]),e(te),v("div",sl,[e(A,{color:"red",icon:"mdi-cancel",variant:"text",onClick:X=>N(i)},null,8,["onClick"])])])]),_:2},1024)],64))),256)),d.value.length===0?(s(),C(M,{key:0},{default:t(()=>[h(l(m.$t("torrentDetail.peers.emptyList")),1)]),_:1})):x("",!0),e(M,null,{default:t(()=>[v("div",{class:Ae(["d-flex gap py-5",m.$vuetify.display.mobile?"flex-column":"justify-space-evenly"])},[e(ke,{modelValue:k.value,"onUpdate:modelValue":w[1]||(w[1]=i=>k.value=i),"max-width":"750px"},{activator:t(({props:i})=>[e(A,Ve(i,{variant:"flat",text:o(n)("torrentDetail.peers.addPeers.title"),color:"accent"}),null,16,["text"])]),default:t(()=>[e(le,null,{default:t(()=>[e(pe,null,{default:t(()=>[v("span",ul,l(o(n)("torrentDetail.peers.addPeers.title")),1)]),_:1}),e(ce,null,{default:t(()=>[e(Ge,null,{default:t(()=>[e(P,null,{default:t(()=>[e(S,{cols:"12"},{default:t(()=>[e(Ke,{modelValue:r.value,"onUpdate:modelValue":w[0]||(w[0]=i=>r.value=i),label:o(n)("torrentDetail.peers.addPeers.newPeers"),placeholder:o(n)("torrentDetail.peers.addPeers.newPeersPlaceholder"),hint:o(n)("torrentDetail.peers.addPeers.newPeersHint")},null,8,["modelValue","label","placeholder","hint"])]),_:1})]),_:1})]),_:1})]),_:1}),e($e,null,{default:t(()=>[e(te),e(A,{color:"error",onClick:g},{default:t(()=>[h(l(o(n)("common.cancel")),1)]),_:1}),e(A,{color:"accent",onClick:F},{default:t(()=>[h(l(o(n)("common.ok")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],2)]),_:1})]),_:1}))}});const cl=Ne(dl,[["__scopeId","data-v-1d5acb7f"]]),ml=G({__name:"TagsAndCategories",props:{torrent:{},isActive:{type:Boolean}},setup(y){const a=y,n=J(),u=U(()=>n.categories.map(r=>r.name).indexOf(a.torrent.category)),f=U(()=>n.tags.filter(r=>a.torrent.tags?.includes(r)));async function p(r){a.torrent.category===r?await n.setTorrentCategory([a.torrent.hash],""):await n.setTorrentCategory([a.torrent.hash],r)}async function d(r){a.torrent.tags?.includes(r)?await n.removeTorrentTags([a.torrent.hash],[r]):await n.addTorrentTags([a.torrent.hash],[r])}return Ce(async()=>{await n.fetchCategories(),await n.fetchTags()}),(r,_)=>(s(),C(le,null,{default:t(()=>[e(ce,null,{default:t(()=>[e(P,null,{default:t(()=>[e(S,{cols:"12",md:"6"},{default:t(()=>[e(ze,{"model-value":f.value,multiple:""},{default:t(()=>[e(ae,null,{default:t(()=>[e(Ue,null,{default:t(()=>[h(l(r.$t("torrentDetail.tagsAndCategories.tags")),1)]),_:1}),(s(!0),D(z,null,R(o(n).tags,k=>(s(),C(M,{title:k,variant:r.torrent.tags?.includes(k)?"tonal":void 0,"base-color":r.torrent.tags?.includes(k)?"accent":void 0,onClick:b=>d(k)},null,8,["title","variant","base-color","onClick"]))),256))]),_:1})]),_:1},8,["model-value"])]),_:1}),e(S,{cols:"12",md:"6"},{default:t(()=>[e(ze,{"model-value":u.value},{default:t(()=>[e(ae,null,{default:t(()=>[e(Ue,null,{default:t(()=>[h(l(r.$t("torrentDetail.tagsAndCategories.categories")),1)]),_:1}),(s(!0),D(z,null,R(o(n).categories,k=>(s(),C(M,{title:k.name,variant:k.name===a.torrent.category?"tonal":void 0,"base-color":k.name===a.torrent.category?"accent":void 0,onClick:b=>p(k.name)},null,8,["title","variant","base-color","onClick"]))),256))]),_:1})]),_:1},8,["model-value"])]),_:1})]),_:1})]),_:1})]),_:1}))}}),vl={class:"d-flex"},fl={key:0},pl={key:1},_l={key:2},gl={key:3},hl={key:0,class:"d-flex flex-column"},yl={class:"text-h5"},wl={class:"text-h5"},Dl=G({__name:"Trackers",props:{torrent:{},isActive:{type:Boolean}},setup(y){const a=y,{t:n}=oe(),u=J();function f($){switch($){case q.DISABLED:return n("constants.trackerStatus.disabled");case q.NOT_YET_CONTACTED:return n("constants.trackerStatus.not_yet_contacted");case q.WORKING:return n("constants.trackerStatus.working");case q.UPDATING:return n("constants.trackerStatus.updating");case q.NOT_WORKING:return n("constants.trackerStatus.not_working");default:return""}}function p($){return typeof $=="number"?$===-1?"N/A":$.valueOf():!$||$.num_peers===-1||$?.num_seeds===-1||$?.num_leeches===-1?"N/A":n("torrentDetail.trackers.peersValue",{peers:$.num_peers,seeds:$.num_seeds,leeches:$.num_leeches})}const d=V(!1),r=V([]),_=V(""),k=V(null),b=V(!1),F=[$=>!!$||n("torrentDetail.trackers.editTracker.newUrlRequired")],g=Pe({isVisible:!1,isFormValid:!1,oldUrl:"",newUrl:""});function N($){g.isVisible=!0,g.oldUrl=$.url,g.newUrl=$.url,_e(()=>{document.getElementById("input")?.select()})}async function O(){d.value=!0,r.value=(await u.getTorrentTrackers(a.torrent.hash)).map($=>({...$,isSelectable:$.tier!==-1})),d.value=!1}async function m(){_.value.length&&(await u.addTorrentTrackers(a.torrent.hash,_.value),await O(),w())}function w(){b.value=!1,_.value=""}async function i(){g.isFormValid&&(await u.editTorrentTracker(a.torrent.hash,g.oldUrl,g.newUrl),g.isVisible=!1,await O())}async function E($){await u.removeTorrentTrackers(a.torrent.hash,[$.url]),await O()}async function X(){await u.reannounceTorrents([a.torrent.hash])}async function T($){$??a.isActive?(await O(),k.value=setInterval(O,5e3)):(clearInterval(k.value),k.value=null)}return Ce(T),Ye(()=>T(!1)),ge(()=>a.isActive,T),($,B)=>(s(),C(ae,null,{default:t(()=>[(s(!0),D(z,null,R(r.value,(I,ye)=>(s(),D(z,null,[ye===3?(s(),C(Ie,{key:0,color:"white",thickness:"5"})):ye>0?(s(),C(Ie,{key:1,class:"mx-5",color:"white"})):x("",!0),e(M,null,{default:t(()=>[v("div",vl,[v("div",{class:Ae(`tracker-${o(q)[I.status].toLowerCase()}`)},[e(Me,{class:"text-break text-wrap"},{default:t(()=>[h(l(I.url),1)]),_:2},1024),e(Te,{class:"d-block"},{default:t(()=>[I.msg?(s(),D("div",fl,l(I.msg),1)):(s(),D("div",pl,l(f(I.status)),1)),I.tier>=0?(s(),D("div",_l,l(o(n)("torrentDetail.trackers.tier",I.tier)),1)):x("",!0),I.status!==o(q).NOT_WORKING?(s(),D("div",gl,[v("div",null,l(p(I)),1),v("div",null,"Downloads: "+l(p(I.num_downloaded)),1)])):x("",!0)]),_:2},1024)],2),e(te),I.tier>=0?(s(),D("div",hl,[e(ke,{modelValue:g.isVisible,"onUpdate:modelValue":B[4]||(B[4]=K=>g.isVisible=K),"max-width":"750px"},{activator:t(({props:K})=>[e(A,Ve(K,{icon:"mdi-pencil",variant:"text",onClick:Be=>N(I)}),null,16,["onClick"])]),default:t(()=>[e(le,null,{default:t(()=>[e(pe,null,{default:t(()=>[v("span",yl,l(o(n)("torrentDetail.trackers.editTracker.title")),1)]),_:1}),e(ce,null,{default:t(()=>[e(o(We),{modelValue:g.isFormValid,"onUpdate:modelValue":B[1]||(B[1]=K=>g.isFormValid=K),onSubmit:B[2]||(B[2]=Oe(()=>{},["prevent"]))},{default:t(()=>[e(o(De),{"model-value":g.oldUrl,disabled:"",label:$.$t("torrentDetail.trackers.editTracker.oldUrl")},null,8,["model-value","label"]),e(o(De),{modelValue:g.newUrl,"onUpdate:modelValue":B[0]||(B[0]=K=>g.newUrl=K),id:"input",rules:F,label:$.$t("torrentDetail.trackers.editTracker.newUrl"),autofocus:"",onKeydown:je(i,["enter"])},null,8,["modelValue","label","onKeydown"])]),_:1},8,["modelValue"])]),_:1}),e($e,null,{default:t(()=>[e(te),e(A,{color:"error",disabled:!g.isFormValid,onClick:B[3]||(B[3]=K=>g.isVisible=!1)},{default:t(()=>[h(l(o(n)("common.cancel")),1)]),_:1},8,["disabled"]),e(A,{color:"accent",onClick:i},{default:t(()=>[h(l(o(n)("common.ok")),1)]),_:1})]),_:1})]),_:1})]),_:2},1032,["modelValue"]),e(A,{color:"red",icon:"mdi-delete",variant:"text",onClick:K=>E(I)},null,8,["onClick"])])):x("",!0)])]),_:2},1024)],64))),256)),e(M,null,{default:t(()=>[v("div",{class:Ae(["d-flex gap py-5",$.$vuetify.display.mobile?"flex-column":"justify-space-evenly"])},[e(ke,{modelValue:b.value,"onUpdate:modelValue":B[6]||(B[6]=I=>b.value=I),"max-width":"750px"},{activator:t(({props:I})=>[e(A,Ve(I,{variant:"flat",text:o(n)("torrentDetail.trackers.addTrackers.title"),color:"accent"}),null,16,["text"])]),default:t(()=>[e(le,null,{default:t(()=>[e(pe,null,{default:t(()=>[v("span",wl,l(o(n)("torrentDetail.trackers.addTrackers.title")),1)]),_:1}),e(ce,null,{default:t(()=>[e(Ge,null,{default:t(()=>[e(P,null,{default:t(()=>[e(S,{cols:"12"},{default:t(()=>[e(Ke,{modelValue:_.value,"onUpdate:modelValue":B[5]||(B[5]=I=>_.value=I),label:o(n)("torrentDetail.trackers.addTrackers.newTrackers"),hint:o(n)("torrentDetail.trackers.addTrackers.newTrackersHint")},null,8,["modelValue","label","hint"])]),_:1})]),_:1})]),_:1})]),_:1}),e($e,null,{default:t(()=>[e(te),e(A,{color:"error",onClick:w},{default:t(()=>[h(l(o(n)("common.cancel")),1)]),_:1}),e(A,{color:"accent",onClick:m},{default:t(()=>[h(l(o(n)("common.ok")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(A,{variant:"flat",disabled:r.value.length===3,text:o(n)("torrentDetail.trackers.reannounce"),color:"primary",onClick:X},null,8,["disabled","text"])],2)]),_:1})]),_:1}))}});const $l=Ne(Dl,[["__scopeId","data-v-baba83c8"]]),kl={class:"pa-3"},bl={style:{"font-size":"1.6em !important"},class:"subtitle-1 ml-2"},Tl={class:"d-flex justify-end"},Il=G({__name:"TorrentDetail",setup(y){const a=$t(),n=kt(),{t:u}=oe(),f=xe(),p=J(),d=V("overview"),r=U(()=>a.params.hash),_=U(()=>p.getTorrentByHash(r.value)),k=()=>{n.push({name:"dashboard"})};function b(F){if(f.hasActiveDialog)return!1;if(F.key==="Delete")return f.createDialog(pt,{hashes:[r.value]}),F.preventDefault(),!0;F.key==="Escape"&&k()}return qe(()=>{document.addEventListener("keydown",b)}),He(()=>{document.removeEventListener("keydown",b)}),(F,g)=>(s(),D("div",kl,[e(P,{"no-gutters":"",align:"center",justify:"center"},{default:t(()=>[e(S,null,{default:t(()=>[v("h1",bl,l(o(u)("torrentDetail.title")),1)]),_:1}),e(S,null,{default:t(()=>[v("div",Tl,[e(A,{icon:"mdi-close",variant:"plain",onClick:k})])]),_:1})]),_:1}),e(P,{class:"ma-0 pa-0"},{default:t(()=>[e(_t,{modelValue:d.value,"onUpdate:modelValue":g[0]||(g[0]=N=>d.value=N),"bg-color":"primary",grow:"","show-arrows":""},{default:t(()=>[e(ie,{value:"overview"},{default:t(()=>[h(l(o(u)("torrentDetail.tabs.overview")),1)]),_:1}),e(ie,{value:"info"},{default:t(()=>[h(l(o(u)("torrentDetail.tabs.info")),1)]),_:1}),e(ie,{value:"trackers"},{default:t(()=>[h(l(o(u)("torrentDetail.tabs.trackers")),1)]),_:1}),e(ie,{value:"peers"},{default:t(()=>[h(l(o(u)("torrentDetail.tabs.peers")),1)]),_:1}),e(ie,{value:"content"},{default:t(()=>[h(l(o(u)("torrentDetail.tabs.content")),1)]),_:1}),e(ie,{value:"tagsAndCategories"},{default:t(()=>[h(l(o(u)("torrentDetail.tabs.tagsAndCategories")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1}),_.value?(s(),C(ft,{key:0,modelValue:d.value,"onUpdate:modelValue":g[1]||(g[1]=N=>d.value=N)},{default:t(()=>[e(se,{value:"overview"},{default:t(()=>[e(tl,{torrent:_.value,"is-active":d.value==="overview"},null,8,["torrent","is-active"])]),_:1}),e(se,{value:"info"},{default:t(()=>[e(Et,{torrent:_.value,"is-active":d.value==="info"},null,8,["torrent","is-active"])]),_:1}),e(se,{value:"trackers"},{default:t(()=>[e($l,{torrent:_.value,"is-active":d.value==="trackers"},null,8,["torrent","is-active"])]),_:1}),e(se,{value:"peers"},{default:t(()=>[e(cl,{torrent:_.value,"is-active":d.value==="peers"},null,8,["torrent","is-active"])]),_:1}),e(se,{value:"content"},{default:t(()=>[e(Bt,{torrent:_.value,"is-active":d.value==="content"},null,8,["torrent","is-active"])]),_:1}),e(se,{value:"tagsAndCategories"},{default:t(()=>[e(ml,{torrent:_.value,"is-active":d.value==="tagsAndCategories"},null,8,["torrent","is-active"])]),_:1})]),_:1},8,["modelValue"])):x("",!0)]))}});export{Il as default};
