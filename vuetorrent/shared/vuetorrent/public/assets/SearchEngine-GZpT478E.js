import{g as G,K as Y,d as h,a3 as S,a4 as N,a5 as a,m as e,ab as C,Z as m,n as te,W as E,u as p,Y as W,D as ne,$ as se,a0 as ie,c as z,N as oe,q as re,a8 as A,F as ue,a9 as ce,aq as de}from"./vue-tp2yrxEM.js";import{k as fe,aM as Z,p as F,l as ge,f as M,g as c,q as K,m as j,n as me,V as J,o as H,ai as X,x as pe,h as ve,aF as he,y as ye,A as Ve,aG as ke,v as $,i as be,w as b,ah as Ee,aC as Se,aD as we,j as O,ao as Ce,ap as _e,a3 as Q,a5 as Te,N as Pe}from"./index-BxCS0EpI.js";import"./vuetify-wVJKcCjY.js";const $e=["href","title"],Ne=G({__name:"PluginManagerDialog",props:{guid:{}},setup(B){const D=B,{isOpened:t}=fe(D.guid),{t:y}=Y(),d=Z(),f=[{title:y("dialogs.pluginManager.headers.enabled"),key:"enabled",sortable:!1},{title:y("dialogs.pluginManager.headers.name"),key:"fullName"},{title:y("dialogs.pluginManager.headers.version"),key:"version"},{title:y("dialogs.pluginManager.headers.url"),key:"url"},{title:y("dialogs.pluginManager.headers.actions"),key:"actions"}],V=h(!1),k=h(!1),w=h(!1),v=h(!1),u=h("");async function I(r){await d.toggleSearchPlugin(r),await d.fetchSearchPlugins()}async function _(){k.value=!0,await d.updatePlugins().then(()=>new Promise(r=>setTimeout(r,2e3))),await d.fetchSearchPlugins(),k.value=!1}async function U(){T(),V.value=!0,await d.installSearchPlugin(u.value),u.value="",setTimeout(()=>{d.fetchSearchPlugins().then(()=>{V.value=!1})},1e3)}async function q(r){V.value=!0,await d.uninstallSearchPlugin(r.name),await d.fetchSearchPlugins(),V.value=!1}const s=()=>{t.value=!1};function T(){w.value=!1}return(r,g)=>(S(),N(K,{modelValue:p(t),"onUpdate:modelValue":g[4]||(g[4]=n=>ne(t)?t.value=n:null)},{default:a(()=>[e(F,null,{default:a(()=>[e(ge,{class:"d-flex"},{default:a(()=>[C("div",null,m(r.$t("dialogs.pluginManager.title")),1),e(M),e(c,{text:r.$t("dialogs.pluginManager.update"),color:"accent",class:"mr-2",loading:k.value,onClick:_},null,8,["text","loading"]),e(K,{modelValue:w.value,"onUpdate:modelValue":g[3]||(g[3]=n=>w.value=n)},{activator:a(({props:n})=>[e(c,te(n,{color:"primary"}),{default:a(()=>[E(m(r.$t("dialogs.pluginManager.install.activator")),1)]),_:2},1040)]),default:a(()=>[e(F,{title:r.$t("dialogs.pluginManager.install.title")},{default:a(()=>[e(j,null,{default:a(()=>[e(p(me),{modelValue:v.value,"onUpdate:modelValue":g[1]||(g[1]=n=>v.value=n),onSubmit:g[2]||(g[2]=W(()=>{},["prevent"]))},{default:a(()=>[e(J,{modelValue:u.value,"onUpdate:modelValue":g[0]||(g[0]=n=>u.value=n),autofocus:"",label:r.$t("dialogs.pluginManager.install.label")},null,8,["modelValue","label"])]),_:1},8,["modelValue"])]),_:1}),e(H,null,{default:a(()=>[e(M),e(c,{color:"error",onClick:T},{default:a(()=>[E(m(r.$t("common.cancel")),1)]),_:1}),e(c,{color:"accent",onClick:U},{default:a(()=>[E(m(r.$t("common.ok")),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])]),_:1}),e(j,null,{default:a(()=>[e(X,{headers:f,"items-per-page":"-1",items:p(d).searchPlugins,"sort-by":[{key:"fullName",order:"asc"}],loading:V.value},{"item.enabled":a(({item:n})=>[e(pe,{"model-value":n.enabled,onClick:P=>I(n)},null,8,["model-value","onClick"])]),"item.url":a(({item:n})=>[C("a",{href:n.url,title:n.name},m(n.url),9,$e)]),"item.actions":a(({item:n})=>[e(ve,{color:"red",icon:"mdi-delete",onClick:P=>q(n)},null,8,["onClick"])]),tfoot:a(()=>[]),_:1},8,["items","loading"])]),_:1}),e(H,null,{default:a(()=>[e(M),e(c,{color:"accent",onClick:s},{default:a(()=>[E(m(r.$t("common.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Me={class:"pa-3"},De={style:{"font-size":"1.6em !important"},class:"subtitle-1 ml-2"},Ie={class:"d-flex justify-end"},Le=G({__name:"SearchEngine",setup(B){const D=se(),{t}=Y(),y=he(),d=ye(),f=Z(),V=Ve(),k=h(),w=h(!1),v=h(0),{searchData:u}=ie(f),I=[{title:t("searchEngine.headers.fileName"),key:"fileName"},{title:t("searchEngine.headers.fileSize"),key:"fileSize"},{title:t("searchEngine.headers.nbSeeders"),key:"nbSeeders"},{title:t("searchEngine.headers.nbLeechers"),key:"nbLeechers"},{title:t("searchEngine.headers.siteUrl"),key:"siteUrl"},{title:"",key:"actions",sortable:!1}],_=[{title:t("searchEngine.filters.category.movies"),value:"movies"},{title:t("searchEngine.filters.category.tv"),value:"tv"},{title:t("searchEngine.filters.category.music"),value:"music"},{title:t("searchEngine.filters.category.games"),value:"games"},{title:t("searchEngine.filters.category.anime"),value:"anime"},{title:t("searchEngine.filters.category.software"),value:"software"},{title:t("searchEngine.filters.category.pictures"),value:"pictures"},{title:t("searchEngine.filters.category.books"),value:"books"}];_.sort((l,i)=>l.title.localeCompare(i.title));const U=[{title:t("searchEngine.filters.category.all"),value:"all"},..._],q=z(()=>{const l=[{title:t("searchEngine.filters.plugins.all"),value:"all"},{title:t("searchEngine.filters.plugins.enabled"),value:"enabled"}];return f.searchPlugins.filter(i=>i.enabled).forEach(i=>{l.push({title:i.name,value:i.name})}),l}),s=z(()=>u.value[v.value]??{}),{results:T}=ke(()=>s.value.results,()=>s.value.filters?.title,l=>l.fileName);function r(){f.createNewTab(),v.value=u.value.length-1,k.value?.focus()}function g(){u.value.length!==1&&(f.deleteTab(s.value.uniqueId),v.value=Math.min(v.value,u.value.length-1))}function n(l){y.pushTorrentToQueue(l.fileUrl)}async function P(){await f.runNewSearch(s.value),s.value.timer=setInterval(()=>ae(s.value),1e3),k.value?.saveValueToHistory()}async function R(l){await f.stopSearch(l),l.timer&&clearInterval(l.timer)}function ee(){u.value.forEach(R)}async function ae(l){await f.refreshResults(l)==="Stopped"&&await R(l)}const L=()=>{D.push({name:"dashboard"})};function le(){d.createDialog(Ne)}function x(l){if(d.hasActiveDialog||w.value)return!1;l.key==="Escape"&&L()}return oe(async()=>{document.addEventListener("keydown",x),u.value.length===0?f.createNewTab():u.value.forEach(l=>{l.id&&l.id!==0&&(l.timer=setInterval(()=>f.refreshResults(l),1e3))}),await f.fetchSearchPlugins()}),re(()=>{document.removeEventListener("keydown",x),u.value.forEach(l=>{l.timer&&clearInterval(l.timer)})}),(l,i)=>(S(),A("div",Me,[e($,{"no-gutters":"",align:"center",justify:"center"},{default:a(()=>[e(b,null,{default:a(()=>[C("h1",De,m(p(t)("searchEngine.title")),1)]),_:1}),e(b,null,{default:a(()=>[C("div",Ie,[e(c,{icon:"mdi-stop",variant:"plain",color:"error",onClick:ee}),e(c,{icon:"mdi-toy-brick",variant:"plain",color:"primary",onClick:le}),e(c,{icon:"mdi-close",variant:"plain",onClick:L})])]),_:1})]),_:1}),e($,{class:"ma-0 pa-0"},{default:a(()=>[e(Ee,{class:"d-flex align-center justify-center ma-0 pa-0 bg-primary",fluid:""},{default:a(()=>[e(Se,{modelValue:v.value,"onUpdate:modelValue":i[0]||(i[0]=o=>v.value=o),class:"overflow-auto","bg-color":"primary","show-arrows":""},{default:a(()=>[(S(!0),A(ue,null,ce(p(u),o=>(S(),N(we,{key:o.uniqueId},{default:a(()=>[C("h4",null,m(!o.query||o.query.length===0?l.$t("searchEngine.tabHeaderEmpty"):o.query),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),e(M),e(c,{icon:"mdi-plus-circle-outline",variant:"plain",color:"accent",onClick:r}),e(c,{icon:"mdi-minus-circle-outline",variant:"plain",color:"error",disabled:p(u).length===1,onClick:g},null,8,["disabled"])]),_:1})]),_:1}),e(be,null,{default:a(()=>[e(O,null,{default:a(()=>[e($,{class:"mt-1"},{default:a(()=>[e(b,{cols:"12",md:"6"},{default:a(()=>[e(Ce,{modelValue:s.value.query,"onUpdate:modelValue":i[1]||(i[1]=o=>s.value.query=o),"history-key":p(_e).SEARCH_ENGINE_QUERY,ref_key:"queryInput",ref:k,autofocus:"",density:"compact","hide-details":"",clearable:"",label:l.$t("searchEngine.query"),onKeydown:de(W(P,["prevent"]),["enter"])},null,8,["modelValue","history-key","label","onKeydown"])]),_:1}),e(b,{cols:"6",sm:"5",md:"2"},{default:a(()=>[e(Q,{modelValue:s.value.filters.category,"onUpdate:modelValue":i[2]||(i[2]=o=>s.value.filters.category=o),height:"1",variant:"outlined",density:"compact","hide-details":"",items:U,label:l.$t("searchEngine.filters.category.label")},null,8,["modelValue","label"])]),_:1}),e(b,{cols:"6",sm:"5",md:"2"},{default:a(()=>[e(Q,{modelValue:s.value.filters.plugin,"onUpdate:modelValue":i[3]||(i[3]=o=>s.value.filters.plugin=o),flat:"",density:"compact","hide-details":"",variant:"outlined",items:q.value,label:l.$t("searchEngine.filters.plugins.label")},null,8,["modelValue","items","label"])]),_:1}),e(b,{cols:"12",sm:"2",class:"d-flex align-center justify-center"},{default:a(()=>[s.value.id===0?(S(),N(c,{key:0,color:"accent",flat:"",class:"mx-auto px-4",onClick:P},{default:a(()=>[E(m(l.$t("searchEngine.runSearch")),1)]),_:1})):(S(),N(c,{key:1,color:"warning",flat:"",class:"mx-auto px-4",onClick:i[4]||(i[4]=o=>R(s.value))},{default:a(()=>[E(m(l.$t("searchEngine.stopSearch")),1)]),_:1}))]),_:1})]),_:1})]),_:1}),e(Te,{class:"my-3"}),e(O,{class:"text-select"},{default:a(()=>[e(X,{headers:I,items:p(T),"footer-props":{itemsPerPageOptions:[10,25,50,100,-1]},"items-per-page":s.value.itemsPerPage},{top:a(()=>[e($,null,{default:a(()=>[e(b,{cols:"12"},{default:a(()=>[e(J,{modelValue:s.value.filters.title,"onUpdate:modelValue":i[5]||(i[5]=o=>s.value.filters.title=o),density:"compact","hide-details":"",label:l.$t("searchEngine.filters.title.label")},null,8,["modelValue","label"])]),_:1})]),_:1})]),"item.fileSize":a(({item:o})=>[E(m(p(Pe)(o.fileSize,p(V).useBinarySize)),1)]),"item.actions":a(({item:o})=>[e(c,{icon:"mdi-download",variant:"flat",density:"compact",onClick:Ue=>n(o)},null,8,["onClick"])]),_:1},8,["items","items-per-page"])]),_:1})]),_:1})]))}});export{Le as default};
